var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.MainScene = (function(_super) {
  __extends(MainScene, _super);

  MainScene.prototype.equalizer = null;

  MainScene.prototype.jukebox = null;

  MainScene.prototype.waveformData = null;

  function MainScene() {
    this._whileplaying = __bind(this._whileplaying, this);
    this._eTrackOnAdd = __bind(this._eTrackOnAdd, this);
    var middlePoint, options;
    MainScene.__super__.constructor.apply(this, arguments);
    middlePoint = new THREE.Vector3(0, 0, 0);
    options = {
      minLength: 0,
      maxLength: 100,
      radius: 200,
      absolute: false,
      lineForceDown: .5,
      lineForceUp: .5
    };
    this.equalizer = new SPACE.Equalizer(middlePoint, options);
    this.add(this.equalizer);
    this.jukebox = new SPACE.Jukebox();
    this.jukebox.whileplaying = this._whileplaying;
    this.jukebox.predefinedPlaylist();
    this.spaceship = new SPACE.Spaceship(middlePoint, this.equalizer.radius);
    this.add(this.spaceship);
    this.setupSomething();
    this.waveformData = {};
    this._events();
  }

  MainScene.prototype._events = function() {
    return document.addEventListener(JUKEBOX.TRACK_ON_ADD.type, this._eTrackOnAdd);
  };

  MainScene.prototype._eTrackOnAdd = function(e) {
    var track;
    track = e.object.track;
    track.spaceship = null;
    return HELPERS.trigger(JUKEBOX.TRACK_ADDED, {
      track: track
    });
  };

  MainScene.prototype.setupSomething = function() {
    var g, light, m, speed;
    g = new THREE.BoxGeometry(100, 100, 100);
    m = new THREE.MeshLambertMaterial({
      color: 0x0088ff,
      shading: THREE.FlatShading
    });
    this.cube = new THREE.Mesh(g, m);
    this.cube.rotation.set(Math.random(), Math.random(), Math.random());
    this.cube.castShadow = true;
    this.cube.receiveShadow = true;
    this.add(this.cube);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(500, 500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .6);
    light.position.set(-500, 500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(500, -500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(-500, -500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(500, 500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(-500, 500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(500, -500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(-500, -500, -500);
    this.add(light);
    speed = {
      x: Math.random() * 0.005,
      y: Math.random() * 0.005,
      z: Math.random() * 0.005
    };
    return this.cube.update = function() {
      this.rotation.x += speed.x;
      this.rotation.y += speed.y;
      return this.rotation.z += speed.z;
    };
  };

  MainScene.prototype.time = 0;

  MainScene.prototype.update = function(delta) {
    MainScene.__super__.update.call(this, delta);
    this.jukebox.update(delta);
    this.time += delta;
    if (this.jukebox.state === SPACE.Jukebox.IS_PLAYING) {
      if (this.jukebox.current && this.jukebox.current.sound.paused) {
        return this.equalizer.mute();
      } else if (this.waveformData.hasOwnProperty('mono')) {
        return this.equalizer.setValues(this.waveformData.mono);
      }
    }
  };

  MainScene.prototype._whileplaying = function() {
    var datas, i, sound, value, _i;
    sound = this.jukebox.current.sound;
    datas = Array(256);
    for (i = _i = 0; _i <= 127; i = ++_i) {
      value = Math.max(sound.waveformData.left[i], sound.waveformData.right[i]);
      datas[i] = datas[255 - i] = value * Math.max(sound.peakData.left, sound.peakData.left);
    }
    this.waveformData.mono = datas;
    return this.waveformData.stereo = sound.waveformData;
  };

  return MainScene;

})(SPACE.Scene);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvc2NlbmVzL01haW4uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUE7O2lTQUFBOztBQUFBLEtBQVcsQ0FBQztBQUVWLDhCQUFBLENBQUE7O0FBQUEsc0JBQUEsU0FBQSxHQUFXLElBQVgsQ0FBQTs7QUFBQSxzQkFDQSxPQUFBLEdBQVcsSUFEWCxDQUFBOztBQUFBLHNCQUdBLFlBQUEsR0FBYyxJQUhkLENBQUE7O0FBS2EsRUFBQSxtQkFBQSxHQUFBO0FBQ1gseURBQUEsQ0FBQTtBQUFBLHVEQUFBLENBQUE7QUFBQSxRQUFBLG9CQUFBO0FBQUEsSUFBQSw0Q0FBQSxTQUFBLENBQUEsQ0FBQTtBQUFBLElBRUEsV0FBQSxHQUFrQixJQUFBLEtBQUssQ0FBQyxPQUFOLENBQWMsQ0FBZCxFQUFpQixDQUFqQixFQUFvQixDQUFwQixDQUZsQixDQUFBO0FBQUEsSUFHQSxPQUFBLEdBQ0U7QUFBQSxNQUFBLFNBQUEsRUFBVyxDQUFYO0FBQUEsTUFDQSxTQUFBLEVBQVcsR0FEWDtBQUFBLE1BRUEsTUFBQSxFQUFRLEdBRlI7QUFBQSxNQUdBLFFBQUEsRUFBVSxLQUhWO0FBQUEsTUFJQSxhQUFBLEVBQWUsRUFKZjtBQUFBLE1BS0EsV0FBQSxFQUFhLEVBTGI7S0FKRixDQUFBO0FBQUEsSUFXQSxJQUFDLENBQUEsU0FBRCxHQUFpQixJQUFBLEtBQUssQ0FBQyxTQUFOLENBQWdCLFdBQWhCLEVBQTZCLE9BQTdCLENBWGpCLENBQUE7QUFBQSxJQVlBLElBQUMsQ0FBQSxHQUFELENBQUssSUFBQyxDQUFBLFNBQU4sQ0FaQSxDQUFBO0FBQUEsSUFjQSxJQUFDLENBQUEsT0FBRCxHQUFlLElBQUEsS0FBSyxDQUFDLE9BQU4sQ0FBQSxDQWRmLENBQUE7QUFBQSxJQWVBLElBQUMsQ0FBQSxPQUFPLENBQUMsWUFBVCxHQUF3QixJQUFDLENBQUEsYUFmekIsQ0FBQTtBQUFBLElBZ0JBLElBQUMsQ0FBQSxPQUFPLENBQUMsa0JBQVQsQ0FBQSxD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Q0FBTixHQUFlLEtBQUEsR0FBUSxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBeEIsRUFBOEIsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUE3QyxDQURsQyxDQURGO0FBQUEsS0FIQTtBQUFBLElBT0EsSUFBQyxDQUFBLFlBQVksQ0FBQyxJQUFkLEdBQXVCLEtBUHZCLENBQUE7V0FRQSxJQUFDLENBQUEsWUFBWSxDQUFDLE1BQWQsR0FBdUIsS0FBSyxDQUFDLGFBVGhCO0VBQUEsQ0FySmYsQ0FBQTs7bUJBQUE7O0dBRjRCLEtBQUssQ0FBQyxNQUFwQyxDQUFBIiwiZmlsZSI6InRocmVlanMvc2NlbmVzL01haW4uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTUEFDRS5NYWluU2NlbmUgZXh0ZW5kcyBTUEFDRS5TY2VuZVxuXG4gIGVxdWFsaXplcjogbnVsbFxuICBqdWtlYm94OiAgIG51bGxcblxuICB3YXZlZm9ybURhdGE6IG51bGxcblxuICBjb25zdHJ1Y3RvcjogLT5cbiAgICBzdXBlclxuXG4gICAgbWlkZGxlUG9pbnQgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKVxuICAgIG9wdGlvbnMgICAgID1cbiAgICAgIG1pbkxlbmd0aDogMFxuICAgICAgbWF4TGVuZ3RoOiAxMDBcbiAgICAgIHJhZGl1czogMjAwXG4gICAgICBhYnNvbHV0ZTogZmFsc2VcbiAgICAgIGxpbmVGb3JjZURvd246IC41XG4gICAgICBsaW5lRm9yY2VVcDogLjVcblxuICAgIEBlcXVhbGl6ZXIgPSBuZXcgU1BBQ0UuRXF1YWxpemVyKG1pZGRsZVBvaW50LCBvcHRpb25zKVxuICAgIEBhZGQoQGVxdWFsaXplcilcblxuICAgIEBqdWtlYm94ID0gbmV3IFNQQUNFLkp1a2Vib3goKVxuICAgIEBqdWtlYm94LndoaWxlcGxheWluZyA9IEBfd2hpbGVwbGF5aW5nXG4gICAgQGp1a2Vib3gucHJlZGVmaW5lZFBsYXlsaXN0KClcblxuICAgIEBzcGFjZXNoaXAgPSBuZXcgU1BBQ0UuU3BhY2VzaGlwKG1pZGRsZVBvaW50LCBAZXF1YWxpemVyLnJhZGl1cylcbiAgICBAYWRkKEBzcGFjZXNoaXApXG5cbiAgICBAc2V0dXBTb21ldGhpbmcoKVxuXG4gICAgQHdhdmVmb3JtRGF0YSA9IHt9XG5cbiAgICBAX2V2ZW50cygpXG5cbiAgX2V2ZW50czogLT5cbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKEpVS0VCT1guVFJBQ0tfT05fQURELnR5cGUsIEBfZVRyYWNrT25BZGQpXG5cbiAgX2VUcmFja09uQWRkOiAoZSk9PlxuICAgICMgc3BhY2VzaGlwID0gbmV3IFNQQUNFLlNwYWNlc2hpcChAZXF1YWxpemVyLmNlbnRlciwgQGVxdWFsaXplci5yYWRpdXMpXG4gICAgIyBAYWRkQ2hpbGQoc3BhY2VzaGlwKVxuXG4gICAgdHJhY2sgPSBlLm9iamVjdC50cmFja1xuICAgIHRyYWNrLnNwYWNlc2hpcCA9IG51bGwjc3BhY2VzaGlwXG4gICAgSEVMUEVSUy50cmlnZ2VyKEpVS0VCT1guVFJBQ0tfQURERUQsIHsgdHJhY2s6IHRyYWNrIH0pXG5cbiAgICAjIEBkb3R0ZWQgPSBuZXcgU1BBQ0UuRG90dGVkTGluZSh0cmFjaylcbiAgICAjIEBhZGRDaGlsZChAZG90dGVkKVxuXG4gIHNldHVwU29tZXRoaW5nOiAtPlxuICAgICMgQ3ViZVxuICAgIGcgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoMTAwLCAxMDAsIDEwMClcbiAgICBtID0gbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHgwMDg4ZmYsIHNoYWRpbmc6IFRIUkVFLkZsYXRTaGFkaW5nIH0pXG4gICAgQGN1YmUgPSBuZXcgVEhSRUUuTWVzaChnLCBtKVxuICAgICMgQGN1YmUucG9zaXRpb24uc2V0WigxMDApXG4gICAgQGN1YmUucm90YXRpb24uc2V0KE1hdGgucmFuZG9tKCksIE1hdGgucmFuZG9tKCksIE1hdGgucmFuZG9tKCkpXG4gICAgQGN1YmUuY2FzdFNoYWRvdyA9IHRydWVcbiAgICBAY3ViZS5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgIEBhZGQoQGN1YmUpXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4yIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIDUwMCwgNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjYgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjIgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggNTAwLCAtNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjIgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgLTUwMCwgNTAwIClcbiAgICBAYWRkKCBsaWdodCApXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4xIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIDUwMCwgNTAwLCAtNTAwIClcbiAgICBAYWRkKCBsaWdodCApXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4xIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIC01MDAsIDUwMCwgLTUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhGRkZGRkYsIDEuOCouMSApXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KCA1MDAsIC01MDAsIC01MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjEgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgLTUwMCwgLTUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgIyBsaWdodC5jYXN0U2hhZG93ID0gdHJ1ZVxuXG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFOZWFyICAgID0gNzAwXG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFGYXIgICAgID0gbWFuYWdlci5fY2FtZXJhLmZhclxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhRm92ICAgICA9IDUwXG5cbiAgICAjIGxpZ2h0LnNoYWRvd0Nhc2NhZGUgPSB0cnVlXG5cbiAgICAjIGxpZ2h0LnNoYWRvd0JpYXMgICAgICAgICAgPSAwLjAwMDFcbiAgICAjIGxpZ2h0LnNoYWRvd0RhcmtuZXNzICAgICAgPSAwLjVcblxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhUmlnaHQgICAgPSAgNVxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhTGVmdCAgICAgPSAtNVxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhVG9wICAgICAgPSAgNVxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhQm90dG9tICAgPSAtNVxuXG4gICAgIyBsaWdodC5zaGFkb3dNYXBXaWR0aCAgICAgID0gMjA0OFxuICAgICMgbGlnaHQuc2hhZG93TWFwSGVpZ2h0ICAgICA9IDIwNDhcblxuXG4gICAgIyBoZWxwZXIgPSBuZXcgVEhSRUUuU3BvdExpZ2h0SGVscGVyKGxpZ2h0LCAxKVxuICAgICMgQGFkZChoZWxwZXIpXG5cbiAgICBzcGVlZCA9XG4gICAgICB4OiBNYXRoLnJhbmRvbSgpICogMC4wMDVcbiAgICAgIHk6IE1hdGgucmFuZG9tKCkgKiAwLjAwNVxuICAgICAgejogTWF0aC5yYW5kb20oKSAqIDAuMDA1XG5cbiAgICBAY3ViZS51cGRhdGUgPSAtPlxuICAgICAgQHJvdGF0aW9uLnggKz0gc3BlZWQueFxuICAgICAgQHJvdGF0aW9uLnkgKz0gc3BlZWQueVxuICAgICAgQHJvdGF0aW9uLnogKz0gc3BlZWQuelxuXG4gIHRpbWU6IDBcbiAgdXBkYXRlOiAoZGVsdGEpLT5cbiAgICBzdXBlcihkZWx0YSlcbiAgICBAanVrZWJveC51cGRhdGUoZGVsdGEpXG5cbiAgICBAdGltZSArPSBkZWx0YVxuXG4gICAgaWYgQGp1a2Vib3guc3RhdGUgPT0gU1BBQ0UuSnVrZWJveC5JU19QTEFZSU5HXG4gICAgICBpZiBAanVrZWJveC5jdXJyZW50IGFuZCBAanVrZWJveC5jdXJyZW50LnNvdW5kLnBhdXNlZFxuICAgICAgICBAZXF1YWxpemVyLm11dGUoKVxuICAgICAgZWxzZSBpZiBAd2F2ZWZvcm1EYXRhLmhhc093blByb3BlcnR5KCdtb25vJylcbiAgICAgICAgQGVxdWFsaXplci5zZXRWYWx1ZXMoQHdhdmVmb3JtRGF0YS5tb25vKVxuXG4gICAgICAjIGlmICFAanVrZWJveC5jdXJyZW50LnNvdW5kLmlzUGxheWluZygpXG4gICAgICAjICAgQGVxdWFsaXplci5tdXRlKClcbiAgICAgICMgZWxzZVxuICAgICAgIyAgIHRtcCA9IFtdXG4gICAgICAjICAgZm9yIHYsIGkgaW4gQGp1a2Vib3guY3VycmVudC5zb3VuZC5nZXRXYXZlZm9ybSgpXG4gICAgICAjICAgICB0bXAucHVzaCh2KSBpZiBpJTggPT0gMFxuXG4gICAgICAjICAgdmFsdWVzID0gQXJyYXkodG1wLmxlbmd0aClcbiAgICAgICMgICBmb3IgaSBpbiBbMC4uKCh0bXAubGVuZ3RoKi41KS0xKV1cbiAgICAgICMgICAgIHZhbHVlc1tpXSA9IHZhbHVlc1t0bXAubGVuZ3RoLTEtaV0gPSB0bXBbaV1cblxuICAgICAgIyAgIEBlcXVhbGl6ZXIuc2V0VmFsdWVzKHZhbHVlcylcblxuICBfd2hpbGVwbGF5aW5nOiA9PlxuICAgIHNvdW5kID0gQGp1a2Vib3guY3VycmVudC5zb3VuZFxuXG4gICAgZGF0YXMgPSBBcnJheSgyNTYpXG4gICAgZm9yIGkgaW4gWzAuLjEyN11cbiAgICAgIHZhbHVlID0gTWF0aC5tYXgoc291bmQud2F2ZWZvcm1EYXRhLmxlZnRbaV0sIHNvdW5kLndhdmVmb3JtRGF0YS5yaWdodFtpXSlcbiAgICAgIGRhdGFzW2ldID0gZGF0YXNbMjU1LWldID0gdmFsdWUgKiBNYXRoLm1heChzb3VuZC5wZWFrRGF0YS5sZWZ0LCBzb3VuZC5wZWFrRGF0YS5sZWZ0KVxuXG4gICAgQHdhdmVmb3JtRGF0YS5tb25vICAgPSBkYXRhc1xuICAgIEB3YXZlZm9ybURhdGEuc3RlcmVvID0gc291bmQud2F2ZWZvcm1EYXRhXG4iXX0=