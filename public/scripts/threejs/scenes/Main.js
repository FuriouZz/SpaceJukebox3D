var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.MainScene = (function(_super) {
  __extends(MainScene, _super);

  MainScene.prototype.equalizer = null;

  MainScene.prototype.jukebox = null;

  MainScene.prototype.waveformData = null;

  function MainScene() {
    this._whileplaying = __bind(this._whileplaying, this);
    this._eJukeboxIsStopped = __bind(this._eJukeboxIsStopped, this);
    this._eTrackOnAdd = __bind(this._eTrackOnAdd, this);
    var middlePoint, options;
    MainScene.__super__.constructor.apply(this, arguments);
    middlePoint = new THREE.Vector3(0, 0, 0);
    options = {
      minLength: 0,
      maxLength: 100,
      radius: 200,
      absolute: false,
      lineForceDown: .5,
      lineForceUp: 1
    };
    this.equalizer = new SPACE.Equalizer(middlePoint, options);
    this.add(this.equalizer);
    this.jukebox = new SPACE.Jukebox();
    this.jukebox.whileplaying = this._whileplaying;
    this.jukebox.predefinedPlaylist();
    this.spaceship = new SPACE.Spaceship(middlePoint, this.equalizer.radius);
    this.add(this.spaceship);
    this.setupSomething();
    this.waveformData = {};
    this._events();
  }

  MainScene.prototype._events = function() {
    document.addEventListener(JUKEBOX.TRACK_ON_ADD.type, this._eTrackOnAdd);
    return document.addEventListener(JUKEBOX.IS_STOPPED.type, this._eJukeboxIsStopped);
  };

  MainScene.prototype._eTrackOnAdd = function(e) {
    var track;
    track = e.object.track;
    track.spaceship = null;
    return _H.trigger(JUKEBOX.TRACK_ADDED, {
      track: track
    });
  };

  MainScene.prototype._eJukeboxIsStopped = function(e) {
    return this.equalizer.mute();
  };

  MainScene.prototype.setupSomething = function() {
    var circle, g, light, m;
    g = new THREE.SphereGeometry();
    m = new THREE.MeshLambertMaterial({
      color: 0xFFAA22
    });
    circle = new THREE.Mesh(g, m);
    circle.castShadow = true;
    circle.receiveShadow = true;
    this.add(circle);
    circle.update = function() {
      this.rotation.x += .01;
      this.rotation.y -= .01;
      return this.rotation.z += .01;
    };
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(500, 500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .6);
    light.position.set(-500, 500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(500, -500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(-500, -500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(500, 500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(-500, 500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(500, -500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(-500, -500, -500);
    return this.add(light);
  };

  MainScene.prototype.update = function(delta) {
    MainScene.__super__.update.call(this, delta);
    return this.jukebox.update(delta);
  };

  MainScene.prototype._whileplaying = function() {
    var datas, i, sound, value, _i;
    sound = this.jukebox.current.sound;
    datas = Array(256);
    for (i = _i = 0; _i <= 127; i = ++_i) {
      value = Math.max(sound.waveformData.left[i], sound.waveformData.right[i]);
      datas[i] = datas[255 - i] = value;
    }
    if (this.jukebox.current && this.jukebox.current.sound.paused) {
      this.equalizer.mute();
    } else if (this.waveformData.hasOwnProperty('mono')) {
      this.equalizer.setValues(this.waveformData.mono);
    }
    this.waveformData.mono = datas;
    return this.waveformData.stereo = sound.waveformData;
  };

  return MainScene;

})(SPACE.Scene);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvc2NlbmVzL01haW4uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUE7O2lTQUFBOztBQUFBLEtBQVcsQ0FBQztBQUVWLDhCQUFBLENBQUE7O0FBQUEsc0JBQUEsU0FBQSxHQUFXLElBQVgsQ0FBQTs7QUFBQSxzQkFDQSxPQUFBLEdBQVcsSUFEWCxDQUFBOztBQUFBLHNCQUdBLFlBQUEsR0FBYyxJQUhkLENBQUE7O0FBS2EsRUFBQSxtQkFBQSxHQUFBO0FBQ1gseURBQUEsQ0FBQTtBQUFBLG1FQUFBLENBQUE7QUFBQSx1REFBQSxDQUFBO0FBQUEsUUFBQSxvQkFBQTtBQUFBLElBQUEsNENBQUEsU0FBQSxDQUFBLENBQUE7QUFBQSxJQUVBLFdBQUEsR0FBa0IsSUFBQSxLQUFLLENBQUMsT0FBTixDQUFjLENBQWQsRUFBaUIsQ0FBakIsRUFBb0IsQ0FBcEIsQ0FGbEIsQ0FBQTtBQUFBLElBR0EsT0FBQSxHQUNFO0FBQUEsTUFBQSxTQUFBLEVBQVcsQ0FBWDtBQUFBLE1BQ0EsU0FBQSxFQUFXLEdBRFg7QUFBQSxNQUVBLE1BQUEsRUFBUSxHQUZSO0FBQUEsTUFHQSxRQUFBLEVBQVUsS0FIVjtBQUFBLE1BSUEsYUFBQSxFQUFlLEVBSmY7QUFBQSxNQUtBLFdBQUEsRUFBYSxDQUxiO0tBSkYsQ0FBQTtBQUFBLElBV0EsSUFBQyxDQUFBLFNBQUQsR0FBaUIsSUFBQSxLQUFLLENBQUMsU0FBTixDQUFnQixXQUFoQixFQUE2QixPQUE3QixDQVhqQixDQUFBO0FBQUEsSUFZQSxJQUFDLENBQUEsR0FBRCxDQUFLLElBQUMsQ0FBQSxTQUFOLENBWkEsQ0FBQTtBQUFBLElBY0EsSUFBQyxDQUFBLE9BQUQsR0FBZSxJQUFBLEtBQUssQ0FBQyxPQUFOLENBQUEsQ0FkZixDQUFBO0FBQUEsSUFlQSxJQUFDLENBQUEsT0FBTyxDQUFDLFlBQVQsR0FBd0IsSUFBQyxDQUFBLGFBZnpCLENBQUE7QUFBQSxJQWdCQSxJQUFDLENBQUEsT0FBTyxD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QSxHQUFRLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFLLENBQUEsQ0FBQSxDQUFqQyxFQUFxQyxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQU0sQ0FBQSxDQUFBLENBQTlELENBQVIsQ0FBQTtBQUFBLE1BRUEsS0FBTSxDQUFBLENBQUEsQ0FBTixHQUFXLEtBQU0sQ0FBQSxHQUFBLEdBQUksQ0FBSixDQUFOLEdBQWUsS0FGMUIsQ0FERjtBQUFBLEtBSEE7QUFRQSxJQUFBLElBQUcsSUFBQyxDQUFBLE9BQU8sQ0FBQyxPQUFULElBQXFCLElBQUMsQ0FBQSxPQUFPLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxNQUEvQztBQUNFLE1BQUEsSUFBQyxDQUFBLFNBQVMsQ0FBQyxJQUFYLENBQUEsQ0FBQSxDQURGO0tBQUEsTUFFSyxJQUFHLElBQUMsQ0FBQSxZQUFZLENBQUMsY0FBZCxDQUE2QixNQUE3QixDQUFIO0FBQ0gsTUFBQSxJQUFDLENBQUEsU0FBUyxDQUFDLFNBQVgsQ0FBcUIsSUFBQyxDQUFBLFlBQVksQ0FBQyxJQUFuQyxDQUFBLENBREc7S0FWTDtBQUFBLElBYUEsSUFBQyxDQUFBLFlBQVksQ0FBQyxJQUFkLEdBQXVCLEtBYnZCLENBQUE7V0FjQSxJQUFDLENBQUEsWUFBWSxDQUFDLE1BQWQsR0FBdUIsS0FBSyxDQUFDLGFBZmhCO0VBQUEsQ0FsS2YsQ0FBQTs7bUJBQUE7O0dBRjRCLEtBQUssQ0FBQyxNQUFwQyxDQUFBIiwiZmlsZSI6InRocmVlanMvc2NlbmVzL01haW4uanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTUEFDRS5NYWluU2NlbmUgZXh0ZW5kcyBTUEFDRS5TY2VuZVxuXG4gIGVxdWFsaXplcjogbnVsbFxuICBqdWtlYm94OiAgIG51bGxcblxuICB3YXZlZm9ybURhdGE6IG51bGxcblxuICBjb25zdHJ1Y3RvcjogLT5cbiAgICBzdXBlclxuXG4gICAgbWlkZGxlUG9pbnQgPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKVxuICAgIG9wdGlvbnMgICAgID1cbiAgICAgIG1pbkxlbmd0aDogMFxuICAgICAgbWF4TGVuZ3RoOiAxMDBcbiAgICAgIHJhZGl1czogMjAwXG4gICAgICBhYnNvbHV0ZTogZmFsc2VcbiAgICAgIGxpbmVGb3JjZURvd246IC41XG4gICAgICBsaW5lRm9yY2VVcDogMVxuXG4gICAgQGVxdWFsaXplciA9IG5ldyBTUEFDRS5FcXVhbGl6ZXIobWlkZGxlUG9pbnQsIG9wdGlvbnMpXG4gICAgQGFkZChAZXF1YWxpemVyKVxuXG4gICAgQGp1a2Vib3ggPSBuZXcgU1BBQ0UuSnVrZWJveCgpXG4gICAgQGp1a2Vib3gud2hpbGVwbGF5aW5nID0gQF93aGlsZXBsYXlpbmdcbiAgICBAanVrZWJveC5wcmVkZWZpbmVkUGxheWxpc3QoKVxuXG4gICAgQHNwYWNlc2hpcCA9IG5ldyBTUEFDRS5TcGFjZXNoaXAobWlkZGxlUG9pbnQsIEBlcXVhbGl6ZXIucmFkaXVzKVxuICAgIEBhZGQoQHNwYWNlc2hpcClcblxuICAgIEBzZXR1cFNvbWV0aGluZygpXG5cbiAgICBAd2F2ZWZvcm1EYXRhID0ge31cblxuICAgIEBfZXZlbnRzKClcblxuICBfZXZlbnRzOiAtPlxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoSlVLRUJPWC5UUkFDS19PTl9BREQudHlwZSwgQF9lVHJhY2tPbkFkZClcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKEpVS0VCT1guSVNfU1RPUFBFRC50eXBlLCBAX2VKdWtlYm94SXNTdG9wcGVkKVxuXG4gIF9lVHJhY2tPbkFkZDogKGUpPT5cbiAgICAjIHNwYWNlc2hpcCA9IG5ldyBTUEFDRS5TcGFjZXNoaXAoQGVxdWFsaXplci5jZW50ZXIsIEBlcXVhbGl6ZXIucmFkaXVzKVxuICAgICMgQGFkZENoaWxkKHNwYWNlc2hpcClcblxuICAgIHRyYWNrID0gZS5vYmplY3QudHJhY2tcbiAgICB0cmFjay5zcGFjZXNoaXAgPSBudWxsI3NwYWNlc2hpcFxuICAgIF9ILnRyaWdnZXIoSlVLRUJPWC5UUkFDS19BRERFRCwgeyB0cmFjazogdHJhY2sgfSlcblxuICAgICMgQGRvdHRlZCA9IG5ldyBTUEFDRS5Eb3R0ZWRMaW5lKHRyYWNrKVxuICAgICMgQGFkZENoaWxkKEBkb3R0ZWQpXG5cbiAgX2VKdWtlYm94SXNTdG9wcGVkOiAoZSk9PlxuICAgIEBlcXVhbGl6ZXIubXV0ZSgpXG5cbiAgc2V0dXBTb21ldGhpbmc6IC0+XG4gICAgIyAjIEN1YmVcbiAgICAjIGcgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoMTAwLCAxMDAsIDEwMClcbiAgICAjIG0gPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweDAwODhmZiwgc2hhZGluZzogVEhSRUUuRmxhdFNoYWRpbmcgfSlcbiAgICAjIEBjdWJlID0gbmV3IFRIUkVFLk1lc2goZywgbSlcbiAgICAjICMgQGN1YmUucG9zaXRpb24uc2V0WigxMDApXG4gICAgIyBAY3ViZS5yb3RhdGlvbi5zZXQoTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSwgTWF0aC5yYW5kb20oKSlcbiAgICAjIEBjdWJlLmNhc3RTaGFkb3cgPSB0cnVlXG4gICAgIyBAY3ViZS5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgICMgQGFkZChAY3ViZSlcblxuICAgIGcgPSBuZXcgVEhSRUUuU3BoZXJlR2VvbWV0cnkoKVxuICAgIG0gPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGQUEyMiB9KVxuICAgIGNpcmNsZSA9IG5ldyBUSFJFRS5NZXNoKGcsIG0pXG4gICAgY2lyY2xlLmNhc3RTaGFkb3cgPSB0cnVlXG4gICAgY2lyY2xlLnJlY2VpdmVTaGFkb3cgPSB0cnVlXG4gICAgQGFkZChjaXJjbGUpXG5cbiAgICBjaXJjbGUudXBkYXRlID0gLT5cbiAgICAgIEByb3RhdGlvbi54ICs9IC4wMVxuICAgICAgQHJvdGF0aW9uLnkgLT0gLjAxXG4gICAgICBAcm90YXRpb24ueiArPSAuMDFcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjIgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggNTAwLCA1MDAsIDUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhGRkZGRkYsIDEuOCouNiApXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KCAtNTAwLCA1MDAsIDUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhGRkZGRkYsIDEuOCouMiApXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KCA1MDAsIC01MDAsIDUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhGRkZGRkYsIDEuOCouMiApXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KCAtNTAwLCAtNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjEgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggNTAwLCA1MDAsIC01MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjEgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgNTAwLCAtNTAwIClcbiAgICBAYWRkKCBsaWdodCApXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4xIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIDUwMCwgLTUwMCwgLTUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhGRkZGRkYsIDEuOCouMSApXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KCAtNTAwLCAtNTAwLCAtNTAwIClcbiAgICBAYWRkKCBsaWdodCApXG5cbiAgICAjIGxpZ2h0LmNhc3RTaGFkb3cgPSB0cnVlXG5cbiAgICAjIGxpZ2h0LnNoYWRvd0NhbWVyYU5lYXIgICAgPSA3MDBcbiAgICAjIGxpZ2h0LnNoYWRvd0NhbWVyYUZhciAgICAgPSBtYW5hZ2VyLl9jYW1lcmEuZmFyXG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFGb3YgICAgID0gNTBcblxuICAgICMgbGlnaHQuc2hhZG93Q2FzY2FkZSA9IHRydWVcblxuICAgICMgbGlnaHQuc2hhZG93QmlhcyAgICAgICAgICA9IDAuMDAwMVxuICAgICMgbGlnaHQuc2hhZG93RGFya25lc3MgICAgICA9IDAuNVxuXG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFSaWdodCAgICA9ICA1XG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFMZWZ0ICAgICA9IC01XG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFUb3AgICAgICA9ICA1XG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFCb3R0b20gICA9IC01XG5cbiAgICAjIGxpZ2h0LnNoYWRvd01hcFdpZHRoICAgICAgPSAyMDQ4XG4gICAgIyBsaWdodC5zaGFkb3dNYXBIZWlnaHQgICAgID0gMjA0OFxuXG5cbiAgICAjIGhlbHBlciA9IG5ldyBUSFJFRS5TcG90TGlnaHRIZWxwZXIobGlnaHQsIDEpXG4gICAgIyBAYWRkKGhlbHBlcilcblxuICAgICMgc3BlZWQgPVxuICAgICMgICB4OiBNYXRoLnJhbmRvbSgpICogMC4wMDVcbiAgICAjICAgeTogTWF0aC5yYW5kb20oKSAqIDAuMDA1XG4gICAgIyAgIHo6IE1hdGgucmFuZG9tKCkgKiAwLjAwNVxuXG4gICAgIyBAY3ViZS51cGRhdGUgPSAtPlxuICAgICMgICBAcm90YXRpb24ueCArPSBzcGVlZC54XG4gICAgIyAgIEByb3RhdGlvbi55ICs9IHNwZWVkLnlcbiAgICAjICAgQHJvdGF0aW9uLnogKz0gc3BlZWQuelxuXG4gIHVwZGF0ZTogKGRlbHRhKS0+XG4gICAgc3VwZXIoZGVsdGEpXG4gICAgQGp1a2Vib3gudXBkYXRlKGRlbHRhKVxuXG4gICAgIyBpZiBAanVrZWJveC5zdGF0ZSA9PSBTUEFDRS5KdWtlYm94LklTX1BMQVlJTkdcbiAgICAjICAgaWYgQGp1a2Vib3guY3VycmVudCBhbmQgQGp1a2Vib3guY3VycmVudC5zb3VuZC5wYXVzZWRcbiAgICAjICAgICBAZXF1YWxpemVyLm11dGUoKVxuICAgICMgICBlbHNlIGlmIEB3YXZlZm9ybURhdGEuaGFzT3duUHJvcGVydHkoJ21vbm8nKVxuICAgICMgICAgIEBlcXVhbGl6ZXIuc2V0VmFsdWVzKEB3YXZlZm9ybURhdGEubW9ubylcblxuICAgICAgIyBpZiAhQGp1a2Vib3guY3VycmVudC5zb3VuZC5pc1BsYXlpbmcoKVxuICAgICAgIyAgIEBlcXVhbGl6ZXIubXV0ZSgpXG4gICAgICAjIGVsc2VcbiAgICAgICMgICB0bXAgPSBbXVxuICAgICAgIyAgIGZvciB2LCBpIGluIEBqdWtlYm94LmN1cnJlbnQuc291bmQuZ2V0V2F2ZWZvcm0oKVxuICAgICAgIyAgICAgdG1wLnB1c2godikgaWYgaSU4ID09IDBcblxuICAgICAgIyAgIHZhbHVlcyA9IEFycmF5KHRtcC5sZW5ndGgpXG4gICAgICAjICAgZm9yIGkgaW4gWzAuLigodG1wLmxlbmd0aCouNSktMSldXG4gICAgICAjICAgICB2YWx1ZXNbaV0gPSB2YWx1ZXNbdG1wLmxlbmd0aC0xLWldID0gdG1wW2ldXG5cbiAgICAgICMgICBAZXF1YWxpemVyLnNldFZhbHVlcyh2YWx1ZXMpXG5cbiAgX3doaWxlcGxheWluZzogPT5cbiAgICBzb3VuZCA9IEBqdWtlYm94LmN1cnJlbnQuc291bmRcblxuICAgIGRhdGFzID0gQXJyYXkoMjU2KVxuICAgIGZvciBpIGluIFswLi4xMjddXG4gICAgICB2YWx1ZSA9IE1hdGgubWF4KHNvdW5kLndhdmVmb3JtRGF0YS5sZWZ0W2ldLCBzb3VuZC53YXZlZm9ybURhdGEucmlnaHRbaV0pXG4gICAgICAjIGRhdGFzW2ldID0gZGF0YXNbMjU1LWldID0gdmFsdWUgKiBNYXRoLm1heChzb3VuZC5wZWFrRGF0YS5sZWZ0LCBzb3VuZC5wZWFrRGF0YS5sZWZ0KVxuICAgICAgZGF0YXNbaV0gPSBkYXRhc1syNTUtaV0gPSB2YWx1ZVxuXG4gICAgaWYgQGp1a2Vib3guY3VycmVudCBhbmQgQGp1a2Vib3guY3VycmVudC5zb3VuZC5wYXVzZWRcbiAgICAgIEBlcXVhbGl6ZXIubXV0ZSgpXG4gICAgZWxzZSBpZiBAd2F2ZWZvcm1EYXRhLmhhc093blByb3BlcnR5KCdtb25vJylcbiAgICAgIEBlcXVhbGl6ZXIuc2V0VmFsdWVzKEB3YXZlZm9ybURhdGEubW9ubylcblxuICAgIEB3YXZlZm9ybURhdGEubW9ubyAgID0gZGF0YXNcbiAgICBAd2F2ZWZvcm1EYXRhLnN0ZXJlbyA9IHNvdW5kLndhdmVmb3JtRGF0YVxuIl19