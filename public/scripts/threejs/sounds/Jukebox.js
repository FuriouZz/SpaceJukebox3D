var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

SPACE.Jukebox = (function() {
  Jukebox.prototype.current = null;

  Jukebox.prototype.playlist = null;

  Jukebox.prototype.state = null;

  Jukebox.prototype.SC = null;

  Jukebox.IS_PLAYING = 'IS_PLAYING';

  Jukebox.IS_STOPPED = 'IS_STOPPED';

  function Jukebox() {
    this._onfinish = __bind(this._onfinish, this);
    this._onplay = __bind(this._onplay, this);
    this._starting = __bind(this._starting, this);
    this._eTrackAdded = __bind(this._eTrackAdded, this);
    this.SC = new SPACE.SoundCloud(SPACE.SOUNDCLOUD.id);
    this.add('https://soundcloud.com/chonch-2/mouais');
    this.playlist = [];
    this._events();
  }

  Jukebox.prototype._events = function() {
    return document.addEventListener(JUKEBOX.TRACK_ADDED.type, this._eTrackAdded);
  };

  Jukebox.prototype._eTrackAdded = function(e) {
    var track;
    track = e.object.track;
    track.pendingDuration = this._calcPending(this.playlist.length - 1);
    this.playlist.push(e.object.track);
    return SPACE.LOG('Sound added: ' + e.object.track.data.title);
  };

  Jukebox.prototype.predefinedPlaylist = function() {
    var list, url, _i, _len, _results;
    list = ['https://soundcloud.com/huhwhatandwhere/sets/supreme-laziness-the-celestics'];
    list = HELPERS.shuffle(list);
    _results = [];
    for (_i = 0, _len = list.length; _i < _len; _i++) {
      url = list[_i];
      _results.push(this.add(url));
    }
    return _results;
  };

  Jukebox.prototype.setState = function(state) {
    this.state = state;
    switch (state) {
      case SPACE.Jukebox.IS_PLAYING:
        return SPACE.LOG('Next: ' + this.current.data.title);
      default:
        return SPACE.LOG('jukeboxisstopped');
    }
  };

  Jukebox.prototype.list = function() {
    var list, track, _i, _len, _ref;
    list = [];
    _ref = this.playlist;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      track = _ref[_i];
      list.push({
        title: track.data.title,
        pendingDuration: track.pendingDuration
      });
    }
    return list;
  };

  Jukebox.prototype.add = function(soundOrPlaylist) {
    return this.SC.getSoundOrPlaylist(soundOrPlaylist, (function(_this) {
      return function(o) {
        var data, track, tracks, _i, _len, _results;
        tracks = null;
        if (o.hasOwnProperty('tracks')) {
          tracks = o.tracks;
        } else {
          tracks = [];
          tracks.push(o);
        }
        _results = [];
        for (_i = 0, _len = tracks.length; _i < _len; _i++) {
          data = tracks[_i];
          track = new SPACE.Track(data);
          _results.push(HELPERS.trigger(JUKEBOX.TRACK_ON_ADD, {
            track: track
          }));
        }
        return _results;
      };
    })(this));
  };

  Jukebox.prototype._calcPending = function(position) {
    var duration, i, track, _i, _len, _ref;
    duration = 0;
    _ref = this.playlist;
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      track = _ref[i];
      duration += track.data.duration;
      if (i === position) {
        break;
      }
    }
    return duration;
  };

  Jukebox.prototype.update = function(delta) {
    var i, track, _i, _len, _ref;
    _ref = this.playlist;
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      track = _ref[i];
      track.update(delta);
    }
    if (this.playlist.length > 0) {
      if (this.current === null) {
        return this.next();
      }
    }
  };

  Jukebox.prototype.next = function(track) {
    if (this.current) {
      this._onfinish();
    }
    this.current = this.playlist.shift();
    return this.SC.streamSound(this.current.data, this._starting, {
      onplay: this._onplay,
      onfinish: this._onfinish,
      onstop: this._onstop,
      whileplaying: this.whileplaying
    });
  };

  Jukebox.prototype._starting = function(sound) {
    return this.current.sound = sound;
  };

  Jukebox.prototype._onplay = function() {
    HELPERS.trigger(JUKEBOX.IS_PLAYING);
    return this.setState(SPACE.Jukebox.IS_PLAYING);
  };

  Jukebox.prototype._onfinish = function() {
    this.current.sound.stop();
    this.current.sound.destruct();
    this.current = null;
    this.eq.mute();
    HELPERS.trigger(JUKEBOX.IS_STOPPED);
    return this.setState(SPACE.Jukebox.IS_STOPPED);
  };

  return Jukebox;

})();

SPACE.Jukebox.__defineGetter__('IS_PLAYING', function() {
  return 'IS_PLAYING';
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvc291bmRzL0p1a2Vib3guY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsa0ZBQUE7O0FBQUEsS0FBVyxDQUFDO0FBRVYsb0JBQUEsT0FBQSxHQUFTLElBQVQsQ0FBQTs7QUFBQSxvQkFDQSxRQUFBLEdBQVUsSUFEVixDQUFBOztBQUFBLG9CQUdBLEtBQUEsR0FBTyxJQUhQLENBQUE7O0FBQUEsb0JBS0EsRUFBQSxHQUFJLElBTEosQ0FBQTs7QUFBQSxFQVFBLE9BQUMsQ0FBQSxVQUFELEdBQWEsWUFSYixDQUFBOztBQUFBLEVBU0EsT0FBQyxDQUFBLFVBQUQsR0FBYSxZQVRiLENBQUE7O0FBV2EsRUFBQSxpQkFBQSxHQUFBO0FBQ1gsaURBQUEsQ0FBQTtBQUFBLDZDQUFBLENBQUE7QUFBQSxpREFBQSxDQUFBO0FBQUEsdURBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQyxDQUFBLEVBQUQsR0FBVSxJQUFBLEtBQUssQ0FBQyxVQUFOLENBQWlCLEtBQUssQ0FBQyxVQUFVLENBQUMsRUFBbEMsQ0FBVixDQUFBO0FBQUEsSUFZQSxJQUFDLENBQUEsR0FBRCxDQUFLLHdDQUFMLENBWkEsQ0FBQTtBQUFBLElBY0EsSUFBQyxDQUFBLFFBQUQsR0FBWSxFQWRaLENBQUE7QUFBQSxJQWVBLElBQUMsQ0FBQSxPQUFELENBQUEsQ0FmQSxDQURXO0VBQUEsQ0FYYjs7QUFBQSxvQkE2QkEsT0FBQSxHQUFTLFNBQUEsR0FBQTtXQUNQLFFBQVEsQ0FBQyxnQkFBVCxDQUEwQixPQUFPLENBQUMsV0FBVyxDQUFDLElBQTlDLEVBQW9ELElBQUMsQ0FBQSxZQUFyRCxFQURPO0VBQUEsQ0E3QlQsQ0FBQTs7QUFBQSxvQkFnQ0EsWUFBQSxHQUFjLFNBQUMsQ0FBRCxHQUFBO0FBQ1osUUFBQSxLQUFBO0FBQUEsSUFBQSxLQUFBLEdBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFqQixDQUFBO0FBQUEsSUFDQSxLQUFLLENBQUMsZUFBTixHQUF3QixJ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QUFULEdBQWlCLE1BRFI7RUFBQSxDQTFIWCxDQUFBOztBQUFBLG9CQTZIQSxPQUFBLEdBQVMsU0FBQSxHQUFBO0FBQ1AsSUFBQSxPQUFPLENBQUMsT0FBUixDQUFnQixPQUFPLENBQUMsVUFBeEIsQ0FBQSxDQUFBO1dBQ0EsSUFBQyxDQUFBLFFBQUQsQ0FBVSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQXhCLEVBRk87RUFBQSxDQTdIVCxDQUFBOztBQUFBLG9CQWlJQSxTQUFBLEdBQVcsU0FBQSxHQUFBO0FBQ1QsSUFBQSxJQUFDLENBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFmLENBQUEsQ0FBQSxDQUFBO0FBQUEsSUFDQSxJQUFDLENBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFmLENBQUEsQ0FEQSxDQUFBO0FBQUEsSUFFQSxJQUFDLENBQUEsT0FBRCxHQUFXLElBRlgsQ0FBQTtBQUFBLElBR0EsSUFBQyxDQUFBLEVBQUUsQ0FBQyxJQUFKLENBQUEsQ0FIQSxDQUFBO0FBQUEsSUFJQSxPQUFPLENBQUMsT0FBUixDQUFnQixPQUFPLENBQUMsVUFBeEIsQ0FKQSxDQUFBO1dBS0EsSUFBQyxDQUFBLFFBQUQsQ0FBVSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQXhCLEVBTlM7RUFBQSxDQWpJWCxDQUFBOztpQkFBQTs7SUFGRixDQUFBOztBQUFBLEtBMklLLENBQUMsT0FBTyxDQUFDLGdCQUFkLENBQStCLFlBQS9CLEVBQTZDLFNBQUEsR0FBQTtBQUFHLFNBQU8sWUFBUCxDQUFIO0FBQUEsQ0FBN0MsQ0EzSUEsQ0FBQSIsImZpbGUiOiJ0aHJlZWpzL3NvdW5kcy9KdWtlYm94LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgU1BBQ0UuSnVrZWJveFxuXG4gIGN1cnJlbnQ6IG51bGxcbiAgcGxheWxpc3Q6IG51bGxcblxuICBzdGF0ZTogbnVsbFxuXG4gIFNDOiBudWxsXG5cbiAgIyAjIFNUQVRFU1xuICBASVNfUExBWUlORzogJ0lTX1BMQVlJTkcnXG4gIEBJU19TVE9QUEVEOiAnSVNfU1RPUFBFRCdcblxuICBjb25zdHJ1Y3RvcjogLT5cbiAgICBAU0MgPSBuZXcgU1BBQ0UuU291bmRDbG91ZChTUEFDRS5TT1VORENMT1VELmlkKVxuXG4gICAgIyBAU0MuZ2V0U291bmRVcmwoJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vY2hvbmNoLTIvbW91YWlzJywgKHVybCktPlxuICAgICMgICBkYW5jZXIgPSBuZXcgRGFuY2VyKClcblxuICAgICMgICAjIFVzaW5nIGFuIGF1ZGlvIG9iamVjdFxuICAgICMgICBhID0gbmV3IEF1ZGlvKClcbiAgICAjICAgYS5zcmMgPSB1cmxcbiAgICAjICAgZGFuY2VyLmxvYWQoIGEgKVxuICAgICMgICBkYW5jZXIucGxheSgpXG4gICAgIyApXG5cbiAgICBAYWRkKCdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL21vdWFpcycpXG5cbiAgICBAcGxheWxpc3QgPSBbXVxuICAgIEBfZXZlbnRzKClcblxuICBfZXZlbnRzOiAtPlxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoSlVLRUJPWC5UUkFDS19BRERFRC50eXBlLCBAX2VUcmFja0FkZGVkKVxuXG4gIF9lVHJhY2tBZGRlZDogKGUpPT5cbiAgICB0cmFjayA9IGUub2JqZWN0LnRyYWNrXG4gICAgdHJhY2sucGVuZGluZ0R1cmF0aW9uID0gQF9jYWxjUGVuZGluZyhAcGxheWxpc3QubGVuZ3RoLTEpXG4gICAgQHBsYXlsaXN0LnB1c2goZS5vYmplY3QudHJhY2spXG5cbiAgICAjIEBwbGF5bGlzdCA9IEhFTFBFUlMuc2h1ZmZsZShAcGxheWxpc3QpXG4gICAgU1BBQ0UuTE9HKCdTb3VuZCBhZGRlZDogJyArIGUub2JqZWN0LnRyYWNrLmRhdGEudGl0bGUpXG5cbiAgcHJlZGVmaW5lZFBsYXlsaXN0OiAtPlxuICAgIGxpc3QgPSBbXG4gICAgICAjICdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL2NvdXJ0ZS1kYW5zZS1tYWNhYnJlJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9jaG9uY2gtMi9tb3VhaXMnXG4gICAgICAjICdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL2NhY2Fjby0yJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9jaG9uY2gtMi9kdW9kZW51bSdcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vY2hvbmNoLTIvbGl0dGxlLWdyZWVuLW1vbmtleSdcbiAgICAgICdodHRwczovL3NvdW5kY2xvdWQuY29tL2h1aHdoYXRhbmR3aGVyZS9zZXRzL3N1cHJlbWUtbGF6aW5lc3MtdGhlLWNlbGVzdGljcydcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vdG9tbWlzY2gvc2V0cy90b20tbWlzY2gtc291bGVjdGlvbi13aGl0ZSdcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vcHJvZmVzc29ya2xpcS9zZXRzL3RyYWNrbWFuaWEtdmFsbGV5LW9zdCdcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vcHJvZmVzc29ya2xpcS9zZXRzL3RyYWNrbWFuaWEtc3RhZGl1bS1vc3QnXG4gICAgXVxuXG4gICAgbGlzdCA9IEhFTFBFUlMuc2h1ZmZsZShsaXN0KVxuICAgIGZvciB1cmwgaW4gbGlzdFxuICAgICAgQGFkZCh1cmwpXG5cbiAgc2V0U3RhdGU6IChzdGF0ZSktPlxuICAgIEBzdGF0ZSA9IHN0YXRlXG4gICAgc3dpdGNoKHN0YXRlKVxuICAgICAgd2hlbiBTUEFDRS5KdWtlYm94LklTX1BMQVlJTkdcbiAgICAgICAgU1BBQ0UuTE9HKCdOZXh0OiAnICsgQGN1cnJlbnQuZGF0YS50aXRsZSlcbiAgICAgIGVsc2VcbiAgICAgICAgU1BBQ0UuTE9HKCdqdWtlYm94aXNzdG9wcGVkJylcblxuICBsaXN0OiAtPlxuICAgIGxpc3QgPSBbXVxuICAgIGZvciB0cmFjayBpbiBAcGxheWxpc3RcbiAgICAgIGxpc3QucHVzaCh7dGl0bGU6IHRyYWNrLmRhdGEudGl0bGUsIHBlbmRpbmdEdXJhdGlvbjogdHJhY2sucGVuZGluZ0R1cmF0aW9ufSlcbiAgICByZXR1cm4gbGlzdFxuXG4gIGFkZDogKHNvdW5kT3JQbGF5bGlzdCktPlxuICAgIEBTQy5nZXRTb3VuZE9yUGxheWxpc3Qoc291bmRPclBsYXlsaXN0LCAobyk9PlxuICAgICAgdHJhY2tzID0gbnVsbFxuICAgICAgaWYgby5oYXNPd25Qcm9wZXJ0eSgndHJhY2tzJylcbiAgICAgICAgdHJhY2tzID0gby50cmFja3NcbiAgICAgIGVsc2VcbiAgICAgICAgdHJhY2tzID0gW11cbiAgICAgICAgdHJhY2tzLnB1c2gobylcblxuICAgICAgZm9yIGRhdGEgaW4gdHJhY2tzXG4gICAgICAgIHRyYWNrID0gbmV3IFNQQUNFLlRyYWNrKGRhdGEpXG4gICAgICAgIEhFTFBFUlMudHJpZ2dlcihKVUtFQk9YLlRSQUNLX09OX0FERCwgeyB0cmFjazogdHJhY2sgfSlcbiAgICApXG5cbiAgX2NhbGNQZW5kaW5nOiAocG9zaXRpb24pLT5cbiAgICBkdXJhdGlvbiA9IDBcbiAgICBmb3IgdHJhY2ssIGkgaW4gQHBsYXlsaXN0XG4gICAgICBkdXJhdGlvbiArPSB0cmFjay5kYXRhLmR1cmF0aW9uXG4gICAgICBicmVhayBpZiBpID09IHBvc2l0aW9uXG4gICAgcmV0dXJuIGR1cmF0aW9uXG5cbiAgdXBkYXRlOiAoZGVsdGEpLT5cbiAgICBmb3IgdHJhY2ssIGkgaW4gQHBsYXlsaXN0XG4gICAgICB0cmFjay51cGRhdGUoZGVsdGEpXG5cbiAgICBpZiBAcGxheWxpc3QubGVuZ3RoID4gMFxuICAgICAgQG5leHQoKSBpZiBAY3VycmVudCA9PSBudWxsXG5cbiAgbmV4dDogKHRyYWNrKS0+XG4gICAgQF9vbmZpbmlzaCgpIGlmIEBjdXJyZW50XG4gICAgQGN1cnJlbnQgPSBAcGxheWxpc3Quc2hpZnQoKVxuICAgICMgQGN1cnJlbnQuc3BhY2VzaGlwLnBhcmVudC5yZW1vdmVDaGlsZChAY3VycmVudC5zcGFjZXNoaXApXG5cbiAgICBAU0Muc3RyZWFtU291bmQoQGN1cnJlbnQuZGF0YSwgQF9zdGFydGluZywge1xuICAgICAgb25wbGF5ICAgICAgIDogQF9vbnBsYXlcbiAgICAgIG9uZmluaXNoICAgICA6IEBfb25maW5pc2hcbiAgICAgIG9uc3RvcCAgICAgICA6IEBfb25zdG9wXG4gICAgICB3aGlsZXBsYXlpbmcgOiBAd2hpbGVwbGF5aW5nXG4gICAgfSlcblxuICAgICMgZGFuY2VyID0gbmV3IERhbmNlcigpXG5cbiAgICAjICMgVXNpbmcgYW4gYXVkaW8gb2JqZWN0XG4gICAgIyBhID0gbmV3IEF1ZGlvKClcbiAgICAjIGEuc3JjID0gQGN1cnJlbnQuZGF0YS5zdHJlYW1fdXJsKyc/b2F1dGhfdG9rZW49JytAU0MudG9rZW5cbiAgICAjIGRhbmNlci5sb2FkKCBhIClcbiAgICAjIGRhbmNlci5wbGF5KClcbiAgICAjIEBfb25wbGF5KClcblxuICAgICMgQGN1cnJlbnQuc291bmQgPSBkYW5jZXJcblxuICBfc3RhcnRpbmc6IChzb3VuZCk9PlxuICAgIEBjdXJyZW50LnNvdW5kID0gc291bmRcblxuICBfb25wbGF5OiA9PlxuICAgIEhFTFBFUlMudHJpZ2dlcihKVUtFQk9YLklTX1BMQVlJTkcpXG4gICAgQHNldFN0YXRlKFNQQUNFLkp1a2Vib3guSVNfUExBWUlORylcblxuICBfb25maW5pc2g6ID0+XG4gICAgQGN1cnJlbnQuc291bmQuc3RvcCgpXG4gICAgQGN1cnJlbnQuc291bmQuZGVzdHJ1Y3QoKVxuICAgIEBjdXJyZW50ID0gbnVsbFxuICAgIEBlcS5tdXRlKClcbiAgICBIRUxQRVJTLnRyaWdnZXIoSlVLRUJPWC5JU19TVE9QUEVEKVxuICAgIEBzZXRTdGF0ZShTUEFDRS5KdWtlYm94LklTX1NUT1BQRUQpXG5cblNQQUNFLkp1a2Vib3guX19kZWZpbmVHZXR0ZXJfXygnSVNfUExBWUlORycsIC0+IHJldHVybiAnSVNfUExBWUlORycpXG4iXX0=