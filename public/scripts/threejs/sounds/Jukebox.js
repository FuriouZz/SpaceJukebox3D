var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

SPACE.Jukebox = (function() {
  Jukebox.prototype.current = null;

  Jukebox.prototype.playlist = null;

  Jukebox.prototype.state = null;

  Jukebox.prototype.SC = null;

  Jukebox.IS_PLAYING = 'IS_PLAYING';

  Jukebox.IS_STOPPED = 'IS_STOPPED';

  function Jukebox() {
    this._onfinish = __bind(this._onfinish, this);
    this._onplay = __bind(this._onplay, this);
    this._starting = __bind(this._starting, this);
    this._eTrackAdded = __bind(this._eTrackAdded, this);
    this.SC = new SPACE.SoundCloud(SPACE.SOUNDCLOUD.id, SPACE.SOUNDCLOUD.redirect_uri);
    this.playlist = [];
    this._events();
  }

  Jukebox.prototype._events = function() {
    return document.addEventListener(JUKEBOX.TRACK_ADDED.type, this._eTrackAdded);
  };

  Jukebox.prototype._eTrackAdded = function(e) {
    var track;
    track = e.object.track;
    track.pendingDuration = this._calcPending(this.playlist.length - 1);
    this.playlist.push(e.object.track);
    return SPACE.LOG('Sound added: ' + e.object.track.data.title);
  };

  Jukebox.prototype.predefinedPlaylist = function() {
    var list, url, _i, _len, _results;
    list = ['https://soundcloud.com/takugotbeats/sets/25-nights-for-nujabes'];
    list = _Coffee.shuffle(list);
    _results = [];
    for (_i = 0, _len = list.length; _i < _len; _i++) {
      url = list[_i];
      _results.push(this.add(url));
    }
    return _results;
  };

  Jukebox.prototype.setState = function(state) {
    this.state = state;
    switch (state) {
      case SPACE.Jukebox.IS_PLAYING:
        return SPACE.LOG('Next: ' + this.current.data.title);
      default:
        return SPACE.LOG('jukeboxisstopped');
    }
  };

  Jukebox.prototype.list = function() {
    var list, track, _i, _len, _ref;
    list = [];
    _ref = this.playlist;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      track = _ref[_i];
      list.push({
        title: track.data.title,
        pendingDuration: track.pendingDuration
      });
    }
    return list;
  };

  Jukebox.prototype.add = function(soundOrPlaylist) {
    return this.SC.getSoundOrPlaylist(soundOrPlaylist, (function(_this) {
      return function(o) {
        var data, track, tracks, _i, _len, _results;
        tracks = null;
        if (o.hasOwnProperty('tracks')) {
          tracks = _Coffee.shuffle(o.tracks);
        } else {
          tracks = [];
          tracks.push(o);
        }
        _results = [];
        for (_i = 0, _len = tracks.length; _i < _len; _i++) {
          data = tracks[_i];
          track = new SPACE.Track(data);
          _results.push(_H.trigger(JUKEBOX.TRACK_ON_ADD, {
            track: track
          }));
        }
        return _results;
      };
    })(this));
  };

  Jukebox.prototype._calcPending = function(position) {
    var duration, i, track, _i, _len, _ref;
    duration = 0;
    _ref = this.playlist;
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      track = _ref[i];
      duration += track.data.duration;
      if (i === position) {
        break;
      }
    }
    return duration;
  };

  Jukebox.prototype.update = function(delta) {
    var i, track, _i, _len, _ref;
    _ref = this.playlist;
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      track = _ref[i];
      track.update(delta);
    }
    if (this.playlist.length > 0) {
      if (this.current === null) {
        return this.next();
      }
    }
  };

  Jukebox.prototype.next = function(track) {
    if (this.current) {
      this._onfinish();
    }
    this.current = this.playlist.shift();
    return this.SC.streamSound(this.current.data, this._starting, {
      onplay: this._onplay,
      onfinish: this._onfinish,
      onstop: this._onstop,
      whileplaying: this.whileplaying
    });
  };

  Jukebox.prototype._starting = function(sound) {
    return this.current.sound = sound;
  };

  Jukebox.prototype._onplay = function() {
    _H.trigger(JUKEBOX.IS_PLAYING);
    return this.setState(SPACE.Jukebox.IS_PLAYING);
  };

  Jukebox.prototype._onfinish = function() {
    this.current.sound.stop();
    this.current.sound.destruct();
    this.current = null;
    _H.trigger(JUKEBOX.IS_STOPPED);
    return this.setState(SPACE.Jukebox.IS_STOPPED);
  };

  return Jukebox;

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvc291bmRzL0p1a2Vib3guY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUEsa0ZBQUE7O0FBQUEsS0FBVyxDQUFDO0FBRVYsb0JBQUEsT0FBQSxHQUFTLElBQVQsQ0FBQTs7QUFBQSxvQkFDQSxRQUFBLEdBQVUsSUFEVixDQUFBOztBQUFBLG9CQUdBLEtBQUEsR0FBTyxJQUhQLENBQUE7O0FBQUEsb0JBS0EsRUFBQSxHQUFJLElBTEosQ0FBQTs7QUFBQSxFQVFBLE9BQUMsQ0FBQSxVQUFELEdBQWEsWUFSYixDQUFBOztBQUFBLEVBU0EsT0FBQyxDQUFBLFVBQUQsR0FBYSxZQVRiLENBQUE7O0FBV2EsRUFBQSxpQkFBQSxHQUFBO0FBQ1gsaURBQUEsQ0FBQTtBQUFBLDZDQUFBLENBQUE7QUFBQSxpREFBQSxDQUFBO0FBQUEsdURBQUEsQ0FBQTtBQUFBLElBQUEsSUFBQyxDQUFBLEVBQUQsR0FBVSxJQUFBLEtBQUssQ0FBQyxVQUFOLENBQWlCLEtBQUssQ0FBQyxVQUFVLENBQUMsRUFBbEMsRUFBc0MsS0FBSyxDQUFDLFVBQVUsQ0FBQyxZQUF2RCxDQUFWLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxRQUFELEdBQVksRUFGWixDQUFBO0FBQUEsSUFHQSxJQUFDLENBQUEsT0FBRCxDQUFBLENBSEEsQ0FEVztFQUFBLENBWGI7O0FBQUEsb0JBaUJBLE9BQUEsR0FBUyxTQUFBLEdBQUE7V0FDUCxRQUFRLENBQUMsZ0JBQVQsQ0FBMEIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxJQUE5QyxFQUFvRCxJQUFDLENBQUEsWUFBckQsRUFETztFQUFBLENBakJULENBQUE7O0FBQUEsb0JBb0JBLFlBQUEsR0FBYyxTQUFDLENBQUQsR0FBQTtBQUNaLFFBQUEsS0FBQTtBQUFBLElBQUEsS0FBQSxHQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBakIsQ0FBQTtBQUFBLElBQ0EsS0FBSyxDQUFDLGVBQU4sR0FBd0IsSUFBQyxDQUFBLFlBQUQsQ0FBYyxJQUFDLENBQUEsUUFBUSxDQUFDLE1BQVYsR0FBaUIsQ0FBL0IsQ0FEeEIsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLFFBQVEsQ0FBQyxJQUFWLENBQWUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUF4QixDQUZBLENBQUE7V0FLQSxLQUFLLENBQUMsR0FBTixDQUFVLGVBQUEsR0FBa0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQWhELEVBTlk7RUFBQSxDQXBCZCxDQUFBOztBQUFBLG9CQTRCQSxrQkFBQSxHQUFvQixTQUFBLEdBQUE7QUFDbEIsUUFBQSw2QkFBQTtBQUFBLElBQUEsSUFBQSxHQUFPLENBT0wsZ0VBUEssQ0FBUCxDQUFBO0FBQUEsSUFhQSxJQUFBLEdBQU8sT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsSUFBaEIsQ0FiUCxDQUFBO0FBY0E7U0FBQSwyQ0FBQTtxQkFBQTtBQUNFLG9CQUFBLElBQUMsQ0FBQSxHQUFELENBQUssR0FBTCxFQUFBLENBREY7QUFBQTtvQkFma0I7RUFBQSxDQTVCcEIsQ0FBQTs7QUFBQSxvQkE4Q0EsUUFBQSxHQUFVLFNBQUMsS0FBRCxHQUFBO0FBQ1IsSUFBQSxJQUFDLENBQUEsS0FBRCxHQUFTLEtBQVQsQ0FBQTtBQUNBLFlBQU8sS0FBUDtBQUFBLFdBQ08sS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQURyQjtlQUVJLEtBQUssQ0FBQyxHQUFOLENBQVUsUUFBQSxHQUFXLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQW5DLEVBRko7QUFBQTtlQUlJLEtBQUssQ0FBQyxHQUFOLENBQVUsa0JBQVYsRUFKSjtBQUFBLEtBRlE7RUFBQSxDQTlDVixDQUFBOztBQUFBLG9CQXNEQSxJQUFBLEdBQU0sU0FBQSxHQUFBO0FBQ0osUUFBQSwyQkFBQTtBQUFBLElBQUEsSUFBQSxHQUFPLEVBQVAsQ0FBQTtBQUNBO0FBQUEsU0FBQSwyQ0FBQTt1QkFBQTtBQUNFLE1BQUEsSUFBSSxDQUFDLElBQUwsQ0FBVTtBQUFBLFFBQUMsS0FBQSxFQUFPLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBbkI7QUFBQSxRQUEwQixlQUFBLEVBQWlCLEtBQUssQ0FBQyxlQUFqRDtPQUFWLENBQUEsQ0FERjtBQUFBLEtBREE7QUFHQSxXQUFPLElBQVAsQ0FKSTtFQUFBLENBdEROLENBQUE7O0FBQUEsb0JBNERBLEdBQUEsR0FBSyxTQUFDLGVBQUQsR0FBQTtXQUNILElBQUMsQ0FBQSxFQUFFLENBQUMsa0JBQUosQ0FBdUIsZUFBdkIsRUFBd0MsQ0FBQSxTQUFBLEtBQUEsR0FBQTthQUFBLFNBQUMsQ0FBRCxHQUFBO0FBQ3RDLFlBQUEsdUNBQUE7QUFBQSxRQUFBLE1BQUEsR0FBUyxJQUFULENBQUE7QUFDQSxRQUFBLElBQUcsQ0FBQyxDQUFDLGNBQUYsQ0FBaUIsUUFBakIsQ0FBSDtBQUNFLFVBQUEsTUFBQSxHQUFTLE9BQU8sQ0FBQyxPQUFSLENBQWdCLENBQUMsQ0FBQyxNQUFsQixDQUFULENBREY7U0FBQSxNQUFBO0FBR0UsVUFBQSxNQUFBLEdBQVMsRUFBVCxDQUFBO0FBQUEsVUFDQSxNQUFNLENBQUMsSUFBUCxDQUFZLENBQVosQ0FEQSxDQUhGO1NBREE7QUFPQTthQUFBLDZDQUFBOzRCQUFBO0FBQ0UsVUFBQSxLQUFBLEdBQVksSUFBQSxLQUFLLENBQUMsS0FBTixDQUFZLElBQVosQ0FBWixDQUFBO0FBQUEsd0JBQ0EsRUFBRSxDQUFDLE9BQUgsQ0FBVyxPQUFPLENBQUMsWUFBbkIsRUFBaUM7QUFBQSxZQUFFLEtBQUEsRUFBTyxLQUFUO1dBQWpDLEVBREEsQ0FERjtBQUFBO3dCQVJzQztNQUFBLEVBQUE7SUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQXhDLEVBREc7RUFBQSxDQTVETCxDQUFBOztBQUFBLG9CQXlFQSxZQUFBLEdBQWMsU0FBQyxRQUFELEdBQUE7QUFDWixRQUFBLGtDQUFBO0FBQUEsSUFBQSxRQUFBLEdBQVcsQ0FBWCxDQUFBO0FBQ0E7QUFBQSxTQUFBLG1EQUFBO3NCQUFBO0FBQ0UsTUFBQSxRQUFBLElBQVksS0FBSyxDQUFDLElBQUksQ0FBQyxRQUF2QixDQUFBO0FBQ0EsTUFBQSxJQUFTLENBQUEsS0FBSyxRQUFkO0FBQUEsY0FBQTtPQUZGO0FBQUEsS0FEQTtBQUlBLFdBQU8sUUFBUCxDQUxZO0VBQUEsQ0F6RWQsQ0FBQTs7QUFBQSxvQkFnRkEsTUFBQSxHQUFRLFNBQUMsS0FBRCxHQUFBO0FBQ04sUUFBQSx3QkFBQTtBQUFBO0FBQUEsU0FBQSxtREFBQTtzQkFBQTtBQUNFLE1BQUEsS0FBSyxDQUFDLE1BQU4sQ0FBYSxLQUFiLENBQUEsQ0FERjtBQUFBLEtBQUE7QUFHQSxJQUFBLElBQUcsSUFBQyxDQUFBLFFBQVEsQ0FBQyxNQUFWLEdBQW1CLENBQXRCO0FBQ0UsTUFBQSxJQUFXLElBQUMsQ0FBQSxPQUFELEtBQVksSUFBdkI7ZUFBQSxJQUFDLENBQUEsSUFBRCxDQUFBLEVBQUE7T0FERjtLQUpNO0VBQUEsQ0FoRlIsQ0FBQTs7QUFBQSxvQkF1RkEsSUFBQSxHQUFNLFNBQUMsS0FBRCxHQUFBO0FBQ0osSUFBQSxJQUFnQixJQUFDLENBQUEsT0FBakI7QUFBQSxNQUFBLElBQUMsQ0FBQSxTQUFELENBQUEsQ0FBQSxDQUFBO0tBQUE7QUFBQSxJQUNBLElBQUMsQ0FBQSxPQUFELEdBQVcsSUFBQyxDQUFBLFFBQVEsQ0FBQyxLQUFWLENBQUEsQ0FEWCxDQUFBO1dBSUEsSUFBQyxDQUFBLEVBQUUsQ0FBQyxXQUFKLENBQWdCLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBekIsRUFBK0IsSUFBQyxDQUFBLFNBQWhDLEVBQTJDO0FBQUEsTUFDekMsTUFBQSxFQUFlLElBQUMsQ0FBQSxPQUR5QjtBQUFBLE1BRXpDLFFBQUEsRUFBZSxJQUFDLENBQUEsU0FGeUI7QUFBQSxNQUd6QyxNQUFBLEVBQWUsSUFBQyxDQUFBLE9BSHlCO0FBQUEsTUFJekMsWUFBQSxFQUFlLElBQUMsQ0FBQSxZQUp5QjtLQUEzQyxFQUxJO0VBQUEsQ0F2Rk4sQ0FBQTs7QUFBQSxvQkFtR0EsU0FBQSxHQUFXLFNBQUMsS0FBRCxHQUFBO1dBQ1QsSUFBQyxDQUFBLE9BQU8sQ0FBQyxLQUFULEdBQWlCLE1BRFI7RUFBQSxDQW5HWCxDQUFBOztBQUFBLG9CQXNHQSxPQUFBLEdBQVMsU0FBQSxHQUFBO0FBQ1AsSUFBQSxFQUFFLENBQUMsT0FBSCxDQUFXLE9BQU8sQ0FBQyxVQUFuQixDQUFBLENBQUE7V0FDQSxJQUFDLENBQUEsUUFBRCxDQUFVLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBeEIsRUFGTztFQUFBLENBdEdULENBQUE7O0FBQUEsb0JBMEdBLFNBQUEsR0FBVyxTQUFBLEdBQUE7QUFDVCxJQUFBLElBQUMsQ0FBQSxPQUFPLENBQUMsS0FBSyxDQUFDLElBQWYsQ0FBQSxDQUFBLENBQUE7QUFBQSxJQUNBLElBQUMsQ0FBQSxPQUFPLENBQUMsS0FBSyxDQUFDLFFBQWYsQ0FBQSxDQURBLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxPQUFELEdBQVcsSUFGWCxDQUFBO0FBQUEsSUFHQSxFQUFFLENBQUMsT0FBSCxDQUFXLE9BQU8sQ0FBQyxVQUFuQixDQUhBLENBQUE7V0FJQSxJQUFDLENBQUEsUUFBRCxDQUFVLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBeEIsRUFMUztFQUFBLENBMUdYLENBQUE7O2lCQUFBOztJQUZGLENBQUEiLCJmaWxlIjoidGhyZWVqcy9zb3VuZHMvSnVrZWJveC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFNQQUNFLkp1a2Vib3hcblxuICBjdXJyZW50OiBudWxsXG4gIHBsYXlsaXN0OiBudWxsXG5cbiAgc3RhdGU6IG51bGxcblxuICBTQzogbnVsbFxuXG4gICMgIyBTVEFURVNcbiAgQElTX1BMQVlJTkc6ICdJU19QTEFZSU5HJ1xuICBASVNfU1RPUFBFRDogJ0lTX1NUT1BQRUQnXG5cbiAgY29uc3RydWN0b3I6IC0+XG4gICAgQFNDID0gbmV3IFNQQUNFLlNvdW5kQ2xvdWQoU1BBQ0UuU09VTkRDTE9VRC5pZCwgU1BBQ0UuU09VTkRDTE9VRC5yZWRpcmVjdF91cmkpXG5cbiAgICBAcGxheWxpc3QgPSBbXVxuICAgIEBfZXZlbnRzKClcblxuICBfZXZlbnRzOiAtPlxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoSlVLRUJPWC5UUkFDS19BRERFRC50eXBlLCBAX2VUcmFja0FkZGVkKVxuXG4gIF9lVHJhY2tBZGRlZDogKGUpPT5cbiAgICB0cmFjayA9IGUub2JqZWN0LnRyYWNrXG4gICAgdHJhY2sucGVuZGluZ0R1cmF0aW9uID0gQF9jYWxjUGVuZGluZyhAcGxheWxpc3QubGVuZ3RoLTEpXG4gICAgQHBsYXlsaXN0LnB1c2goZS5vYmplY3QudHJhY2spXG5cbiAgICAjIEBwbGF5bGlzdCA9IF9Db2ZmZWUuc2h1ZmZsZShAcGxheWxpc3QpXG4gICAgU1BBQ0UuTE9HKCdTb3VuZCBhZGRlZDogJyArIGUub2JqZWN0LnRyYWNrLmRhdGEudGl0bGUpXG5cbiAgcHJlZGVmaW5lZFBsYXlsaXN0OiAtPlxuICAgIGxpc3QgPSBbXG4gICAgICAjICdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL2NvdXJ0ZS1kYW5zZS1tYWNhYnJlJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9jaG9uY2gtMi9tb3VhaXMnXG4gICAgICAjICdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL2NhY2Fjby0yJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9jaG9uY2gtMi9kdW9kZW51bSdcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vY2hvbmNoLTIvbGl0dGxlLWdyZWVuLW1vbmtleSdcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vaHVod2hhdGFuZHdoZXJlL3NldHMvc3VwcmVtZS1sYXppbmVzcy10aGUtY2VsZXN0aWNzJ1xuICAgICAgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vdGFrdWdvdGJlYXRzL3NldHMvMjUtbmlnaHRzLWZvci1udWphYmVzJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS90b21taXNjaC9zZXRzL3RvbS1taXNjaC1zb3VsZWN0aW9uLXdoaXRlJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9wcm9mZXNzb3JrbGlxL3NldHMvdHJhY2ttYW5pYS12YWxsZXktb3N0J1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9wcm9mZXNzb3JrbGlxL3NldHMvdHJhY2ttYW5pYS1zdGFkaXVtLW9zdCdcbiAgICBdXG5cbiAgICBsaXN0ID0gX0NvZmZlZS5zaHVmZmxlKGxpc3QpXG4gICAgZm9yIHVybCBpbiBsaXN0XG4gICAgICBAYWRkKHVybClcblxuICBzZXRTdGF0ZTogKHN0YXRlKS0+XG4gICAgQHN0YXRlID0gc3RhdGVcbiAgICBzd2l0Y2goc3RhdGUpXG4gICAgICB3aGVuIFNQQUNFLkp1a2Vib3guSVNfUExBWUlOR1xuICAgICAgICBTUEFDRS5MT0coJ05leHQ6ICcgKyBAY3VycmVudC5kYXRhLnRpdGxlKVxuICAgICAgZWxzZVxuICAgICAgICBTUEFDRS5MT0coJ2p1a2Vib3hpc3N0b3BwZWQnKVxuXG4gIGxpc3Q6IC0+XG4gICAgbGlzdCA9IFtdXG4gICAgZm9yIHRyYWNrIGluIEBwbGF5bGlzdFxuICAgICAgbGlzdC5wdXNoKHt0aXRsZTogdHJhY2suZGF0YS50aXRsZSwgcGVuZGluZ0R1cmF0aW9uOiB0cmFjay5wZW5kaW5nRHVyYXRpb259KVxuICAgIHJldHVybiBsaXN0XG5cbiAgYWRkOiAoc291bmRPclBsYXlsaXN0KS0+XG4gICAgQFNDLmdldFNvdW5kT3JQbGF5bGlzdCBzb3VuZE9yUGxheWxpc3QsIChvKT0+XG4gICAgICB0cmFja3MgPSBudWxsXG4gICAgICBpZiBvLmhhc093blByb3BlcnR5KCd0cmFja3MnKVxuICAgICAgICB0cmFja3MgPSBfQ29mZmVlLnNodWZmbGUoby50cmFja3MpXG4gICAgICBlbHNlXG4gICAgICAgIHRyYWNrcyA9IFtdXG4gICAgICAgIHRyYWNrcy5wdXNoKG8pXG5cbiAgICAgIGZvciBkYXRhIGluIHRyYWNrc1xuICAgICAgICB0cmFjayA9IG5ldyBTUEFDRS5UcmFjayhkYXRhKVxuICAgICAgICBfSC50cmlnZ2VyKEpVS0VCT1guVFJBQ0tfT05fQURELCB7IHRyYWNrOiB0cmFjayB9KVxuXG4gIF9jYWxjUGVuZGluZzogKHBvc2l0aW9uKS0+XG4gICAgZHVyYXRpb24gPSAwXG4gICAgZm9yIHRyYWNrLCBpIGluIEBwbGF5bGlzdFxuICAgICAgZHVyYXRpb24gKz0gdHJhY2suZGF0YS5kdXJhdGlvblxuICAgICAgYnJlYWsgaWYgaSA9PSBwb3NpdGlvblxuICAgIHJldHVybiBkdXJhdGlvblxuXG4gIHVwZGF0ZTogKGRlbHRhKS0+XG4gICAgZm9yIHRyYWNrLCBpIGluIEBwbGF5bGlzdFxuICAgICAgdHJhY2sudXBkYXRlKGRlbHRhKVxuXG4gICAgaWYgQHBsYXlsaXN0Lmxlbmd0aCA+IDBcbiAgICAgIEBuZXh0KCkgaWYgQGN1cnJlbnQgPT0gbnVsbFxuXG4gIG5leHQ6ICh0cmFjayktPlxuICAgIEBfb25maW5pc2goKSBpZiBAY3VycmVudFxuICAgIEBjdXJyZW50ID0gQHBsYXlsaXN0LnNoaWZ0KClcbiAgICAjIEBjdXJyZW50LnNwYWNlc2hpcC5wYXJlbnQucmVtb3ZlQ2hpbGQoQGN1cnJlbnQuc3BhY2VzaGlwKVxuXG4gICAgQFNDLnN0cmVhbVNvdW5kKEBjdXJyZW50LmRhdGEsIEBfc3RhcnRpbmcsIHtcbiAgICAgIG9ucGxheSAgICAgICA6IEBfb25wbGF5XG4gICAgICBvbmZpbmlzaCAgICAgOiBAX29uZmluaXNoXG4gICAgICBvbnN0b3AgICAgICAgOiBAX29uc3RvcFxuICAgICAgd2hpbGVwbGF5aW5nIDogQHdoaWxlcGxheWluZ1xuICAgIH0pXG5cbiAgX3N0YXJ0aW5nOiAoc291bmQpPT5cbiAgICBAY3VycmVudC5zb3VuZCA9IHNvdW5kXG5cbiAgX29ucGxheTogPT5cbiAgICBfSC50cmlnZ2VyKEpVS0VCT1guSVNfUExBWUlORylcbiAgICBAc2V0U3RhdGUoU1BBQ0UuSnVrZWJveC5JU19QTEFZSU5HKVxuXG4gIF9vbmZpbmlzaDogPT5cbiAgICBAY3VycmVudC5zb3VuZC5zdG9wKClcbiAgICBAY3VycmVudC5zb3VuZC5kZXN0cnVjdCgpXG4gICAgQGN1cnJlbnQgPSBudWxsXG4gICAgX0gudHJpZ2dlcihKVUtFQk9YLklTX1NUT1BQRUQpXG4gICAgQHNldFN0YXRlKFNQQUNFLkp1a2Vib3guSVNfU1RPUFBFRClcbiJdfQ==