var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.Spaceship = (function(_super) {
  __extends(Spaceship, _super);

  Spaceship.prototype.time = 0;

  Spaceship.prototype.ship = null;

  Spaceship.prototype.path = null;

  Spaceship.prototype.duration = 0;

  Spaceship.prototype.state = null;

  Spaceship.prototype.angle = 0;

  Spaceship.prototype._cached = null;

  Spaceship.IDLE = 'IDLE';

  Spaceship.LAUNCHED = 'LAUNCHED';

  Spaceship.IN_LOOP = 'IN_LOOP';

  Spaceship.ARRIVED = 'ARRIVED';

  function Spaceship(target, radius) {
    Spaceship.__super__.constructor.apply(this, arguments);
    this.target = target;
    this.radius = radius;
    this.angle = Math.random() * Math.PI * 2;
    this.setState(SPACE.Spaceship.IDLE);
    this.setup();
    setTimeout((function(_this) {
      return function() {
        return _this.setState(SPACE.Spaceship.LAUNCHED);
      };
    })(this), 2000);
  }

  Spaceship.prototype.setRadius = function(radius) {
    this.radius = radius;
    return this._cached = this._computePaths();
  };

  Spaceship.prototype.setup = function() {
    var g, matrix, v;
    g = new THREE.Geometry();
    g.vertices.push(new THREE.Vector3(0, -52.5, -10), new THREE.Vector3(-10, -67.5, 10), new THREE.Vector3(-50, -42.5, 10), new THREE.Vector3(0, 67.5, 10), new THREE.Vector3(+50, -42.5, 10), new THREE.Vector3(+10, -67.5, 10));
    g.faces.push(new THREE.Face3(0, 3, 1), new THREE.Face3(1, 2, 3), new THREE.Face3(3, 0, 5), new THREE.Face3(5, 4, 3));
    g.computeFaceNormals();
    matrix = new THREE.Matrix4();
    matrix.makeRotationX(Math.PI * .5);
    g.applyMatrix(matrix);
    matrix.makeRotationZ(Math.PI);
    g.applyMatrix(matrix);
    this.ship = THREE.SceneUtils.createMultiMaterialObject(g, [
      new THREE.MeshLambertMaterial({
        color: 0x0088ff,
        side: THREE.DoubleSide
      })
    ]);
    this.ship.castShadow = true;
    this.ship.receiveShadow = true;
    this.ship.scale.set(.15, .15, .15);
    this.add(this.ship);
    this._cached = this._computePaths();
    v = this._cached.launchedPath.getPointAt(0);
    return this.ship.position.set(v.x, v.y, v.z);
  };

  Spaceship.prototype.setState = function(state) {
    var v;
    this.state = state;
    switch (state) {
      case SPACE.Spaceship.IDLE:
        SPACE.LOG('IDLE');
        return this.path = null;
      case SPACE.Spaceship.LAUNCHED:
        SPACE.LOG('LAUNCHED');
        this._resetTime();
        this.path = this._cached.launchedPath;
        this.duration = 10 * 1000;
        v = this.path.getPoint(0);
        return this.ship.position.set(v.x, v.y, v.z);
      case SPACE.Spaceship.IN_LOOP:
        SPACE.LOG('IN_LOOP');
        this._resetTime();
        this.path = this._cached.inLoopPath;
        this.duration = 30 * 1000;
        v = this.path.getPoint(0);
        return this.ship.position.set(v.x, v.y, v.z);
      case SPACE.Spaceship.ARRIVED:
        SPACE.LOG('ARRIVED');
        this.path = null;
        return setTimeout((function(_this) {
          return function() {
            return _this.setState(SPACE.Spaceship.LAUNCHED);
          };
        })(this), 5000);
      default:
        return this.setState(SPACE.Spaceship.IDLE);
    }
  };

  Spaceship.prototype.update = function(delta) {
    var t;
    if (this.state !== SPACE.Spaceship.IDLE && this.state !== SPACE.Spaceship.ARRIVED) {
      this.time += delta;
      t = Math.min(this.time / this.duration, 1);
      if (t >= 1) {
        this._resetTime();
        if (this.state === SPACE.Spaceship.LAUNCHED) {
          this.setState(SPACE.Spaceship.IN_LOOP);
        } else if (this.state === SPACE.Spaceship.IN_LOOP) {
          this.setState(SPACE.Spaceship.ARRIVED);
        }
        return;
      }
      if (this.state === SPACE.Spaceship.LAUNCHED) {
        t = _Easing.QuadraticEaseOut(t);
      }
      return this._progress(t);
    }
  };

  Spaceship.prototype._resetTime = function() {
    return this.time = 0;
  };

  Spaceship.prototype._progress = function(t) {
    var ahead, v;
    v = this.path.getPointAt(t);
    this.ship.position.set(v.x, v.y, v.z);
    ahead = Math.min(t + 10 / this.path.getLength(), 1);
    v = this.path.getPointAt(ahead).multiplyScalar(1);
    this.ship.lookAt(v);
    if (this.state === SPACE.Spaceship.IN_LOOP) {
      return this.ship.rotation.set(this.ship.rotation.x, this.ship.rotation.y, 0);
    }
  };

  Spaceship.prototype._computePaths = function() {
    var angle, curve, curveA, curveB, curvePoint, distance, fromA, mid, path, points, ref, toA;
    fromA = new THREE.Vector3();
    fromA.x = this.target.x + Math.cos(this.angle) * 500;
    fromA.y = this.target.y + Math.sin(this.angle) * 500;
    fromA.z = 600;
    path = new THREE.IncomingCurve(this.target, this.angle, this.radius);
    path.inverse = true;
    path.useGolden = true;
    mid = path.getPoint(0);
    ref = path.getPoint(.025);
    angle = _Math.angleBetweenPoints(mid, ref) + Math.PI;
    distance = mid.distanceTo(ref);
    curvePoint = new THREE.Vector3();
    curvePoint.x = mid.x + Math.cos(angle) * distance;
    curvePoint.y = mid.y + Math.sin(angle) * distance;
    curvePoint.z = mid.z;
    toA = path.getPoint(0);
    curve = new THREE.TestCurve(fromA, curvePoint);
    points = curve.getPoints(10);
    points.push(toA);
    curveA = _THREE.HermiteCurve(points);
    curveB = _THREE.HermiteCurve(path.getPoints(10));
    return {
      launchedPath: curveA,
      inLoopPath: curveB
    };
  };

  Spaceship.prototype._debugPath = function(path, color) {
    var g, tube;
    if (color == null) {
      color = 0xFF0000;
    }
    g = new THREE.TubeGeometry(path, 200, .5, 10, true);
    tube = THREE.SceneUtils.createMultiMaterialObject(g, [
      new THREE.MeshBasicMaterial({
        color: color,
        opacity: 0.3,
        wireframe: true,
        transparent: true
      }), new THREE.MeshLambertMaterial({
        color: 0xFF88FF,
        side: THREE.DoubleSide
      })
    ]);
    return this.add(tube);
  };

  return Spaceship;

})(THREE.Group);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvZ3JhcGhpY3MvU3BhY2VzaGlwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBO2lTQUFBOztBQUFBLEtBQVcsQ0FBQztBQUVWLDhCQUFBLENBQUE7O0FBQUEsc0JBQUEsSUFBQSxHQUFNLENBQU4sQ0FBQTs7QUFBQSxzQkFFQSxJQUFBLEdBQU0sSUFGTixDQUFBOztBQUFBLHNCQUdBLElBQUEsR0FBTSxJQUhOLENBQUE7O0FBQUEsc0JBSUEsUUFBQSxHQUFVLENBSlYsQ0FBQTs7QUFBQSxzQkFNQSxLQUFBLEdBQU8sSUFOUCxDQUFBOztBQUFBLHNCQVFBLEtBQUEsR0FBTyxDQVJQLENBQUE7O0FBQUEsc0JBVUEsT0FBQSxHQUFTLElBVlQsQ0FBQTs7QUFBQSxFQWFBLFNBQUMsQ0FBQSxJQUFELEdBQVcsTUFiWCxDQUFBOztBQUFBLEVBY0EsU0FBQyxDQUFBLFFBQUQsR0FBVyxVQWRYLENBQUE7O0FBQUEsRUFlQSxTQUFDLENBQUEsT0FBRCxHQUFXLFNBZlgsQ0FBQTs7QUFBQSxFQWdCQSxTQUFDLENBQUEsT0FBRCxHQUFXLFNBaEJYLENBQUE7O0FBa0JhLEVBQUEsbUJBQUMsTUFBRCxFQUFTLE1BQVQsR0FBQTtBQUNYLElBQUEsNENBQUEsU0FBQSxDQUFBLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsTUFGVixDQUFBO0FBQUEsSUFHQSxJQUFDLENBQUEsTUFBRCxHQUFVLE1BSFYsQ0FBQTtBQUFBLElBSUEsSUFBQyxDQUFBLEtBQUQsR0FBVSxJQUFJLENBQUMsTUFBTCxDQUFBLENBQUEsR0FBZ0IsSUFBSSxDQUFDLEVBQXJCLEdBQTBCLENBSnBDLENBQUE7QUFBQSxJQU1BLElBQUMsQ0FBQSxRQUFELENBQVUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUExQixDQU5BLENBQUE7QUFBQSxJQVFBLElBQUMsQ0FBQSxLQUFELENBQUEsQ0FSQSxDQUFBO0FBQUEsSUFVQSxVQUFBLENBQVcsQ0FBQSxTQUFB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QUN4QixLQUFBLEVBQU8sS0FEaUI7QUFBQSxRQUV4QixPQUFBLEVBQVMsR0FGZTtBQUFBLFFBR3hCLFNBQUEsRUFBVyxJQUhhO0FBQUEsUUFJeEIsV0FBQSxFQUFhLElBSlc7T0FBeEIsQ0FEZ0QsRUFPaEQsSUFBQSxLQUFLLENBQUMsbUJBQU4sQ0FBMEI7QUFBQSxRQUFFLEtBQUEsRUFBTyxRQUFUO0FBQUEsUUFBbUIsSUFBQSxFQUFNLEtBQUssQ0FBQyxVQUEvQjtPQUExQixDQVBnRDtLQUEvQyxDQURQLENBQUE7V0FVQSxJQUFDLENBQUEsR0FBRCxDQUFLLElBQUwsRUFYVTtFQUFBLENBdktaLENBQUE7O21CQUFBOztHQUY0QixLQUFLLENBQUMsTUFBcEMsQ0FBQSIsImZpbGUiOiJ0aHJlZWpzL2dyYXBoaWNzL1NwYWNlc2hpcC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFNQQUNFLlNwYWNlc2hpcCBleHRlbmRzIFRIUkVFLkdyb3VwXG5cbiAgdGltZTogMFxuXG4gIHNoaXA6IG51bGxcbiAgcGF0aDogbnVsbFxuICBkdXJhdGlvbjogMFxuXG4gIHN0YXRlOiBudWxsXG5cbiAgYW5nbGU6IDBcblxuICBfY2FjaGVkOiBudWxsXG5cbiAgIyBTVEFURVNcbiAgQElETEU6ICAgICAnSURMRSdcbiAgQExBVU5DSEVEOiAnTEFVTkNIRUQnXG4gIEBJTl9MT09QOiAgJ0lOX0xPT1AnXG4gIEBBUlJJVkVEOiAgJ0FSUklWRUQnXG5cbiAgY29uc3RydWN0b3I6ICh0YXJnZXQsIHJhZGl1cyktPlxuICAgIHN1cGVyXG5cbiAgICBAdGFyZ2V0ID0gdGFyZ2V0XG4gICAgQHJhZGl1cyA9IHJhZGl1c1xuICAgIEBhbmdsZSAgPSBNYXRoLnJhbmRvbSgpICogTWF0aC5QSSAqIDJcblxuICAgIEBzZXRTdGF0ZShTUEFDRS5TcGFjZXNoaXAuSURMRSlcblxuICAgIEBzZXR1cCgpXG5cbiAgICBzZXRUaW1lb3V0KD0+XG4gICAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLkxBVU5DSEVEKVxuICAgICwgMjAwMClcblxuICBzZXRSYWRpdXM6IChyYWRpdXMpLT5cbiAgICBAcmFkaXVzID0gcmFkaXVzXG4gICAgQF9jYWNoZWQgPSBAX2NvbXB1dGVQYXRocygpXG5cbiAgc2V0dXA6IC0+XG4gICAgZyA9IG5ldyBUSFJFRS5HZW9tZXRyeSgpXG4gICAgZy52ZXJ0aWNlcy5wdXNoKFxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoICAwLCAtNTIuNSwgLTEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTEwLCAtNjcuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTUwLCAtNDIuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoICAwLCAgNjcuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoKzUwLCAtNDIuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoKzEwLCAtNjcuNSwgIDEwKVxuICAgIClcbiAgICBnLmZhY2VzLnB1c2goXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoMCwgMywgMSksXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoMSwgMiwgMyksXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoMywgMCwgNSksXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoNSwgNCwgMylcbiAgICApXG4gICAgZy5jb21wdXRlRmFjZU5vcm1hbHMoKVxuICAgIG1hdHJpeCA9IG5ldyBUSFJFRS5NYXRyaXg0KClcbiAgICBtYXRyaXgubWFrZVJvdGF0aW9uWChNYXRoLlBJKi41KVxuICAgIGcuYXBwbHlNYXRyaXgobWF0cml4KVxuICAgIG1hdHJpeC5tYWtlUm90YXRpb25aKE1hdGguUEkpXG4gICAgZy5hcHBseU1hdHJpeChtYXRyaXgpXG5cbiAgICBAc2hpcCA9IFRIUkVFLlNjZW5lVXRpbHMuY3JlYXRlTXVsdGlNYXRlcmlhbE9iamVjdChnLCBbXG4gICAgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweDAwODhmZiwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KVxuICAgIF0pXG4gICAgQHNoaXAuY2FzdFNoYWRvdyA9IHRydWVcbiAgICBAc2hpcC5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgIEBzaGlwLnNjYWxlLnNldCguMTUsIC4xNSwgLjE1KVxuICAgIEBhZGQoQHNoaXApXG5cbiAgICBAX2NhY2hlZCA9IEBfY29tcHV0ZVBhdGhzKClcbiAgICB2ID0gQF9jYWNoZWQubGF1bmNoZWRQYXRoLmdldFBvaW50QXQoMClcbiAgICBAc2hpcC5wb3NpdGlvbi5zZXQodi54LCB2LnksIHYueilcblxuICBzZXRTdGF0ZTogKHN0YXRlKS0+XG4gICAgQHN0YXRlID0gc3RhdGVcbiAgICBzd2l0Y2ggc3RhdGVcbiAgICAgIHdoZW4gU1BBQ0UuU3BhY2VzaGlwLklETEVcbiAgICAgICAgU1BBQ0UuTE9HKCdJRExFJylcbiAgICAgICAgQHBhdGggPSBudWxsXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5MQVVOQ0hFRFxuICAgICAgICBTUEFDRS5MT0coJ0xBVU5DSEVEJylcbiAgICAgICAgQF9yZXNldFRpbWUoKVxuICAgICAgICBAcGF0aCA9IEBfY2FjaGVkLmxhdW5jaGVkUGF0aFxuICAgICAgICBAZHVyYXRpb24gPSAxMCAqIDEwMDBcblxuICAgICAgICB2ID0gQHBhdGguZ2V0UG9pbnQoMClcbiAgICAgICAgQHNoaXAucG9zaXRpb24uc2V0KHYueCwgdi55LCB2LnopXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5JTl9MT09QXG4gICAgICAgIFNQQUNFLkxPRygnSU5fTE9PUCcpXG4gICAgICAgIEBfcmVzZXRUaW1lKClcbiAgICAgICAgQHBhdGggPSBAX2NhY2hlZC5pbkxvb3BQYXRoXG4gICAgICAgIEBkdXJhdGlvbiA9IDMwICogMTAwMFxuXG4gICAgICAgIHYgPSBAcGF0aC5nZXRQb2ludCgwKVxuICAgICAgICBAc2hpcC5wb3NpdGlvbi5zZXQodi54LCB2LnksIHYueilcbiAgICAgIHdoZW4gU1BBQ0UuU3BhY2VzaGlwLkFSUklWRURcbiAgICAgICAgU1BBQ0UuTE9HKCdBUlJJVkVEJylcbiAgICAgICAgQHBhdGggPSBudWxsXG4gICAgICAgIHNldFRpbWVvdXQoPT5cbiAgICAgICAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLkxBVU5DSEVEKVxuICAgICAgICAsIDUwMDApXG4gICAgICBlbHNlXG4gICAgICAgIEBzZXRTdGF0ZShTUEFDRS5TcGFjZXNoaXAuSURMRSlcblxuICB1cGRhdGU6IChkZWx0YSktPlxuICAgIGlmIEBzdGF0ZSAhPSBTUEFDRS5TcGFjZXNoaXAuSURMRSBhbmQgQHN0YXRlICE9IFNQQUNFLlNwYWNlc2hpcC5BUlJJVkVEXG4gICAgICBAdGltZSArPSBkZWx0YVxuICAgICAgdCA9IE1hdGgubWluKEB0aW1lIC8gQGR1cmF0aW9uLCAxKVxuXG4gICAgICBpZiB0ID49IDFcbiAgICAgICAgQF9yZXNldFRpbWUoKVxuICAgICAgICBpZiBAc3RhdGUgPT0gU1BBQ0UuU3BhY2VzaGlwLkxBVU5DSEVEXG4gICAgICAgICAgQHNldFN0YXRlKFNQQUNFLlNwYWNlc2hpcC5JTl9MT09QKVxuICAgICAgICBlbHNlIGlmIEBzdGF0ZSA9PSBTUEFDRS5TcGFjZXNoaXAuSU5fTE9PUFxuICAgICAgICAgIEBzZXRTdGF0ZShTUEFDRS5TcGFjZXNoaXAuQVJSSVZFRClcbiAgICAgICAgcmV0dXJuXG5cbiAgICAgIGlmIEBzdGF0ZSA9PSBTUEFDRS5TcGFjZXNoaXAuTEFVTkNIRURcbiAgICAgICAgdCA9IF9FYXNpbmcuUXVhZHJhdGljRWFzZU91dCh0KVxuXG4gICAgICBAX3Byb2dyZXNzKHQpXG5cbiAgX3Jlc2V0VGltZTogLT5cbiAgICBAdGltZSA9IDBcblxuICBfcHJvZ3Jlc3M6ICh0KS0+XG4gICAgdiA9IEBwYXRoLmdldFBvaW50QXQodClcbiAgICBAc2hpcC5wb3NpdGlvbi5zZXQodi54LCB2LnksIHYueilcblxuICAgIGFoZWFkID0gIE1hdGgubWluKHQgKyAxMCAvIEBwYXRoLmdldExlbmd0aCgpLCAxKVxuICAgIHYgPSBAcGF0aC5nZXRQb2ludEF0KGFoZWFkKS5tdWx0aXBseVNjYWxhciggMSApXG4gICAgQHNoaXAubG9va0F0KHYpXG5cbiAgICBpZiBAc3RhdGUgPT0gU1BBQ0UuU3BhY2VzaGlwLklOX0xPT1BcbiAgICAgIEBzaGlwLnJvdGF0aW9uLnNldChAc2hpcC5yb3RhdGlvbi54LCBAc2hpcC5yb3RhdGlvbi55LCAwKVxuXG4gIF9jb21wdXRlUGF0aHM6IC0+XG4gICAgZnJvbUEgICAgID0gbmV3IFRIUkVFLlZlY3RvcjMoKVxuICAgIGZyb21BLnggICA9IEB0YXJnZXQueCArIE1hdGguY29zKEBhbmdsZSkgKiA1MDBcbiAgICBmcm9tQS55ICAgPSBAdGFyZ2V0LnkgKyBNYXRoLnNpbihAYW5nbGUpICogNTAwXG4gICAgZnJvbUEueiAgID0gNjAwXG5cbiAgICBwYXRoICAgICAgICAgICA9IG5ldyBUSFJFRS5JbmNvbWluZ0N1cnZlKEB0YXJnZXQsIEBhbmdsZSwgQHJhZGl1cylcbiAgICBwYXRoLmludmVyc2UgICA9IHRydWVcbiAgICBwYXRoLnVzZUdvbGRlbiA9IHRydWVcblxuICAgICMjIENyZWF0ZSBwYXRoIGxhdW5jaGVkXG4gICAgbWlkICAgICAgPSBwYXRoLmdldFBvaW50KDApXG4gICAgcmVmICAgICAgPSBwYXRoLmdldFBvaW50KC4wMjUpXG4gICAgYW5nbGUgICAgPSBfTWF0aC5hbmdsZUJldHdlZW5Qb2ludHMobWlkLCByZWYpICsgTWF0aC5QSVxuICAgIGRpc3RhbmNlID0gbWlkLmRpc3RhbmNlVG8ocmVmKVxuXG4gICAgY3VydmVQb2ludCAgID0gbmV3IFRIUkVFLlZlY3RvcjMoKVxuICAgIGN1cnZlUG9pbnQueCA9IG1pZC54ICsgTWF0aC5jb3MoYW5nbGUpICogZGlzdGFuY2VcbiAgICBjdXJ2ZVBvaW50LnkgPSBtaWQueSArIE1hdGguc2luKGFuZ2xlKSAqIGRpc3RhbmNlXG4gICAgY3VydmVQb2ludC56ID0gbWlkLnpcblxuICAgIHRvQSAgICA9IHBhdGguZ2V0UG9pbnQoMClcbiAgICBjdXJ2ZSAgPSBuZXcgVEhSRUUuVGVzdEN1cnZlKGZyb21BLCBjdXJ2ZVBvaW50KVxuICAgIHBvaW50cyA9IGN1cnZlLmdldFBvaW50cygxMClcbiAgICBwb2ludHMucHVzaCh0b0EpXG5cbiAgICBjdXJ2ZUEgPSBfVEhSRUUuSGVybWl0ZUN1cnZlKHBvaW50cylcblxuICAgICMjIENyZWF0ZSBwYXRoIGluIHRoZSBsb29wXG4gICAgY3VydmVCID0gX1RIUkVFLkhlcm1pdGVDdXJ2ZShwYXRoLmdldFBvaW50cygxMCkpXG4gICAgcmV0dXJuIHsgbGF1bmNoZWRQYXRoOiBjdXJ2ZUEsIGluTG9vcFBhdGg6IGN1cnZlQiB9XG5cbiAgX2RlYnVnUGF0aDogKHBhdGgsIGNvbG9yPTB4RkYwMDAwKS0+XG4gICAgZyAgICA9IG5ldyBUSFJFRS5UdWJlR2VvbWV0cnkocGF0aCwgMjAwLCAuNSwgMTAsIHRydWUpXG4gICAgdHViZSA9IFRIUkVFLlNjZW5lVXRpbHMuY3JlYXRlTXVsdGlNYXRlcmlhbE9iamVjdCggZywgW1xuICAgICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcbiAgICAgICAgICBjb2xvcjogY29sb3IsXG4gICAgICAgICAgb3BhY2l0eTogMC4zLFxuICAgICAgICAgIHdpcmVmcmFtZTogdHJ1ZSxcbiAgICAgICAgICB0cmFuc3BhcmVudDogdHJ1ZVxuICAgICAgfSksXG4gICAgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGODhGRiwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KVxuICAgIF0pXG4gICAgQGFkZCh0dWJlKVxuIl19