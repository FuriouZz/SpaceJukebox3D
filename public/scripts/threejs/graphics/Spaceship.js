var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.Spaceship = (function(_super) {
  __extends(Spaceship, _super);

  Spaceship.prototype.time = 0;

  Spaceship.prototype.ship = null;

  Spaceship.prototype.path = null;

  Spaceship.prototype.duration = 0;

  Spaceship.prototype.state = null;

  Spaceship.prototype.angle = 0;

  Spaceship.prototype._cached = null;

  Spaceship.IDLE = 'IDLE';

  Spaceship.LAUNCHED = 'LAUNCHED';

  Spaceship.IN_LOOP = 'IN_LOOP';

  Spaceship.ARRIVED = 'ARRIVED';

  function Spaceship(target, radius) {
    Spaceship.__super__.constructor.apply(this, arguments);
    this.target = target;
    this.radius = radius;
    this.angle = Math.random() * Math.PI * 2;
    this.setState(SPACE.Spaceship.IDLE);
    this.setup();
    setTimeout((function(_this) {
      return function() {
        return _this.setState(SPACE.Spaceship.LAUNCHED);
      };
    })(this), 2000);
  }

  Spaceship.prototype.setRadius = function(radius) {
    this.radius = radius;
    return this._cached = {
      launchedPath: this._computeLaunchedPath(),
      inLoopPath: this._computeInLoopPath()
    };
  };

  Spaceship.prototype.setup = function() {
    var g, matrix, v;
    g = new THREE.Geometry();
    g.vertices.push(new THREE.Vector3(0, -52.5, -10), new THREE.Vector3(-10, -67.5, 10), new THREE.Vector3(-50, -42.5, 10), new THREE.Vector3(0, 67.5, 10), new THREE.Vector3(+50, -42.5, 10), new THREE.Vector3(+10, -67.5, 10));
    g.faces.push(new THREE.Face3(0, 3, 1), new THREE.Face3(1, 2, 3), new THREE.Face3(3, 0, 5), new THREE.Face3(5, 4, 3));
    g.computeFaceNormals();
    matrix = new THREE.Matrix4();
    matrix.makeRotationX(Math.PI * .5);
    g.applyMatrix(matrix);
    matrix.makeRotationZ(Math.PI);
    g.applyMatrix(matrix);
    this.ship = THREE.SceneUtils.createMultiMaterialObject(g, [
      new THREE.MeshLambertMaterial({
        color: 0x0088ff,
        side: THREE.DoubleSide
      })
    ]);
    this.ship.castShadow = true;
    this.ship.receiveShadow = true;
    this.ship.scale.set(.15, .15, .15);
    this.add(this.ship);
    this._cached = this._computePaths();
    v = this._cached.launchedPath.getPointAt(0);
    return this.ship.position.set(v.x, v.y, v.z);
  };

  Spaceship.prototype.setState = function(state) {
    var v;
    this.state = state;
    switch (state) {
      case SPACE.Spaceship.IDLE:
        SPACE.LOG('IDLE');
        return this.path = null;
      case SPACE.Spaceship.LAUNCHED:
        SPACE.LOG('LAUNCHED');
        this._resetTime();
        this.path = this._cached.launchedPath || this._computeLaunchedPath();
        this.duration = 10 * 1000;
        v = this.path.getPoint(0);
        return this.ship.position.set(v.x, v.y, v.z);
      case SPACE.Spaceship.IN_LOOP:
        SPACE.LOG('IN_LOOP');
        this._resetTime();
        this.path = this._cached.inLoopPath || this._computeInLoopPath();
        this.duration = 30 * 1000;
        v = this.path.getPoint(0);
        return this.ship.position.set(v.x, v.y, v.z);
      case SPACE.Spaceship.ARRIVED:
        SPACE.LOG('ARRIVED');
        this.path = null;
        return setTimeout((function(_this) {
          return function() {
            return _this.setState(SPACE.Spaceship.LAUNCHED);
          };
        })(this), 5000);
      default:
        return this.setState(SPACE.Spaceship.IDLE);
    }
  };

  Spaceship.prototype.update = function(delta) {
    var t;
    if (this.state !== SPACE.Spaceship.IDLE && this.state !== SPACE.Spaceship.ARRIVED) {
      this.time += delta;
      t = Math.min(this.time / this.duration, 1);
      if (t >= 1) {
        this._resetTime();
        if (this.state === SPACE.Spaceship.LAUNCHED) {
          this.setState(SPACE.Spaceship.IN_LOOP);
        } else if (this.state === SPACE.Spaceship.IN_LOOP) {
          this.setState(SPACE.Spaceship.ARRIVED);
        }
        return;
      }
      if (this.state === SPACE.Spaceship.LAUNCHED) {
        t = _Easing.QuadraticEaseOut(t);
      }
      return this._progress(t);
    }
  };

  Spaceship.prototype._resetTime = function() {
    return this.time = 0;
  };

  Spaceship.prototype._progress = function(t) {
    var ahead, v;
    v = this.path.getPointAt(t);
    this.ship.position.set(v.x, v.y, v.z);
    ahead = Math.min(t + 10 / this.path.getLength(), 1);
    v = this.path.getPointAt(ahead).multiplyScalar(1);
    this.ship.lookAt(v);
    if (this.state === SPACE.Spaceship.IN_LOOP) {
      return this.ship.rotation.set(this.ship.rotation.x, this.ship.rotation.y, 0);
    }
  };

  Spaceship.prototype._computePaths = function() {
    var angle, curve, curveA, curveB, curvePoint, distance, fromA, mid, path, points, ref, toA;
    fromA = new THREE.Vector3();
    fromA.x = this.target.x + Math.cos(this.angle) * 500;
    fromA.y = this.target.y + Math.sin(this.angle) * 500;
    fromA.z = 600;
    path = new THREE.IncomingCurve(this.target, this.angle, this.radius);
    path.inverse = true;
    path.useGolden = true;
    mid = path.getPoint(0);
    ref = path.getPoint(.025);
    angle = _Math.angleBetweenPoints(mid, ref) + Math.PI;
    distance = mid.distanceTo(ref);
    curvePoint = new THREE.Vector3();
    curvePoint.x = mid.x + Math.cos(angle) * distance;
    curvePoint.y = mid.y + Math.sin(angle) * distance;
    curvePoint.z = mid.z;
    toA = path.getPoint(0);
    curve = new THREE.TestCurve(fromA, curvePoint);
    points = curve.getPoints(10);
    points.push(toA);
    curveA = _THREE.HermiteCurve(points);
    curveB = _THREE.HermiteCurve(path.getPoints(10));
    return {
      launchedPath: curveA,
      inLoopPath: curveB
    };
  };

  Spaceship.prototype._debugPath = function(path, color) {
    var g, tube;
    if (color == null) {
      color = 0xFF0000;
    }
    g = new THREE.TubeGeometry(path, 200, .5, 10, true);
    tube = THREE.SceneUtils.createMultiMaterialObject(g, [
      new THREE.MeshBasicMaterial({
        color: color,
        opacity: 0.3,
        wireframe: true,
        transparent: true
      }), new THREE.MeshLambertMaterial({
        color: 0xFF88FF,
        side: THREE.DoubleSide
      })
    ]);
    return this.add(tube);
  };

  return Spaceship;

})(THREE.Group);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvZ3JhcGhpY3MvU3BhY2VzaGlwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBO2lTQUFBOztBQUFBLEtBQVcsQ0FBQztBQUVWLDhCQUFBLENBQUE7O0FBQUEsc0JBQUEsSUFBQSxHQUFNLENBQU4sQ0FBQTs7QUFBQSxzQkFFQSxJQUFBLEdBQU0sSUFGTixDQUFBOztBQUFBLHNCQUdBLElBQUEsR0FBTSxJQUhOLENBQUE7O0FBQUEsc0JBSUEsUUFBQSxHQUFVLENBSlYsQ0FBQTs7QUFBQSxzQkFNQSxLQUFBLEdBQU8sSUFOUCxDQUFBOztBQUFBLHNCQVFBLEtBQUEsR0FBTyxDQVJQLENBQUE7O0FBQUEsc0JBVUEsT0FBQSxHQUFTLElBVlQsQ0FBQTs7QUFBQSxFQWFBLFNBQUMsQ0FBQSxJQUFELEdBQVcsTUFiWCxDQUFBOztBQUFBLEVBY0EsU0FBQyxDQUFBLFFBQUQsR0FBVyxVQWRYLENBQUE7O0FBQUEsRUFlQSxTQUFDLENBQUEsT0FBRCxHQUFXLFNBZlgsQ0FBQTs7QUFBQSxFQWdCQSxTQUFDLENBQUEsT0FBRCxHQUFXLFNBaEJYLENBQUE7O0FBa0JhLEVBQUEsbUJBQUMsTUFBRCxFQUFTLE1BQVQsR0FBQTtBQUNYLElBQUEsNENBQUEsU0FBQSxDQUFBLENBQUE7QUFBQSxJQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsTUFGVixDQUFBO0FBQUEsSUFHQSxJQUFDLENBQUEsTUFBRCxHQUFVLE1BSFYsQ0FBQTtBQUFBLElBSUEsSUFBQyxDQUFBLEtBQUQsR0FBVSxJQUFJLENBQUMsTUFBTCxDQUFBLENBQUEsR0FBZ0IsSUFBSSxDQUFDLEVBQXJCLEdBQTBCLENBSnBDLENBQUE7QUFBQSxJQU1BLElBQUMsQ0FBQSxRQUFELENBQVUsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUExQixDQU5BLENBQUE7QUFBQSxJQVFBLElBQUMsQ0FBQSxLQUFELENBQUEsQ0FSQSxDQUFBO0FBQUEsSUFVQSxVQUFBLENBQVcsQ0FBQSxTQUFB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QWtDLEVBQWxDLEVBQXNDLElBQXRDLENBQVgsQ0FBQTtBQUFBLElBQ0EsSUFBQSxHQUFPLEtBQUssQ0FBQyxVQUFVLENBQUMseUJBQWpCLENBQTRDLENBQTVDLEVBQStDO01BQ2hELElBQUEsS0FBSyxDQUFDLGlCQUFOLENBQXdCO0FBQUEsUUFDeEIsS0FBQSxFQUFPLEtBRGlCO0FBQUEsUUFFeEIsT0FBQSxFQUFTLEdBRmU7QUFBQSxRQUd4QixTQUFBLEVBQVcsSUFIYTtBQUFBLFFBSXhCLFdBQUEsRUFBYSxJQUpXO09BQXhCLENBRGdELEVBT2hELElBQUEsS0FBSyxDQUFDLG1CQUFOLENBQTBCO0FBQUEsUUFBRSxLQUFBLEVBQU8sUUFBVDtBQUFBLFFBQW1CLElBQUEsRUFBTSxLQUFLLENBQUMsVUFBL0I7T0FBMUIsQ0FQZ0Q7S0FBL0MsQ0FEUCxDQUFBO1dBVUEsSUFBQyxDQUFBLEdBQUQsQ0FBSyxJQUFMLEVBWFU7RUFBQSxDQTlXWixDQUFBOzttQkFBQTs7R0FGNEIsS0FBSyxDQUFDLE1BQXBDLENBQUEiLCJmaWxlIjoidGhyZWVqcy9ncmFwaGljcy9TcGFjZXNoaXAuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTUEFDRS5TcGFjZXNoaXAgZXh0ZW5kcyBUSFJFRS5Hcm91cFxuXG4gIHRpbWU6IDBcblxuICBzaGlwOiBudWxsXG4gIHBhdGg6IG51bGxcbiAgZHVyYXRpb246IDBcblxuICBzdGF0ZTogbnVsbFxuXG4gIGFuZ2xlOiAwXG5cbiAgX2NhY2hlZDogbnVsbFxuXG4gICMgU1RBVEVTXG4gIEBJRExFOiAgICAgJ0lETEUnXG4gIEBMQVVOQ0hFRDogJ0xBVU5DSEVEJ1xuICBASU5fTE9PUDogICdJTl9MT09QJ1xuICBAQVJSSVZFRDogICdBUlJJVkVEJ1xuXG4gIGNvbnN0cnVjdG9yOiAodGFyZ2V0LCByYWRpdXMpLT5cbiAgICBzdXBlclxuXG4gICAgQHRhcmdldCA9IHRhcmdldFxuICAgIEByYWRpdXMgPSByYWRpdXNcbiAgICBAYW5nbGUgID0gTWF0aC5yYW5kb20oKSAqIE1hdGguUEkgKiAyXG5cbiAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLklETEUpXG5cbiAgICBAc2V0dXAoKVxuXG4gICAgc2V0VGltZW91dCg9PlxuICAgICAgQHNldFN0YXRlKFNQQUNFLlNwYWNlc2hpcC5MQVVOQ0hFRClcbiAgICAsIDIwMDApXG5cbiAgc2V0UmFkaXVzOiAocmFkaXVzKS0+XG4gICAgQHJhZGl1cyA9IHJhZGl1c1xuICAgIEBfY2FjaGVkID1cbiAgICAgIGxhdW5jaGVkUGF0aDogQF9jb21wdXRlTGF1bmNoZWRQYXRoKClcbiAgICAgIGluTG9vcFBhdGg6ICAgQF9jb21wdXRlSW5Mb29wUGF0aCgpXG5cbiAgc2V0dXA6IC0+XG4gICAgZyA9IG5ldyBUSFJFRS5HZW9tZXRyeSgpXG4gICAgZy52ZXJ0aWNlcy5wdXNoKFxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoICAwLCAtNTIuNSwgLTEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTEwLCAtNjcuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoLTUwLCAtNDIuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoICAwLCAgNjcuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoKzUwLCAtNDIuNSwgIDEwKVxuICAgICAgbmV3IFRIUkVFLlZlY3RvcjMoKzEwLCAtNjcuNSwgIDEwKVxuICAgIClcbiAgICBnLmZhY2VzLnB1c2goXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoMCwgMywgMSksXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoMSwgMiwgMyksXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoMywgMCwgNSksXG4gICAgICBuZXcgVEhSRUUuRmFjZTMoNSwgNCwgMylcbiAgICApXG4gICAgZy5jb21wdXRlRmFjZU5vcm1hbHMoKVxuICAgIG1hdHJpeCA9IG5ldyBUSFJFRS5NYXRyaXg0KClcbiAgICBtYXRyaXgubWFrZVJvdGF0aW9uWChNYXRoLlBJKi41KVxuICAgIGcuYXBwbHlNYXRyaXgobWF0cml4KVxuICAgIG1hdHJpeC5tYWtlUm90YXRpb25aKE1hdGguUEkpXG4gICAgZy5hcHBseU1hdHJpeChtYXRyaXgpXG5cbiAgICBAc2hpcCA9IFRIUkVFLlNjZW5lVXRpbHMuY3JlYXRlTXVsdGlNYXRlcmlhbE9iamVjdCggZywgW1xuICAgICAgIyBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoe1xuICAgICAgIyAgICAgY29sb3I6IDB4MDAwMDAwLFxuICAgICAgIyAgICAgb3BhY2l0eTogMC4zLFxuICAgICAgIyAgICAgd2lyZWZyYW1lOiB0cnVlLFxuICAgICAgIyAgICAgdHJhbnNwYXJlbnQ6IHRydWVcbiAgICAgICMgfSksXG4gICAgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweDAwODhmZiwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KVxuICAgIF0pXG4gICAgQHNoaXAuY2FzdFNoYWRvdyA9IHRydWVcbiAgICBAc2hpcC5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgIEBzaGlwLnNjYWxlLnNldCguMTUsIC4xNSwgLjE1KVxuICAgIEBhZGQoQHNoaXApXG5cbiAgICBAX2NhY2hlZCA9IEBfY29tcHV0ZVBhdGhzKClcbiAgICB2ID0gQF9jYWNoZWQubGF1bmNoZWRQYXRoLmdldFBvaW50QXQoMClcbiAgICBAc2hpcC5wb3NpdGlvbi5zZXQodi54LCB2LnksIHYueilcblxuXG4gICAgIyAjIEZvbGxvdyBhIHNwbGluZVxuICAgICMgcG9pbnRzID0gW11cbiAgICAjIHBvaW50cy5wdXNoKFxuICAgICMgICBuZXcgVEhSRUUuVmVjdG9yMyg1MCwgLTUwLCA2MDApLFxuICAgICMgICBuZXcgVEhSRUUuVmVjdG9yMygxMjUsIDEyNSwgMTI1KSxcbiAgICAjICAgbmV3IFRIUkVFLlZlY3RvcjMoMTI1LCAwLCAxMjUpLFxuICAgICMgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKVxuICAgICMgKVxuXG4gICAgIyBwdHMgICAgICAgPSBbXVxuICAgICMgc3RhcnQgICAgID0gKE1hdGguUEkgKiAyKSAqIE1hdGgucmFuZG9tKClcbiAgICAjIHJhZGl1cyAgICA9IDIwMFxuICAgICMgbWlucmFkICAgID0gMFxuICAgICMgcHJlY2lzaW9uID0gMTAwXG4gICAgIyBmb3IgaSBpbiBbMC4uKHByZWNpc2lvbi0xKV1cbiAgICAjICAgdCAgICAgPSAxIC0gKGkgLyAocHJlY2lzaW9uLTEpKVxuICAgICMgICBhbmdsZSA9IHQgKiBNYXRoLlBJICogMlxuICAgICMgICB4ID0gQHRhcmdldC54ICsgTWF0aC5jb3MoYW5nbGUpICogKG1pbnJhZCArIHJhZGl1cyAqIHQpXG4gICAgIyAgIHkgPSBAdGFyZ2V0LnkgKyBNYXRoLnNpbihhbmdsZSkgKiAobWlucmFkICsgcmFkaXVzICogdClcbiAgICAjICAgcHRzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoeCwgeSwgMCkpXG5cbiAgICAjIGN1cnZlcyA9IG5ldyBUSFJFRS5DdXJ2ZVBhdGgoKVxuICAgICMgZm9yIGkgaW4gWzAuLihwdHMubGVuZ3RoLTEpXSBieSAyXG4gICAgIyAgIGN1cnZlcy5hZGQobmV3IFRIUkVFLkxpbmVDdXJ2ZTMocHRzW2ldLCBwdHNbaSsxXSkpXG5cbiAgICAjICMjIENyZWF0ZSBJbmNvbWluZyBDdXJ2ZVxuICAgICMgaW5jb21pbmcgPSBuZXcgVEhSRUUuSW5jb21pbmdDdXJ2ZShAdGFyZ2V0LCAwLCAyMDApXG4gICAgIyBpbmNvbWluZy5pbnZlcnNlICAgPSB0cnVlXG4gICAgIyBpbmNvbWluZy51c2VHb2xkZW4gPSB0cnVlXG4gICAgIyBpbmNvbWluZ0xlbmd0aCA9IGluY29taW5nLmdldExlbmd0aCgpXG5cbiAgICAjICMjIENyZWF0ZSBMYXVuY2hlZCBDdXJ2ZVxuICAgICMgcG9pbnRzW3BvaW50cy5sZW5ndGgtMV0gPSBpbmNvbWluZy5nZXRQb2ludEF0KDApXG4gICAgIyBsYXVuY2hlZCA9IF9USFJFRS5IZXJtaXRlQ3VydmUocG9pbnRzKVxuXG4gICAgIyBnbGF1bmNoZWQgPSBuZXcgVEhSRUUuVHViZUdlb21ldHJ5KGxhdW5jaGVkLCAyMDAsIC41LCAxMCwgdHJ1ZSlcbiAgICAjIHR1YmUgICA9IFRIUkVFLlNjZW5lVXRpbHMuY3JlYXRlTXVsdGlNYXRlcmlhbE9iamVjdCggZ2xhdW5jaGVkLCBbXG4gICAgIyAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgIyAgICAgICBjb2xvcjogMHgwMDAwMDAsXG4gICAgIyAgICAgICBvcGFjaXR5OiAwLjMsXG4gICAgIyAgICAgICB3aXJlZnJhbWU6IHRydWUsXG4gICAgIyAgICAgICB0cmFuc3BhcmVudDogdHJ1ZVxuICAgICMgICB9KSxcbiAgICAjICAgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHhGRjg4RkYsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSlcbiAgICAjIF0pXG4gICAgIyBAYWRkKHR1YmUpXG5cbiAgICAjIGdpbmNvbWluZyA9IG5ldyBUSFJFRS5UdWJlR2VvbWV0cnkoaW5jb21pbmcsIDIwMCwgLjUsIDEwLCB0cnVlKVxuICAgICMgdHViZSAgID0gVEhSRUUuU2NlbmVVdGlscy5jcmVhdGVNdWx0aU1hdGVyaWFsT2JqZWN0KCBnaW5jb21pbmcsIFtcbiAgICAjICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcbiAgICAjICAgICAgIGNvbG9yOiAweDAwMDAwMCxcbiAgICAjICAgICAgIG9wYWNpdHk6IDAuMyxcbiAgICAjICAgICAgIHdpcmVmcmFtZTogdHJ1ZSxcbiAgICAjICAgICAgIHRyYW5zcGFyZW50OiB0cnVlXG4gICAgIyAgIH0pLFxuICAgICMgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGODhGRiwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KVxuICAgICMgXSlcbiAgICAjIEBhZGQodHViZSlcblxuICAgICMgY2lyYyA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5DaXJjbGVHZW9tZXRyeSgxMCwgMTAwKSwgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHhGRjAwMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSkpXG4gICAgIyBjaXJjLnBvc2l0aW9uLnNldCgxMjUsIDEyNSwgMTI1KVxuICAgICMgQGFkZChjaXJjKVxuXG4gICAgIyBjaXJjID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkNpcmNsZUdlb21ldHJ5KDEwLCAxMDApLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KSlcbiAgICAjIGNpcmMucG9zaXRpb24uc2V0KDEyNSwgMCwgMTI1KVxuICAgICMgQGFkZChjaXJjKVxuXG4gICAgIyBjaXJjID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkNpcmNsZUdlb21ldHJ5KDEwLCAxMDApLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KSlcbiAgICAjIGNpcmMucG9zaXRpb24uc2V0KDAsIDAsIDApXG4gICAgIyBAYWRkKGNpcmMpXG5cblxuXG4gICAgIyB0aW1lICAgICAgPSAwXG5cbiAgICAjIExhdW5jaGVkIFN0YXRlXG4gICAgIyBsb29wdGltZSAgPSA1ICogMTAwMFxuICAgICMgaXNMYXVuY2hlZCA9IHRydWVcbiAgICAjIHBvcyA9IGxhdW5jaGVkLmdldFBvaW50QXQoMClcbiAgICAjIHNoaXAucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopXG4gICAgIyBwYXRoICAgICAgPSBsYXVuY2hlZFxuXG4gICAgIyBzaGlwLnVwZGF0ZSA9IChkZWx0YSk9PlxuICAgICMgICB0aW1lICs9IGRlbHRhXG4gICAgIyAgIHQgPSB0aW1lIC8gbG9vcHRpbWUjKCB0aW1lICUgbG9vcHRpbWUgKSAvIGxvb3B0aW1lXG4gICAgIyAgICMgY29uc29sZS5sb2cgdFxuXG4gICAgIyAgIGlmIHQgPj0gMVxuICAgICMgICAgIHRpbWUgPSAwXG4gICAgIyAgICAgdCA9IDBcbiAgICAjICAgICBpc0xhdW5jaGVkID0gIWlzTGF1bmNoZWRcbiAgICAjICAgICBpZiBpc0xhdW5jaGVkXG4gICAgIyAgICAgICBjb25zb2xlLmxvZyAnaXNMYXVuY2hlZCdcbiAgICAjICAgICAgIGxvb3B0aW1lID0gNSAqIDEwMDBcbiAgICAjICAgICAgIHBhdGggICAgID0gbGF1bmNoZWRcbiAgICAjICAgICBlbHNlXG4gICAgIyAgICAgICBjb25zb2xlLmxvZyAnaXNOb3RMYXVuY2hlZCdcbiAgICAjICAgICAgIGxvb3B0aW1lID0gMzAgKiAxMDAwXG4gICAgIyAgICAgICBwYXRoICAgICA9IGluY29taW5nXG5cbiAgICAjICAgcG9zID0gcGF0aC5nZXRQb2ludEF0KCB0IClcbiAgICAjICAgcG9zLm11bHRpcGx5U2NhbGFyKCAxIClcbiAgICAjICAgc2hpcC5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3MueilcbiAgICAjICAgcG9zLm11bHRpcGx5U2NhbGFyKCAxIClcblxuICAgICMgICBwb3MgPSBwYXRoLmdldFBvaW50QXQoICggdCArIDEwIC8gcGF0aC5nZXRMZW5ndGgoKSApICUgMSApLm11bHRpcGx5U2NhbGFyKCAxIClcbiAgICAjICAgc2hpcC5sb29rQXQocG9zKVxuXG4gICAgIyAjIyBUdXJuIGFyb3VuZCAzRCAofm5lZWQgaW1wcm92ZW1lbnQpXG4gICAgIyBAcG9zaXRpb24uc2V0KDI1MCwgMCwgMClcblxuICAgICMgcG9pbnQgPSBAdGFyZ2V0XG4gICAgIyBvcmJpdCA9IEBwb3NpdGlvblxuICAgICMgZGlzdGFuY2UgPSBvcmJpdC5kaXN0YW5jZVRvKHBvaW50KVxuXG4gICAgIyB0aW1lID0gMFxuICAgICMgc2hpcC51cGRhdGUgPSAoZGVsdGEpPT5cbiAgICAjICAgdGltZSArPSBkZWx0YVxuICAgICMgICBAcG9zaXRpb24ueCA9IGRpc3RhbmNlICogTWF0aC5jb3ModGltZSAqIC4wMDEpXG4gICAgIyAgIEBwb3NpdGlvbi56ID0gZGlzdGFuY2UgKiBNYXRoLnNpbih0aW1lICogLjAwMSlcbiAgICAjICAgQHBvc2l0aW9uLnkgPSBkaXN0YW5jZSAqIE1hdGguY29zKHRpbWUgKiAuMDAxKVxuXG4gICAgIyAjIyBUdXJuIGFyb3VuZCAofm5lZWQgaW1wcm92ZW1lbnQpXG4gICAgIyAjIHNoaXAucm90YXRpb24uc2V0KE1hdGguUEkqLjUsIE1hdGguUEksIE1hdGguUEkqLjUpXG4gICAgIyBAcG9zaXRpb24uc2V0KDI1MCwgMCwgMjUwKVxuXG4gICAgIyBwb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IyKEB0YXJnZXQueCwgQHRhcmdldC56KVxuICAgICMgb3JiaXQgPSBuZXcgVEhSRUUuVmVjdG9yMihAcG9zaXRpb24ueCwgQHBvc2l0aW9uLnopXG4gICAgIyBkaXN0YW5jZSA9IG9yYml0LmRpc3RhbmNlVG8ocG9pbnQpXG5cbiAgICAjIHRpbWUgPSAwXG4gICAgIyBzaGlwLnVwZGF0ZSA9IChkZWx0YSk9PlxuICAgICMgICB0aW1lICs9IGRlbHRhXG4gICAgIyAgIGFuZ2xlID0gdGltZSAqIC4wMDFcbiAgICAjICAgcCAgID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMClcbiAgICAjICAgcC54ID0gZGlzdGFuY2UgKiBNYXRoLmNvcyhhbmdsZSlcbiAgICAjICAgcC55ID0gZGlzdGFuY2UgKiBNYXRoLnNpbihhbmdsZSlcbiAgICAjICAgcC56ID0gQHBvc2l0aW9uLnpcblxuICAgICMgICBAcG9zaXRpb24uc2V0KHAueCwgMCwgcC55KVxuICAgICMgICBAbG9va0F0KEB0YXJnZXQpXG5cbiAgICAjIyBNb3ZlIHRvIGEgZGlyZWN0aW9uXG5cbiAgICAjIHNwZWVkID1cbiAgICAjICAgeDogTWF0aC5yYW5kb20oKSAqIDAuMDVcbiAgICAjICAgeTogMC4wMVxuICAgICMgICB6OiBNYXRoLnJhbmRvbSgpICogMC4wNVxuXG4gICAgIyBAcG9zaXRpb24uc2V0KDI1MCwgLTEwMCwgMjUwKVxuXG4gICAgIyByYXkgPSBuZXcgVEhSRUUuUmF5KEB0YXJnZXQuY2xvbmUoKSwgQHBvc2l0aW9uLmNsb25lKCkpXG4gICAgIyB0aW1lICAgICA9IDBcblxuICAgICMgc2hpcC51cGRhdGUgPSAoZGVsdGEpPT5cbiAgICAjICAgIyBzaGlwLnJvdGF0aW9uLnkgKyA9IHNwZWVkLnlcbiAgICAjICAgdGltZSArPSBkZWx0YVxuICAgICMgICB0ID0gdGltZSAvICg1KjEwMDApXG4gICAgIyAgIHRkID0gMSAtIHRcbiAgICAjICAgcmV0dXJuIGlmIHQgPj0gMVxuXG4gICAgIyAgIHAgPSByYXkuYXQodGQpXG4gICAgIyAgIEBwb3NpdGlvbi5zZXQocC54LCBwLnksIHAueilcblxuICBzZXRTdGF0ZTogKHN0YXRlKS0+XG4gICAgQHN0YXRlID0gc3RhdGVcbiAgICBzd2l0Y2ggc3RhdGVcbiAgICAgIHdoZW4gU1BBQ0UuU3BhY2VzaGlwLklETEVcbiAgICAgICAgU1BBQ0UuTE9HKCdJRExFJylcbiAgICAgICAgQHBhdGggPSBudWxsXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5MQVVOQ0hFRFxuICAgICAgICBTUEFDRS5MT0coJ0xBVU5DSEVEJylcbiAgICAgICAgQF9yZXNldFRpbWUoKVxuICAgICAgICBAcGF0aCA9IEBfY2FjaGVkLmxhdW5jaGVkUGF0aCB8fCBAX2NvbXB1dGVMYXVuY2hlZFBhdGgoKVxuICAgICAgICBAZHVyYXRpb24gPSAxMCAqIDEwMDBcblxuICAgICAgICB2ID0gQHBhdGguZ2V0UG9pbnQoMClcbiAgICAgICAgQHNoaXAucG9zaXRpb24uc2V0KHYueCwgdi55LCB2LnopXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5JTl9MT09QXG4gICAgICAgIFNQQUNFLkxPRygnSU5fTE9PUCcpXG4gICAgICAgIEBfcmVzZXRUaW1lKClcbiAgICAgICAgQHBhdGggPSBAX2NhY2hlZC5pbkxvb3BQYXRoIHx8IEBfY29tcHV0ZUluTG9vcFBhdGgoKVxuICAgICAgICBAZHVyYXRpb24gPSAzMCAqIDEwMDBcblxuICAgICAgICB2ID0gQHBhdGguZ2V0UG9pbnQoMClcbiAgICAgICAgQHNoaXAucG9zaXRpb24uc2V0KHYueCwgdi55LCB2LnopXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5BUlJJVkVEXG4gICAgICAgIFNQQUNFLkxPRygnQVJSSVZFRCcpXG4gICAgICAgIEBwYXRoID0gbnVsbFxuICAgICAgICBzZXRUaW1lb3V0KD0+XG4gICAgICAgICAgQHNldFN0YXRlKFNQQUNFLlNwYWNlc2hpcC5MQVVOQ0hFRClcbiAgICAgICAgLCA1MDAwKVxuICAgICAgZWxzZVxuICAgICAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLklETEUpXG5cbiAgdXBkYXRlOiAoZGVsdGEpLT5cbiAgICBpZiBAc3RhdGUgIT0gU1BBQ0UuU3BhY2VzaGlwLklETEUgYW5kIEBzdGF0ZSAhPSBTUEFDRS5TcGFjZXNoaXAuQVJSSVZFRFxuICAgICAgQHRpbWUgKz0gZGVsdGFcbiAgICAgIHQgPSBNYXRoLm1pbihAdGltZSAvIEBkdXJhdGlvbiwgMSlcblxuICAgICAgaWYgdCA+PSAxXG4gICAgICAgIEBfcmVzZXRUaW1lKClcbiAgICAgICAgaWYgQHN0YXRlID09IFNQQUNFLlNwYWNlc2hpcC5MQVVOQ0hFRFxuICAgICAgICAgIEBzZXRTdGF0ZShTUEFDRS5TcGFjZXNoaXAuSU5fTE9PUClcbiAgICAgICAgZWxzZSBpZiBAc3RhdGUgPT0gU1BBQ0UuU3BhY2VzaGlwLklOX0xPT1BcbiAgICAgICAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLkFSUklWRUQpXG4gICAgICAgIHJldHVyblxuXG4gICAgICBpZiBAc3RhdGUgPT0gU1BBQ0UuU3BhY2VzaGlwLkxBVU5DSEVEXG4gICAgICAgIHQgPSBfRWFzaW5nLlF1YWRyYXRpY0Vhc2VPdXQodClcblxuICAgICAgQF9wcm9ncmVzcyh0KVxuXG4gIF9yZXNldFRpbWU6IC0+XG4gICAgQHRpbWUgPSAwXG5cbiAgX3Byb2dyZXNzOiAodCktPlxuICAgIHYgPSBAcGF0aC5nZXRQb2ludEF0KHQpXG4gICAgQHNoaXAucG9zaXRpb24uc2V0KHYueCwgdi55LCB2LnopXG5cbiAgICBhaGVhZCA9ICBNYXRoLm1pbih0ICsgMTAgLyBAcGF0aC5nZXRMZW5ndGgoKSwgMSlcbiAgICB2ID0gQHBhdGguZ2V0UG9pbnRBdChhaGVhZCkubXVsdGlwbHlTY2FsYXIoIDEgKVxuICAgIEBzaGlwLmxvb2tBdCh2KVxuXG4gICAgaWYgQHN0YXRlID09IFNQQUNFLlNwYWNlc2hpcC5JTl9MT09QXG4gICAgICBAc2hpcC5yb3RhdGlvbi5zZXQoQHNoaXAucm90YXRpb24ueCwgQHNoaXAucm90YXRpb24ueSwgMClcblxuICBfY29tcHV0ZVBhdGhzOiAtPlxuICAgIGZyb21BICAgICA9IG5ldyBUSFJFRS5WZWN0b3IzKClcbiAgICBmcm9tQS54ICAgPSBAdGFyZ2V0LnggKyBNYXRoLmNvcyhAYW5nbGUpICogNTAwXG4gICAgZnJvbUEueSAgID0gQHRhcmdldC55ICsgTWF0aC5zaW4oQGFuZ2xlKSAqIDUwMFxuICAgIGZyb21BLnogICA9IDYwMFxuXG4gICAgcGF0aCAgICAgICAgICAgPSBuZXcgVEhSRUUuSW5jb21pbmdDdXJ2ZShAdGFyZ2V0LCBAYW5nbGUsIEByYWRpdXMpXG4gICAgcGF0aC5pbnZlcnNlICAgPSB0cnVlXG4gICAgcGF0aC51c2VHb2xkZW4gPSB0cnVlXG5cbiAgICAjIyBDcmVhdGUgcGF0aCBsYXVuY2hlZFxuICAgIG1pZCAgICAgID0gcGF0aC5nZXRQb2ludCgwKVxuICAgIHJlZiAgICAgID0gcGF0aC5nZXRQb2ludCguMDI1KVxuICAgIGFuZ2xlICAgID0gX01hdGguYW5nbGVCZXR3ZWVuUG9pbnRzKG1pZCwgcmVmKSArIE1hdGguUElcbiAgICBkaXN0YW5jZSA9IG1pZC5kaXN0YW5jZVRvKHJlZilcblxuICAgIGN1cnZlUG9pbnQgICA9IG5ldyBUSFJFRS5WZWN0b3IzKClcbiAgICBjdXJ2ZVBvaW50LnggPSBtaWQueCArIE1hdGguY29zKGFuZ2xlKSAqIGRpc3RhbmNlXG4gICAgY3VydmVQb2ludC55ID0gbWlkLnkgKyBNYXRoLnNpbihhbmdsZSkgKiBkaXN0YW5jZVxuICAgIGN1cnZlUG9pbnQueiA9IG1pZC56XG5cbiAgICB0b0EgICAgPSBwYXRoLmdldFBvaW50KDApXG4gICAgY3VydmUgID0gbmV3IFRIUkVFLlRlc3RDdXJ2ZShmcm9tQSwgY3VydmVQb2ludClcbiAgICBwb2ludHMgPSBjdXJ2ZS5nZXRQb2ludHMoMTApXG4gICAgcG9pbnRzLnB1c2godG9BKVxuXG4gICAgY3VydmVBID0gX1RIUkVFLkhlcm1pdGVDdXJ2ZShwb2ludHMpXG5cbiAgICAjIyBDcmVhdGUgcGF0aCBpbiB0aGUgbG9vcFxuICAgIGN1cnZlQiA9IF9USFJFRS5IZXJtaXRlQ3VydmUocGF0aC5nZXRQb2ludHMoMTApKVxuXG4gICAgcmV0dXJuIHsgbGF1bmNoZWRQYXRoOiBjdXJ2ZUEsIGluTG9vcFBhdGg6IGN1cnZlQiB9XG5cbiAgIyBfY29tcHV0ZUxhdW5jaGVkUGF0aDogLT5cbiAgIyAgIGluTG9vcFBhdGggPSBAX2NvbXB1dGVJbkxvb3BQYXRoKClcbiAgI1xuICAjICAgYSAgICAgPSBuZXcgVEhSRUUuVmVjdG9yMygpXG4gICMgICBhLnggICA9IEB0YXJnZXQueCArIE1hdGguY29zKEBhbmdsZSkgKiA1MDBcbiAgIyAgIGEueSAgID0gQHRhcmdldC55ICsgTWF0aC5zaW4oQGFuZ2xlKSAqIDUwMFxuICAjICAgYS56ICAgPSA2MDBcbiAgIyAgIGIgICAgID0gaW5Mb29wUGF0aC5nZXRQb2ludEF0KDApLmFkZChuZXcgVEhSRUUuVmVjdG9yMyg1MCwgNTAsIDUwKSlcbiAgIyAgIGN1cnZlID0gbmV3IFRIUkVFLlRlc3RDdXJ2ZShhLCBiKVxuICAjXG4gICMgICBwdHMgPSBbXVxuICAjICAgZm9yIHAgaW4gY3VydmUuZ2V0UG9pbnRzKDEwKVxuICAjICAgICBwdHMucHVzaChwKVxuICAjICAgcHRzLnB1c2goaW5Mb29wUGF0aC5nZXRQb2ludCgwKSlcbiAgIyAgIHBhdGggPSBfVEhSRUUuSGVybWl0ZUN1cnZlKHB0cylcbiAgIyAgIHJldHVybiBwYXRoXG4gICNcbiAgIyBfY29tcHV0ZUluTG9vcFBhdGg6IC0+XG4gICMgICBwYXRoICAgICAgICAgICAgICAgID0gbmV3IFRIUkVFLkluY29taW5nQ3VydmUoQHRhcmdldCwgQGFuZ2xlLCBAcmFkaXVzKVxuICAjICAgcGF0aC5pbnZlcnNlICAgICAgICA9IHRydWVcbiAgIyAgIHBhdGgudXNlR29sZGVuICAgICAgPSB0cnVlXG4gICMgICBjdXJ2ZSAgICAgICAgICAgICAgID0gX1RIUkVFLkhlcm1pdGVDdXJ2ZShwYXRoLmdldFBvaW50cygxMCkpXG4gICMgICBAaW5Mb29wTGVuZ3RoICAgICAgID0gY3VydmUuZ2V0TGVuZ3RoKClcbiAgIyAgIHJldHVybiBjdXJ2ZVxuXG4gIF9kZWJ1Z1BhdGg6IChwYXRoLCBjb2xvcj0weEZGMDAwMCktPlxuICAgIGcgICAgPSBuZXcgVEhSRUUuVHViZUdlb21ldHJ5KHBhdGgsIDIwMCwgLjUsIDEwLCB0cnVlKVxuICAgIHR1YmUgPSBUSFJFRS5TY2VuZVV0aWxzLmNyZWF0ZU11bHRpTWF0ZXJpYWxPYmplY3QoIGcsIFtcbiAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgICAgICAgY29sb3I6IGNvbG9yLFxuICAgICAgICAgIG9wYWNpdHk6IDAuMyxcbiAgICAgICAgICB3aXJlZnJhbWU6IHRydWUsXG4gICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWVcbiAgICAgIH0pLFxuICAgICAgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHhGRjg4RkYsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSlcbiAgICBdKVxuICAgIEBhZGQodHViZSlcbiJdfQ==