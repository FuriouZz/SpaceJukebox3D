var __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.Spaceship = (function(_super) {
  __extends(Spaceship, _super);

  Spaceship.prototype.time = 0;

  Spaceship.prototype.ship = null;

  Spaceship.prototype.path = null;

  Spaceship.prototype.duration = 0;

  Spaceship.prototype.state = null;

  Spaceship.prototype.angle = 0;

  Spaceship.IDLE = 'IDLE';

  Spaceship.LAUNCHED = 'LAUNCHED';

  Spaceship.IN_LOOP = 'IN_LOOP';

  Spaceship.ARRIVED = 'ARRIVED';

  function Spaceship(target, radius) {
    Spaceship.__super__.constructor.apply(this, arguments);
    this.target = target;
    this.radius = radius;
    this.angle = Math.random() * Math.PI * 2;
    this.setState(SPACE.Spaceship.IDLE);
    this.generate();
  }

  Spaceship.prototype.computePosition = function(point, angle, length) {
    var x, y;
    x = point.x + Math.sin(angle) * length;
    y = point.y + Math.cos(angle) * length;
    return new THREE.Vector3(x, y, point.z);
  };

  Spaceship.prototype.generate = function() {
    var g, matrix;
    g = new THREE.Geometry();
    g.vertices.push(new THREE.Vector3(0, -52.5, -10), new THREE.Vector3(-10, -67.5, 10), new THREE.Vector3(-50, -42.5, 10), new THREE.Vector3(0, 67.5, 10), new THREE.Vector3(+50, -42.5, 10), new THREE.Vector3(+10, -67.5, 10));
    g.faces.push(new THREE.Face3(0, 3, 1), new THREE.Face3(1, 2, 3), new THREE.Face3(3, 0, 5), new THREE.Face3(5, 4, 3));
    g.computeFaceNormals();
    matrix = new THREE.Matrix4();
    matrix.makeRotationX(Math.PI * .5);
    g.applyMatrix(matrix);
    matrix.makeRotationZ(Math.PI);
    g.applyMatrix(matrix);
    this.ship = THREE.SceneUtils.createMultiMaterialObject(g, [
      new THREE.MeshBasicMaterial({
        color: 0x000000,
        opacity: 0.3,
        wireframe: true,
        transparent: true
      }), new THREE.MeshLambertMaterial({
        color: 0x0088ff,
        side: THREE.DoubleSide
      })
    ]);
    this.ship.castShadow = true;
    this.ship.receiveShadow = true;
    this.ship.scale.set(.1, .1, .1);
    return this.add(this.ship);
  };

  Spaceship.prototype.setState = function(state) {
    var v;
    this.state = state;
    switch (state) {
      case SPACE.Spaceship.IDLE:
        SPACE.LOG('IDLE');
        return this.path = null;
      case SPACE.Spaceship.LAUNCHED:
        SPACE.LOG('LAUNCHED');
        this.path = this._generateLaunchedPath();
        this.duration = 5 * 1000;
        v = this.path.getPoint(0);
        return this.ship.position.set(v.x, v.y, v.z);
      case SPACE.Spaceship.IN_LOOP:
        SPACE.LOG('IN_LOOP');
        this.path = this._generateInLoopPath();
        this.duration = 30 * 1000;
        v = this.path.getPoint(0);
        return this.ship.position.set(v.x, v.y, v.z);
      case SPACE.Spaceship.ARRIVED:
        SPACE.LOG('ARRIVED');
        return this.path = null;
      default:
        return this.setState(SPACE.Spaceship.IDLE);
    }
  };

  Spaceship.prototype.update = function(delta) {
    var t;
    if (this.state !== SPACE.Spaceship.IDLE && this.state !== SPACE.Spaceship.ARRIVED) {
      this.time += delta;
      t = this.time / this.duration;
      if (t >= 1) {
        this.time = 0;
        if (this.state === SPACE.Spaceship.LAUNCHED) {
          this.setState(SPACE.Spaceship.IN_LOOP);
        } else if (this.state === SPACE.Spaceship.IN_LOOP) {
          this.setState(SPACE.Spaceship.ARRIVED);
        }
        return;
      }
      return this._progress(t);
    }
  };

  Spaceship.prototype._progress = function(t) {
    var ahead, v;
    v = this.path.getPointAt(t);
    this.ship.position.set(v.x, v.y, v.z);
    ahead = (t + 10 / this.path.getLength()) % 1;
    v = this.path.getPointAt(ahead).multiplyScalar(1);
    this.ship.lookAt(v);
    if (this.state === SPACE.Spaceship.IN_LOOP) {
      return this.ship.rotation.set(this.ship.rotation.x, this.ship.rotation.y, 0);
    }
  };

  Spaceship.prototype._generateLaunchedPath = function() {
    var inloopPath, path, points;
    inloopPath = this._generateInLoopPath();
    points = [];
    points.push(new THREE.Vector3(50, -50, 600), new THREE.Vector3(125, 125, 125), new THREE.Vector3(125, 0, 125), inloopPath.getPointAt(0));
    path = _THREE.HermiteCurve(points);
    return path;
  };

  Spaceship.prototype._generateInLoopPath = function() {
    var path;
    path = new THREE.IncomingCurve(this.target, this.angle, 200);
    path.inverse = true;
    path.useGolden = true;
    return path;
  };

  return Spaceship;

})(THREE.Group);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRocmVlanMvZ3JhcGhpY3MvU3BhY2VzaGlwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBO2lTQUFBOztBQUFBLEtBQVcsQ0FBQztBQUVWLDhCQUFBLENBQUE7O0FBQUEsc0JBQUEsSUFBQSxHQUFNLENBQU4sQ0FBQTs7QUFBQSxzQkFFQSxJQUFBLEdBQU0sSUFGTixDQUFBOztBQUFBLHNCQUdBLElBQUEsR0FBTSxJQUhOLENBQUE7O0FBQUEsc0JBSUEsUUFBQSxHQUFVLENBSlYsQ0FBQTs7QUFBQSxzQkFNQSxLQUFBLEdBQU8sSUFOUCxDQUFBOztBQUFBLHNCQVFBLEtBQUEsR0FBTyxDQVJQLENBQUE7O0FBQUEsRUFXQSxTQUFDLENBQUEsSUFBRCxHQUFXLE1BWFgsQ0FBQTs7QUFBQSxFQVlBLFNBQUMsQ0FBQSxRQUFELEdBQVcsVUFaWCxDQUFBOztBQUFBLEVBYUEsU0FBQyxDQUFBLE9BQUQsR0FBVyxTQWJYLENBQUE7O0FBQUEsRUFjQSxTQUFDLENBQUEsT0FBRCxHQUFXLFNBZFgsQ0FBQTs7QUFnQmEsRUFBQSxtQkFBQyxNQUFELEVBQVMsTUFBVCxHQUFBO0FBQ1gsSUFBQSw0Q0FBQSxTQUFBLENBQUEsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLE1BQUQsR0FBVSxNQUZWLENBQUE7QUFBQSxJQUdBLElBQUMsQ0FBQSxNQUFELEdBQVUsTUFIVixDQUFBO0FBQUEsSUFJQSxJQUFDLENBQUEsS0FBRCxHQUFVLElBQUksQ0FBQyxNQUFMLENBQUEsQ0FBQSxHQUFnQixJQUFJLENBQUMsRUFBckIsR0FBMEIsQ0FKcEMsQ0FBQTtBQUFBLElBTUEsSUFBQyxDQUFBLFFBQUQsQ0FBVSxLQUFLLENBQUMsU0FBUyxDQUFDLElBQTFCLENBTkEsQ0FBQTtBQUFBLElBUUEsSUFBQyxDQUFBLFFBQUQsQ0FBQSxDQVJBLENBRFc7RUFBQSxDQWhCYjs7QUFBQSxzQkErQkEsZUFBQSxHQUFpQixTQUFDLEtBQUQsRUFBUSxLQUFSLEVBQWUsTUFB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R0EsV0FBTyxJQUFQLENBSm1CO0VBQUEsQ0EvU3JCLENBQUE7O21CQUFBOztHQUY0QixLQUFLLENBQUMsTUFBcEMsQ0FBQSIsImZpbGUiOiJ0aHJlZWpzL2dyYXBoaWNzL1NwYWNlc2hpcC5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFNQQUNFLlNwYWNlc2hpcCBleHRlbmRzIFRIUkVFLkdyb3VwXG5cbiAgdGltZTogMFxuXG4gIHNoaXA6IG51bGxcbiAgcGF0aDogbnVsbFxuICBkdXJhdGlvbjogMFxuXG4gIHN0YXRlOiBudWxsXG5cbiAgYW5nbGU6IDBcblxuICAjIFNUQVRFU1xuICBASURMRTogICAgICdJRExFJ1xuICBATEFVTkNIRUQ6ICdMQVVOQ0hFRCdcbiAgQElOX0xPT1A6ICAnSU5fTE9PUCdcbiAgQEFSUklWRUQ6ICAnQVJSSVZFRCdcblxuICBjb25zdHJ1Y3RvcjogKHRhcmdldCwgcmFkaXVzKS0+XG4gICAgc3VwZXJcblxuICAgIEB0YXJnZXQgPSB0YXJnZXRcbiAgICBAcmFkaXVzID0gcmFkaXVzXG4gICAgQGFuZ2xlICA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMlxuXG4gICAgQHNldFN0YXRlKFNQQUNFLlNwYWNlc2hpcC5JRExFKVxuXG4gICAgQGdlbmVyYXRlKClcblxuICAgICMgc2V0VGltZW91dCg9PlxuICAgICMgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLkxBVU5DSEVEKVxuICAgICMgLCA1MDAwKVxuXG4gIGNvbXB1dGVQb3NpdGlvbjogKHBvaW50LCBhbmdsZSwgbGVuZ3RoKS0+XG4gICAgeCA9IHBvaW50LnggKyBNYXRoLnNpbihhbmdsZSkgKiBsZW5ndGhcbiAgICB5ID0gcG9pbnQueSArIE1hdGguY29zKGFuZ2xlKSAqIGxlbmd0aFxuICAgIHJldHVybiBuZXcgVEhSRUUuVmVjdG9yMyh4LCB5LCBwb2ludC56KVxuXG4gIGdlbmVyYXRlOiAtPlxuICAgICMgQ3JlYXRlIHNwYWNlc2hpcCBnZW9tZXRyeVxuICAgIGcgPSBuZXcgVEhSRUUuR2VvbWV0cnkoKVxuICAgIGcudmVydGljZXMucHVzaChcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCAgMCwgLTUyLjUsIC0xMClcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC0xMCwgLTY3LjUsICAxMClcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKC01MCwgLTQyLjUsICAxMClcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCAgMCwgIDY3LjUsICAxMClcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCs1MCwgLTQyLjUsICAxMClcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKCsxMCwgLTY3LjUsICAxMClcbiAgICApXG4gICAgZy5mYWNlcy5wdXNoKFxuICAgICAgbmV3IFRIUkVFLkZhY2UzKDAsIDMsIDEpLFxuICAgICAgbmV3IFRIUkVFLkZhY2UzKDEsIDIsIDMpLFxuICAgICAgbmV3IFRIUkVFLkZhY2UzKDMsIDAsIDUpLFxuICAgICAgbmV3IFRIUkVFLkZhY2UzKDUsIDQsIDMpXG4gICAgKVxuICAgIGcuY29tcHV0ZUZhY2VOb3JtYWxzKClcbiAgICBtYXRyaXggPSBuZXcgVEhSRUUuTWF0cml4NCgpXG4gICAgbWF0cml4Lm1ha2VSb3RhdGlvblgoTWF0aC5QSSouNSlcbiAgICBnLmFwcGx5TWF0cml4KG1hdHJpeClcbiAgICBtYXRyaXgubWFrZVJvdGF0aW9uWihNYXRoLlBJKVxuICAgIGcuYXBwbHlNYXRyaXgobWF0cml4KVxuXG4gICAgQHNoaXAgPSBUSFJFRS5TY2VuZVV0aWxzLmNyZWF0ZU11bHRpTWF0ZXJpYWxPYmplY3QoIGcsIFtcbiAgICAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgICAgICAgY29sb3I6IDB4MDAwMDAwLFxuICAgICAgICAgIG9wYWNpdHk6IDAuMyxcbiAgICAgICAgICB3aXJlZnJhbWU6IHRydWUsXG4gICAgICAgICAgdHJhbnNwYXJlbnQ6IHRydWVcbiAgICAgIH0pLFxuICAgICAgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHgwMDg4ZmYsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSlcbiAgICBdKVxuICAgIEBzaGlwLmNhc3RTaGFkb3cgPSB0cnVlXG4gICAgQHNoaXAucmVjZWl2ZVNoYWRvdyA9IHRydWVcbiAgICBAc2hpcC5zY2FsZS5zZXQoLjEsIC4xLCAuMSlcbiAgICBAYWRkKEBzaGlwKVxuXG4gICAgIyAjIEZvbGxvdyBhIHNwbGluZVxuICAgICMgcG9pbnRzID0gW11cbiAgICAjIHBvaW50cy5wdXNoKFxuICAgICMgICBuZXcgVEhSRUUuVmVjdG9yMyg1MCwgLTUwLCA2MDApLFxuICAgICMgICBuZXcgVEhSRUUuVmVjdG9yMygxMjUsIDEyNSwgMTI1KSxcbiAgICAjICAgbmV3IFRIUkVFLlZlY3RvcjMoMTI1LCAwLCAxMjUpLFxuICAgICMgICBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAwKVxuICAgICMgKVxuXG4gICAgIyBwdHMgICAgICAgPSBbXVxuICAgICMgc3RhcnQgICAgID0gKE1hdGguUEkgKiAyKSAqIE1hdGgucmFuZG9tKClcbiAgICAjIHJhZGl1cyAgICA9IDIwMFxuICAgICMgbWlucmFkICAgID0gMFxuICAgICMgcHJlY2lzaW9uID0gMTAwXG4gICAgIyBmb3IgaSBpbiBbMC4uKHByZWNpc2lvbi0xKV1cbiAgICAjICAgdCAgICAgPSAxIC0gKGkgLyAocHJlY2lzaW9uLTEpKVxuICAgICMgICBhbmdsZSA9IHQgKiBNYXRoLlBJICogMlxuICAgICMgICB4ID0gQHRhcmdldC54ICsgTWF0aC5jb3MoYW5nbGUpICogKG1pbnJhZCArIHJhZGl1cyAqIHQpXG4gICAgIyAgIHkgPSBAdGFyZ2V0LnkgKyBNYXRoLnNpbihhbmdsZSkgKiAobWlucmFkICsgcmFkaXVzICogdClcbiAgICAjICAgcHRzLnB1c2gobmV3IFRIUkVFLlZlY3RvcjMoeCwgeSwgMCkpXG5cbiAgICAjIGN1cnZlcyA9IG5ldyBUSFJFRS5DdXJ2ZVBhdGgoKVxuICAgICMgZm9yIGkgaW4gWzAuLihwdHMubGVuZ3RoLTEpXSBieSAyXG4gICAgIyAgIGN1cnZlcy5hZGQobmV3IFRIUkVFLkxpbmVDdXJ2ZTMocHRzW2ldLCBwdHNbaSsxXSkpXG5cbiAgICAjICMjIENyZWF0ZSBJbmNvbWluZyBDdXJ2ZVxuICAgICMgaW5jb21pbmcgPSBuZXcgVEhSRUUuSW5jb21pbmdDdXJ2ZShAdGFyZ2V0LCAwLCAyMDApXG4gICAgIyBpbmNvbWluZy5pbnZlcnNlICAgPSB0cnVlXG4gICAgIyBpbmNvbWluZy51c2VHb2xkZW4gPSB0cnVlXG4gICAgIyBpbmNvbWluZ0xlbmd0aCA9IGluY29taW5nLmdldExlbmd0aCgpXG5cbiAgICAjICMjIENyZWF0ZSBMYXVuY2hlZCBDdXJ2ZVxuICAgICMgcG9pbnRzW3BvaW50cy5sZW5ndGgtMV0gPSBpbmNvbWluZy5nZXRQb2ludEF0KDApXG4gICAgIyBsYXVuY2hlZCA9IF9USFJFRS5IZXJtaXRlQ3VydmUocG9pbnRzKVxuXG4gICAgIyBnbGF1bmNoZWQgPSBuZXcgVEhSRUUuVHViZUdlb21ldHJ5KGxhdW5jaGVkLCAyMDAsIC41LCAxMCwgdHJ1ZSlcbiAgICAjIHR1YmUgICA9IFRIUkVFLlNjZW5lVXRpbHMuY3JlYXRlTXVsdGlNYXRlcmlhbE9iamVjdCggZ2xhdW5jaGVkLCBbXG4gICAgIyAgIG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7XG4gICAgIyAgICAgICBjb2xvcjogMHgwMDAwMDAsXG4gICAgIyAgICAgICBvcGFjaXR5OiAwLjMsXG4gICAgIyAgICAgICB3aXJlZnJhbWU6IHRydWUsXG4gICAgIyAgICAgICB0cmFuc3BhcmVudDogdHJ1ZVxuICAgICMgICB9KSxcbiAgICAjICAgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHhGRjg4RkYsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSlcbiAgICAjIF0pXG4gICAgIyBAYWRkKHR1YmUpXG5cbiAgICAjIGdpbmNvbWluZyA9IG5ldyBUSFJFRS5UdWJlR2VvbWV0cnkoaW5jb21pbmcsIDIwMCwgLjUsIDEwLCB0cnVlKVxuICAgICMgdHViZSAgID0gVEhSRUUuU2NlbmVVdGlscy5jcmVhdGVNdWx0aU1hdGVyaWFsT2JqZWN0KCBnaW5jb21pbmcsIFtcbiAgICAjICAgbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKHtcbiAgICAjICAgICAgIGNvbG9yOiAweDAwMDAwMCxcbiAgICAjICAgICAgIG9wYWNpdHk6IDAuMyxcbiAgICAjICAgICAgIHdpcmVmcmFtZTogdHJ1ZSxcbiAgICAjICAgICAgIHRyYW5zcGFyZW50OiB0cnVlXG4gICAgIyAgIH0pLFxuICAgICMgICBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGODhGRiwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KVxuICAgICMgXSlcbiAgICAjIEBhZGQodHViZSlcblxuICAgICMgY2lyYyA9IG5ldyBUSFJFRS5NZXNoKG5ldyBUSFJFRS5DaXJjbGVHZW9tZXRyeSgxMCwgMTAwKSwgbmV3IFRIUkVFLk1lc2hMYW1iZXJ0TWF0ZXJpYWwoeyBjb2xvcjogMHhGRjAwMDAsIHNpZGU6IFRIUkVFLkRvdWJsZVNpZGUgfSkpXG4gICAgIyBjaXJjLnBvc2l0aW9uLnNldCgxMjUsIDEyNSwgMTI1KVxuICAgICMgQGFkZChjaXJjKVxuXG4gICAgIyBjaXJjID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkNpcmNsZUdlb21ldHJ5KDEwLCAxMDApLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KSlcbiAgICAjIGNpcmMucG9zaXRpb24uc2V0KDEyNSwgMCwgMTI1KVxuICAgICMgQGFkZChjaXJjKVxuXG4gICAgIyBjaXJjID0gbmV3IFRIUkVFLk1lc2gobmV3IFRIUkVFLkNpcmNsZUdlb21ldHJ5KDEwLCAxMDApLCBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGMDAwMCwgc2lkZTogVEhSRUUuRG91YmxlU2lkZSB9KSlcbiAgICAjIGNpcmMucG9zaXRpb24uc2V0KDAsIDAsIDApXG4gICAgIyBAYWRkKGNpcmMpXG5cblxuXG4gICAgIyB0aW1lICAgICAgPSAwXG5cbiAgICAjIExhdW5jaGVkIFN0YXRlXG4gICAgIyBsb29wdGltZSAgPSA1ICogMTAwMFxuICAgICMgaXNMYXVuY2hlZCA9IHRydWVcbiAgICAjIHBvcyA9IGxhdW5jaGVkLmdldFBvaW50QXQoMClcbiAgICAjIHNoaXAucG9zaXRpb24uc2V0KHBvcy54LCBwb3MueSwgcG9zLnopXG4gICAgIyBwYXRoICAgICAgPSBsYXVuY2hlZFxuXG4gICAgIyBzaGlwLnVwZGF0ZSA9IChkZWx0YSk9PlxuICAgICMgICB0aW1lICs9IGRlbHRhXG4gICAgIyAgIHQgPSB0aW1lIC8gbG9vcHRpbWUjKCB0aW1lICUgbG9vcHRpbWUgKSAvIGxvb3B0aW1lXG4gICAgIyAgICMgY29uc29sZS5sb2cgdFxuXG4gICAgIyAgIGlmIHQgPj0gMVxuICAgICMgICAgIHRpbWUgPSAwXG4gICAgIyAgICAgdCA9IDBcbiAgICAjICAgICBpc0xhdW5jaGVkID0gIWlzTGF1bmNoZWRcbiAgICAjICAgICBpZiBpc0xhdW5jaGVkXG4gICAgIyAgICAgICBjb25zb2xlLmxvZyAnaXNMYXVuY2hlZCdcbiAgICAjICAgICAgIGxvb3B0aW1lID0gNSAqIDEwMDBcbiAgICAjICAgICAgIHBhdGggICAgID0gbGF1bmNoZWRcbiAgICAjICAgICBlbHNlXG4gICAgIyAgICAgICBjb25zb2xlLmxvZyAnaXNOb3RMYXVuY2hlZCdcbiAgICAjICAgICAgIGxvb3B0aW1lID0gMzAgKiAxMDAwXG4gICAgIyAgICAgICBwYXRoICAgICA9IGluY29taW5nXG5cbiAgICAjICAgcG9zID0gcGF0aC5nZXRQb2ludEF0KCB0IClcbiAgICAjICAgcG9zLm11bHRpcGx5U2NhbGFyKCAxIClcbiAgICAjICAgc2hpcC5wb3NpdGlvbi5zZXQocG9zLngsIHBvcy55LCBwb3MueilcbiAgICAjICAgcG9zLm11bHRpcGx5U2NhbGFyKCAxIClcblxuICAgICMgICBwb3MgPSBwYXRoLmdldFBvaW50QXQoICggdCArIDEwIC8gcGF0aC5nZXRMZW5ndGgoKSApICUgMSApLm11bHRpcGx5U2NhbGFyKCAxIClcbiAgICAjICAgc2hpcC5sb29rQXQocG9zKVxuXG4gICAgIyAjIyBUdXJuIGFyb3VuZCAzRCAofm5lZWQgaW1wcm92ZW1lbnQpXG4gICAgIyBAcG9zaXRpb24uc2V0KDI1MCwgMCwgMClcblxuICAgICMgcG9pbnQgPSBAdGFyZ2V0XG4gICAgIyBvcmJpdCA9IEBwb3NpdGlvblxuICAgICMgZGlzdGFuY2UgPSBvcmJpdC5kaXN0YW5jZVRvKHBvaW50KVxuXG4gICAgIyB0aW1lID0gMFxuICAgICMgc2hpcC51cGRhdGUgPSAoZGVsdGEpPT5cbiAgICAjICAgdGltZSArPSBkZWx0YVxuICAgICMgICBAcG9zaXRpb24ueCA9IGRpc3RhbmNlICogTWF0aC5jb3ModGltZSAqIC4wMDEpXG4gICAgIyAgIEBwb3NpdGlvbi56ID0gZGlzdGFuY2UgKiBNYXRoLnNpbih0aW1lICogLjAwMSlcbiAgICAjICAgQHBvc2l0aW9uLnkgPSBkaXN0YW5jZSAqIE1hdGguY29zKHRpbWUgKiAuMDAxKVxuXG4gICAgIyAjIyBUdXJuIGFyb3VuZCAofm5lZWQgaW1wcm92ZW1lbnQpXG4gICAgIyAjIHNoaXAucm90YXRpb24uc2V0KE1hdGguUEkqLjUsIE1hdGguUEksIE1hdGguUEkqLjUpXG4gICAgIyBAcG9zaXRpb24uc2V0KDI1MCwgMCwgMjUwKVxuXG4gICAgIyBwb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IyKEB0YXJnZXQueCwgQHRhcmdldC56KVxuICAgICMgb3JiaXQgPSBuZXcgVEhSRUUuVmVjdG9yMihAcG9zaXRpb24ueCwgQHBvc2l0aW9uLnopXG4gICAgIyBkaXN0YW5jZSA9IG9yYml0LmRpc3RhbmNlVG8ocG9pbnQpXG5cbiAgICAjIHRpbWUgPSAwXG4gICAgIyBzaGlwLnVwZGF0ZSA9IChkZWx0YSk9PlxuICAgICMgICB0aW1lICs9IGRlbHRhXG4gICAgIyAgIGFuZ2xlID0gdGltZSAqIC4wMDFcbiAgICAjICAgcCAgID0gbmV3IFRIUkVFLlZlY3RvcjMoMCwgMCwgMClcbiAgICAjICAgcC54ID0gZGlzdGFuY2UgKiBNYXRoLmNvcyhhbmdsZSlcbiAgICAjICAgcC55ID0gZGlzdGFuY2UgKiBNYXRoLnNpbihhbmdsZSlcbiAgICAjICAgcC56ID0gQHBvc2l0aW9uLnpcblxuICAgICMgICBAcG9zaXRpb24uc2V0KHAueCwgMCwgcC55KVxuICAgICMgICBAbG9va0F0KEB0YXJnZXQpXG5cbiAgICAjIyBNb3ZlIHRvIGEgZGlyZWN0aW9uXG5cbiAgICAjIHNwZWVkID1cbiAgICAjICAgeDogTWF0aC5yYW5kb20oKSAqIDAuMDVcbiAgICAjICAgeTogMC4wMVxuICAgICMgICB6OiBNYXRoLnJhbmRvbSgpICogMC4wNVxuXG4gICAgIyBAcG9zaXRpb24uc2V0KDI1MCwgLTEwMCwgMjUwKVxuXG4gICAgIyByYXkgPSBuZXcgVEhSRUUuUmF5KEB0YXJnZXQuY2xvbmUoKSwgQHBvc2l0aW9uLmNsb25lKCkpXG4gICAgIyB0aW1lICAgICA9IDBcblxuICAgICMgc2hpcC51cGRhdGUgPSAoZGVsdGEpPT5cbiAgICAjICAgIyBzaGlwLnJvdGF0aW9uLnkgKyA9IHNwZWVkLnlcbiAgICAjICAgdGltZSArPSBkZWx0YVxuICAgICMgICB0ID0gdGltZSAvICg1KjEwMDApXG4gICAgIyAgIHRkID0gMSAtIHRcbiAgICAjICAgcmV0dXJuIGlmIHQgPj0gMVxuXG4gICAgIyAgIHAgPSByYXkuYXQodGQpXG4gICAgIyAgIEBwb3NpdGlvbi5zZXQocC54LCBwLnksIHAueilcblxuICBzZXRTdGF0ZTogKHN0YXRlKS0+XG4gICAgQHN0YXRlID0gc3RhdGVcbiAgICBzd2l0Y2ggc3RhdGVcbiAgICAgIHdoZW4gU1BBQ0UuU3BhY2VzaGlwLklETEVcbiAgICAgICAgU1BBQ0UuTE9HKCdJRExFJylcbiAgICAgICAgQHBhdGggPSBudWxsXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5MQVVOQ0hFRFxuICAgICAgICBTUEFDRS5MT0coJ0xBVU5DSEVEJylcbiAgICAgICAgQHBhdGggPSBAX2dlbmVyYXRlTGF1bmNoZWRQYXRoKClcbiAgICAgICAgQGR1cmF0aW9uID0gNSAqIDEwMDBcblxuICAgICAgICB2ID0gQHBhdGguZ2V0UG9pbnQoMClcbiAgICAgICAgQHNoaXAucG9zaXRpb24uc2V0KHYueCwgdi55LCB2LnopXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5JTl9MT09QXG4gICAgICAgIFNQQUNFLkxPRygnSU5fTE9PUCcpXG4gICAgICAgIEBwYXRoID0gQF9nZW5lcmF0ZUluTG9vcFBhdGgoKVxuICAgICAgICBAZHVyYXRpb24gPSAzMCAqIDEwMDBcblxuICAgICAgICB2ID0gQHBhdGguZ2V0UG9pbnQoMClcbiAgICAgICAgQHNoaXAucG9zaXRpb24uc2V0KHYueCwgdi55LCB2LnopXG4gICAgICB3aGVuIFNQQUNFLlNwYWNlc2hpcC5BUlJJVkVEXG4gICAgICAgIFNQQUNFLkxPRygnQVJSSVZFRCcpXG4gICAgICAgIEBwYXRoID0gbnVsbFxuICAgICAgZWxzZVxuICAgICAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLklETEUpXG5cbiAgdXBkYXRlOiAoZGVsdGEpLT5cbiAgICBpZiBAc3RhdGUgIT0gU1BBQ0UuU3BhY2VzaGlwLklETEUgYW5kIEBzdGF0ZSAhPSBTUEFDRS5TcGFjZXNoaXAuQVJSSVZFRFxuICAgICAgQHRpbWUgKz0gZGVsdGFcbiAgICAgIHQgPSBAdGltZSAvIEBkdXJhdGlvblxuXG4gICAgICBpZiB0ID49IDFcbiAgICAgICAgQHRpbWUgPSAwXG4gICAgICAgIGlmIEBzdGF0ZSA9PSBTUEFDRS5TcGFjZXNoaXAuTEFVTkNIRURcbiAgICAgICAgICBAc2V0U3RhdGUoU1BBQ0UuU3BhY2VzaGlwLklOX0xPT1ApXG4gICAgICAgIGVsc2UgaWYgQHN0YXRlID09IFNQQUNFLlNwYWNlc2hpcC5JTl9MT09QXG4gICAgICAgICAgQHNldFN0YXRlKFNQQUNFLlNwYWNlc2hpcC5BUlJJVkVEKVxuICAgICAgICByZXR1cm5cblxuICAgICAgQF9wcm9ncmVzcyh0KVxuXG4gIF9wcm9ncmVzczogKHQpLT5cbiAgICB2ID0gQHBhdGguZ2V0UG9pbnRBdCh0KVxuICAgIEBzaGlwLnBvc2l0aW9uLnNldCh2LngsIHYueSwgdi56KVxuXG4gICAgYWhlYWQgPSAgKCB0ICsgMTAgLyBAcGF0aC5nZXRMZW5ndGgoKSApICUgMVxuICAgIHYgPSBAcGF0aC5nZXRQb2ludEF0KGFoZWFkKS5tdWx0aXBseVNjYWxhciggMSApXG4gICAgQHNoaXAubG9va0F0KHYpXG5cbiAgICBpZiBAc3RhdGUgPT0gU1BBQ0UuU3BhY2VzaGlwLklOX0xPT1BcbiAgICAgIEBzaGlwLnJvdGF0aW9uLnNldChAc2hpcC5yb3RhdGlvbi54LCBAc2hpcC5yb3RhdGlvbi55LCAwKVxuXG4gIF9nZW5lcmF0ZUxhdW5jaGVkUGF0aDogLT5cbiAgICBpbmxvb3BQYXRoID0gQF9nZW5lcmF0ZUluTG9vcFBhdGgoKVxuXG4gICAgcG9pbnRzID0gW11cbiAgICBwb2ludHMucHVzaChcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDUwLCAtNTAsIDYwMCksXG4gICAgICBuZXcgVEhSRUUuVmVjdG9yMygxMjUsIDEyNSwgMTI1KSxcbiAgICAgIG5ldyBUSFJFRS5WZWN0b3IzKDEyNSwgMCwgMTI1KSxcbiAgICAgIGlubG9vcFBhdGguZ2V0UG9pbnRBdCgwKVxuICAgIClcbiAgICBwYXRoID0gX1RIUkVFLkhlcm1pdGVDdXJ2ZShwb2ludHMpXG4gICAgcmV0dXJuIHBhdGhcblxuICBfZ2VuZXJhdGVJbkxvb3BQYXRoOiAtPlxuICAgIHBhdGggPSBuZXcgVEhSRUUuSW5jb21pbmdDdXJ2ZShAdGFyZ2V0LCBAYW5nbGUsIDIwMClcbiAgICBwYXRoLmludmVyc2UgICA9IHRydWVcbiAgICBwYXRoLnVzZUdvbGRlbiA9IHRydWVcbiAgICByZXR1cm4gcGF0aFxuIl19