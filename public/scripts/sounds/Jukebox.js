var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

SPACE.Jukebox = (function() {
  Jukebox.prototype.current = null;

  Jukebox.prototype.playlist = null;

  Jukebox.prototype.state = null;

  Jukebox.prototype.SC = null;

  Jukebox.IS_PLAYING = 'IS_PLAYING';

  Jukebox.IS_STOPPED = 'IS_STOPPED';

  function Jukebox() {
    this._onfinish = __bind(this._onfinish, this);
    this._onplay = __bind(this._onplay, this);
    this._starting = __bind(this._starting, this);
    this._eTrackAdded = __bind(this._eTrackAdded, this);
    this.SC = new SPACE.SoundCloud(SPACE.SOUNDCLOUD.id, SPACE.SOUNDCLOUD.redirect_uri);
    this.playlist = [];
    this._events();
  }

  Jukebox.prototype._events = function() {
    return document.addEventListener(JUKEBOX.TRACK_ADDED.type, this._eTrackAdded);
  };

  Jukebox.prototype._eTrackAdded = function(e) {
    var track;
    track = e.object.track;
    track.pendingDuration = this._calcPending(this.playlist.length - 1);
    this.playlist.push(e.object.track);
    return SPACE.LOG('Sound added: ' + e.object.track.data.title);
  };

  Jukebox.prototype.predefinedPlaylist = function() {
    var list;
    list = ['https://soundcloud.com/chonch-2/courte-danse-macabre', 'https://soundcloud.com/chonch-2/mouais', 'https://soundcloud.com/chonch-2/cacaco-2', 'https://soundcloud.com/chonch-2/duodenum', 'https://soundcloud.com/chonch-2/little-green-monkey'];
    list = _Coffee.shuffle(list);
    setTimeout((function(_this) {
      return function() {
        return _this.add(list[0]);
      };
    })(this), 1000);
    setTimeout((function(_this) {
      return function() {
        return _this.add(list[1]);
      };
    })(this), 2000);
    setTimeout((function(_this) {
      return function() {
        return _this.add(list[2]);
      };
    })(this), 3000);
    setTimeout((function(_this) {
      return function() {
        return _this.add(list[3]);
      };
    })(this), 4000);
    return setTimeout((function(_this) {
      return function() {
        return _this.add(list[4]);
      };
    })(this), 5000);
  };

  Jukebox.prototype.setState = function(state) {
    this.state = state;
    switch (state) {
      case SPACE.Jukebox.IS_PLAYING:
        return SPACE.LOG('Next: ' + this.current.data.title);
      default:
        return SPACE.LOG('jukeboxisstopped');
    }
  };

  Jukebox.prototype.list = function() {
    var list, track, _i, _len, _ref;
    list = [];
    _ref = this.playlist;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      track = _ref[_i];
      list.push({
        title: track.data.title,
        pendingDuration: track.pendingDuration
      });
    }
    return list;
  };

  Jukebox.prototype.add = function(soundOrPlaylist) {
    return this.SC.getSoundOrPlaylist(soundOrPlaylist, (function(_this) {
      return function(o) {
        var data, track, tracks, _i, _len, _results;
        tracks = null;
        if (o.hasOwnProperty('tracks')) {
          tracks = _Coffee.shuffle(o.tracks);
        } else {
          tracks = [];
          tracks.push(o);
        }
        _results = [];
        for (_i = 0, _len = tracks.length; _i < _len; _i++) {
          data = tracks[_i];
          track = new SPACE.Track(data);
          _results.push(_H.trigger(JUKEBOX.TRACK_ON_ADD, {
            track: track
          }));
        }
        return _results;
      };
    })(this));
  };

  Jukebox.prototype._calcPending = function(position) {
    var duration, i, track, _i, _len, _ref;
    duration = 0;
    _ref = this.playlist;
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      track = _ref[i];
      duration += track.data.duration;
      if (i === position) {
        break;
      }
    }
    return duration;
  };

  Jukebox.prototype.update = function(delta) {
    var i, track, _i, _len, _ref;
    _ref = this.playlist;
    for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
      track = _ref[i];
      track.update(delta);
    }
    if (this.playlist.length > 0) {
      if (this.current === null) {
        return this.next();
      }
    }
  };

  Jukebox.prototype.next = function(track) {
    if (this.current) {
      this._onfinish();
    }
    this.current = this.playlist.shift();
    return this.SC.streamSound(this.current.data, this._starting, {
      onplay: this._onplay,
      onfinish: this._onfinish,
      onstop: this._onstop,
      whileplaying: this.whileplaying
    });
  };

  Jukebox.prototype._starting = function(sound) {
    return this.current.sound = sound;
  };

  Jukebox.prototype._onplay = function() {
    _H.trigger(JUKEBOX.IS_PLAYING);
    return this.setState(SPACE.Jukebox.IS_PLAYING);
  };

  Jukebox.prototype._onfinish = function() {
    this.current.sound.stop();
    this.current.sound.destruct();
    this.current = null;
    _H.trigger(JUKEBOX.IS_STOPPED);
    return this.setState(SPACE.Jukebox.IS_STOPPED);
  };

  return Jukebox;

})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNvdW5kcy9KdWtlYm94LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLGtGQUFBOztBQUFBLEtBQVcsQ0FBQztBQUVWLG9CQUFBLE9BQUEsR0FBUyxJQUFULENBQUE7O0FBQUEsb0JBQ0EsUUFBQSxHQUFVLElBRFYsQ0FBQTs7QUFBQSxvQkFHQSxLQUFBLEdBQU8sSUFIUCxDQUFBOztBQUFBLG9CQUtBLEVBQUEsR0FBSSxJQUxKLENBQUE7O0FBQUEsRUFRQSxPQUFDLENBQUEsVUFBRCxHQUFhLFlBUmIsQ0FBQTs7QUFBQSxFQVNBLE9BQUMsQ0FBQSxVQUFELEdBQWEsWUFUYixDQUFBOztBQVdhLEVBQUEsaUJBQUEsR0FBQTtBQUNYLGlEQUFBLENBQUE7QUFBQSw2Q0FBQSxDQUFBO0FBQUEsaURBQUEsQ0FBQTtBQUFBLHVEQUFBLENBQUE7QUFBQSxJQUFBLElBQUMsQ0FBQSxFQUFELEdBQVUsSUFBQSxLQUFLLENBQUMsVUFBTixDQUFpQixLQUFLLENBQUMsVUFBVSxDQUFDLEVBQWxDLEVBQXNDLEtBQUssQ0FBQyxVQUFVLENBQUMsWUFBdkQsQ0FBVixDQUFBO0FBQUEsSUFFQSxJQUFDLENBQUEsUUFBRCxHQUFZLEVBRlosQ0FBQTtBQUFBLElBR0EsSUFBQyxDQUFBLE9BQUQsQ0FBQSxDQUhBLENBRFc7RUFBQSxDQVhiOztBQUFBLG9CQWlCQSxPQUFBLEdBQVMsU0FBQSxHQUFBO1dBQ1AsUUFBUSxDQUFDLGdCQUFULENBQTBCLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBOUMsRUFBb0QsSUFBQyxDQUFBLFlBQXJELEVBRE87RUFBQSxDQWpCVCxDQUFBOztBQUFBLG9CQW9CQSxZQUFBLEdBQWMsU0FBQyxDQUFELEdBQUE7QUFDWixRQUFBLEtBQUE7QUFBQSxJQUFBLEtBQUEsR0FBUSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQWpCLENBQUE7QUFBQSxJQUNBLEtBQUssQ0FBQyxlQUFOLEdBQXdCLElBQUMsQ0FBQSxZQUFELENBQWMsSUFB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bkIsQ0FBQSxDQUFBO1dBQ0EsSUFBQyxDQUFBLFFBQUQsQ0FBVSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQXhCLEVBRk87RUFBQSxDQTFIVCxDQUFBOztBQUFBLG9CQThIQSxTQUFBLEdBQVcsU0FBQSxHQUFBO0FBQ1QsSUFBQSxJQUFDLENBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFmLENBQUEsQ0FBQSxDQUFBO0FBQUEsSUFDQSxJQUFDLENBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxRQUFmLENBQUEsQ0FEQSxDQUFBO0FBQUEsSUFFQSxJQUFDLENBQUEsT0FBRCxHQUFXLElBRlgsQ0FBQTtBQUFBLElBR0EsRUFBRSxDQUFDLE9BQUgsQ0FBVyxPQUFPLENBQUMsVUFBbkIsQ0FIQSxDQUFBO1dBSUEsSUFBQyxDQUFBLFFBQUQsQ0FBVSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQXhCLEVBTFM7RUFBQSxDQTlIWCxDQUFBOztpQkFBQTs7SUFGRixDQUFBIiwiZmlsZSI6InNvdW5kcy9KdWtlYm94LmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgU1BBQ0UuSnVrZWJveFxuXG4gIGN1cnJlbnQ6IG51bGxcbiAgcGxheWxpc3Q6IG51bGxcblxuICBzdGF0ZTogbnVsbFxuXG4gIFNDOiBudWxsXG5cbiAgIyAjIFNUQVRFU1xuICBASVNfUExBWUlORzogJ0lTX1BMQVlJTkcnXG4gIEBJU19TVE9QUEVEOiAnSVNfU1RPUFBFRCdcblxuICBjb25zdHJ1Y3RvcjogLT5cbiAgICBAU0MgPSBuZXcgU1BBQ0UuU291bmRDbG91ZChTUEFDRS5TT1VORENMT1VELmlkLCBTUEFDRS5TT1VORENMT1VELnJlZGlyZWN0X3VyaSlcblxuICAgIEBwbGF5bGlzdCA9IFtdXG4gICAgQF9ldmVudHMoKVxuXG4gIF9ldmVudHM6IC0+XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihKVUtFQk9YLlRSQUNLX0FEREVELnR5cGUsIEBfZVRyYWNrQWRkZWQpXG5cbiAgX2VUcmFja0FkZGVkOiAoZSk9PlxuICAgIHRyYWNrID0gZS5vYmplY3QudHJhY2tcbiAgICB0cmFjay5wZW5kaW5nRHVyYXRpb24gPSBAX2NhbGNQZW5kaW5nKEBwbGF5bGlzdC5sZW5ndGgtMSlcbiAgICBAcGxheWxpc3QucHVzaChlLm9iamVjdC50cmFjaylcblxuICAgICMgQHBsYXlsaXN0ID0gX0NvZmZlZS5zaHVmZmxlKEBwbGF5bGlzdClcbiAgICBTUEFDRS5MT0coJ1NvdW5kIGFkZGVkOiAnICsgZS5vYmplY3QudHJhY2suZGF0YS50aXRsZSlcblxuICBwcmVkZWZpbmVkUGxheWxpc3Q6IC0+XG4gICAgbGlzdCA9IFtcbiAgICAgICdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL2NvdXJ0ZS1kYW5zZS1tYWNhYnJlJ1xuICAgICAgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vY2hvbmNoLTIvbW91YWlzJ1xuICAgICAgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vY2hvbmNoLTIvY2FjYWNvLTInXG4gICAgICAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9jaG9uY2gtMi9kdW9kZW51bSdcbiAgICAgICdodHRwczovL3NvdW5kY2xvdWQuY29tL2Nob25jaC0yL2xpdHRsZS1ncmVlbi1tb25rZXknXG4gICAgICAjICdodHRwczovL3NvdW5kY2xvdWQuY29tL2h1aHdoYXRhbmR3aGVyZS9zZXRzL3N1cHJlbWUtbGF6aW5lc3MtdGhlLWNlbGVzdGljcydcbiAgICAgICMgJ2h0dHBzOi8vc291bmRjbG91ZC5jb20vdGFrdWdvdGJlYXRzL3NldHMvMjUtbmlnaHRzLWZvci1udWphYmVzJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS90b21taXNjaC9zZXRzL3RvbS1taXNjaC1zb3VsZWN0aW9uLXdoaXRlJ1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9wcm9mZXNzb3JrbGlxL3NldHMvdHJhY2ttYW5pYS12YWxsZXktb3N0J1xuICAgICAgIyAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9wcm9mZXNzb3JrbGlxL3NldHMvdHJhY2ttYW5pYS1zdGFkaXVtLW9zdCdcbiAgICBdXG5cbiAgICBsaXN0ID0gX0NvZmZlZS5zaHVmZmxlKGxpc3QpXG4gICAgIyBmb3IgdXJsLCBpIGluIGxpc3RcbiAgICAjICAgQGFkZChsaXN0W2ldKVxuXG4gICAgc2V0VGltZW91dCg9PlxuICAgICAgQGFkZChsaXN0WzBdKVxuICAgICwgMTAwMClcblxuICAgIHNldFRpbWVvdXQoPT5cbiAgICAgIEBhZGQobGlzdFsxXSlcbiAgICAsIDIwMDApXG5cbiAgICBzZXRUaW1lb3V0KD0+XG4gICAgICBAYWRkKGxpc3RbMl0pXG4gICAgLCAzMDAwKVxuXG4gICAgc2V0VGltZW91dCg9PlxuICAgICAgQGFkZChsaXN0WzNdKVxuICAgICwgNDAwMClcblxuICAgIHNldFRpbWVvdXQoPT5cbiAgICAgIEBhZGQobGlzdFs0XSlcbiAgICAsIDUwMDApXG5cbiAgc2V0U3RhdGU6IChzdGF0ZSktPlxuICAgIEBzdGF0ZSA9IHN0YXRlXG4gICAgc3dpdGNoKHN0YXRlKVxuICAgICAgd2hlbiBTUEFDRS5KdWtlYm94LklTX1BMQVlJTkdcbiAgICAgICAgU1BBQ0UuTE9HKCdOZXh0OiAnICsgQGN1cnJlbnQuZGF0YS50aXRsZSlcbiAgICAgIGVsc2VcbiAgICAgICAgU1BBQ0UuTE9HKCdqdWtlYm94aXNzdG9wcGVkJylcblxuICBsaXN0OiAtPlxuICAgIGxpc3QgPSBbXVxuICAgIGZvciB0cmFjayBpbiBAcGxheWxpc3RcbiAgICAgIGxpc3QucHVzaCh7dGl0bGU6IHRyYWNrLmRhdGEudGl0bGUsIHBlbmRpbmdEdXJhdGlvbjogdHJhY2sucGVuZGluZ0R1cmF0aW9ufSlcbiAgICByZXR1cm4gbGlzdFxuXG4gIGFkZDogKHNvdW5kT3JQbGF5bGlzdCktPlxuICAgIEBTQy5nZXRTb3VuZE9yUGxheWxpc3Qgc291bmRPclBsYXlsaXN0LCAobyk9PlxuICAgICAgdHJhY2tzID0gbnVsbFxuICAgICAgaWYgby5oYXNPd25Qcm9wZXJ0eSgndHJhY2tzJylcbiAgICAgICAgdHJhY2tzID0gX0NvZmZlZS5zaHVmZmxlKG8udHJhY2tzKVxuICAgICAgZWxzZVxuICAgICAgICB0cmFja3MgPSBbXVxuICAgICAgICB0cmFja3MucHVzaChvKVxuXG4gICAgICBmb3IgZGF0YSBpbiB0cmFja3NcbiAgICAgICAgdHJhY2sgPSBuZXcgU1BBQ0UuVHJhY2soZGF0YSlcbiAgICAgICAgX0gudHJpZ2dlcihKVUtFQk9YLlRSQUNLX09OX0FERCwgeyB0cmFjazogdHJhY2sgfSlcblxuICBfY2FsY1BlbmRpbmc6IChwb3NpdGlvbiktPlxuICAgIGR1cmF0aW9uID0gMFxuICAgIGZvciB0cmFjaywgaSBpbiBAcGxheWxpc3RcbiAgICAgIGR1cmF0aW9uICs9IHRyYWNrLmRhdGEuZHVyYXRpb25cbiAgICAgIGJyZWFrIGlmIGkgPT0gcG9zaXRpb25cbiAgICByZXR1cm4gZHVyYXRpb25cblxuICB1cGRhdGU6IChkZWx0YSktPlxuICAgIGZvciB0cmFjaywgaSBpbiBAcGxheWxpc3RcbiAgICAgIHRyYWNrLnVwZGF0ZShkZWx0YSlcblxuICAgIGlmIEBwbGF5bGlzdC5sZW5ndGggPiAwXG4gICAgICBAbmV4dCgpIGlmIEBjdXJyZW50ID09IG51bGxcblxuICBuZXh0OiAodHJhY2spLT5cbiAgICBAX29uZmluaXNoKCkgaWYgQGN1cnJlbnRcbiAgICBAY3VycmVudCA9IEBwbGF5bGlzdC5zaGlmdCgpXG4gICAgIyBAY3VycmVudC5zcGFjZXNoaXAucGFyZW50LnJlbW92ZUNoaWxkKEBjdXJyZW50LnNwYWNlc2hpcClcblxuICAgIEBTQy5zdHJlYW1Tb3VuZChAY3VycmVudC5kYXRhLCBAX3N0YXJ0aW5nLCB7XG4gICAgICBvbnBsYXkgICAgICAgOiBAX29ucGxheVxuICAgICAgb25maW5pc2ggICAgIDogQF9vbmZpbmlzaFxuICAgICAgb25zdG9wICAgICAgIDogQF9vbnN0b3BcbiAgICAgIHdoaWxlcGxheWluZyA6IEB3aGlsZXBsYXlpbmdcbiAgICB9KVxuXG4gIF9zdGFydGluZzogKHNvdW5kKT0+XG4gICAgQGN1cnJlbnQuc291bmQgPSBzb3VuZFxuXG4gIF9vbnBsYXk6ID0+XG4gICAgX0gudHJpZ2dlcihKVUtFQk9YLklTX1BMQVlJTkcpXG4gICAgQHNldFN0YXRlKFNQQUNFLkp1a2Vib3guSVNfUExBWUlORylcblxuICBfb25maW5pc2g6ID0+XG4gICAgQGN1cnJlbnQuc291bmQuc3RvcCgpXG4gICAgQGN1cnJlbnQuc291bmQuZGVzdHJ1Y3QoKVxuICAgIEBjdXJyZW50ID0gbnVsbFxuICAgIF9ILnRyaWdnZXIoSlVLRUJPWC5JU19TVE9QUEVEKVxuICAgIEBzZXRTdGF0ZShTUEFDRS5KdWtlYm94LklTX1NUT1BQRUQpXG4iXX0=