var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.MainScene = (function(_super) {
  __extends(MainScene, _super);

  MainScene.prototype.equalizer = null;

  MainScene.prototype.jukebox = null;

  MainScene.prototype.waveformData = null;

  function MainScene() {
    this._whileplaying = __bind(this._whileplaying, this);
    this._eJukeboxIsStopped = __bind(this._eJukeboxIsStopped, this);
    this._eTrackOnAdd = __bind(this._eTrackOnAdd, this);
    var middlePoint, options;
    MainScene.__super__.constructor.apply(this, arguments);
    middlePoint = new THREE.Vector3(0, 0, 0);
    options = {
      minLength: 0,
      maxLength: 100,
      radius: 300,
      absolute: false,
      lineForceDown: .5,
      lineForceUp: 1
    };
    this.equalizer = new SPACE.Equalizer(middlePoint, options);
    this.add(this.equalizer);
    this.jukebox = new SPACE.Jukebox();
    this.jukebox.whileplaying = this._whileplaying;
    this.jukebox.predefinedPlaylist();
    this.setupSomething();
    this.waveformData = {};
    this._events();
  }

  MainScene.prototype._events = function() {
    document.addEventListener(JUKEBOX.TRACK_ON_ADD.type, this._eTrackOnAdd);
    return document.addEventListener(JUKEBOX.IS_STOPPED.type, this._eJukeboxIsStopped);
  };

  MainScene.prototype._eTrackOnAdd = function(e) {
    var spaceship, track;
    spaceship = new SPACE.Spaceship(this.equalizer.center, this.equalizer.radius);
    this.add(spaceship);
    track = e.object.track;
    track.spaceship = spaceship;
    return _H.trigger(JUKEBOX.TRACK_ADDED, {
      track: track
    });
  };

  MainScene.prototype._eJukeboxIsStopped = function(e) {
    return this.equalizer.mute();
  };

  MainScene.prototype.setupSomething = function() {
    var g, light, m;
    g = new THREE.BoxGeometry(100, 100, 100);
    m = new THREE.MeshLambertMaterial({
      color: 0x0088ff,
      shading: THREE.FlatShading
    });
    this.cube = new THREE.Mesh(g, m);
    this.cube.scale.set(.5, .5, .5);
    this.cube.rotation.set(Math.random(), Math.random(), Math.random());
    this.cube.castShadow = true;
    this.cube.receiveShadow = true;
    this.add(this.cube);
    this.cube.update = function() {
      this.rotation.x += .01;
      this.rotation.y -= .01;
      return this.rotation.z += .01;
    };
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(500, 500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .6);
    light.position.set(-500, 500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(500, -500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .2);
    light.position.set(-500, -500, 500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(500, 500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(-500, 500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(500, -500, -500);
    this.add(light);
    light = new THREE.DirectionalLight(0xFFFFFF, 1.8 * .1);
    light.position.set(-500, -500, -500);
    return this.add(light);
  };

  MainScene.prototype.update = function(delta) {
    MainScene.__super__.update.call(this, delta);
    return this.jukebox.update(delta);
  };

  MainScene.prototype._whileplaying = function() {
    var datas, i, sound, value, _i;
    sound = this.jukebox.current.sound;
    datas = Array(256);
    for (i = _i = 0; _i <= 127; i = ++_i) {
      value = Math.max(sound.waveformData.left[i], sound.waveformData.right[i]);
      datas[i] = datas[255 - i] = value;
    }
    if (this.jukebox.current && this.jukebox.current.sound.paused) {
      this.equalizer.mute();
    } else if (this.waveformData.hasOwnProperty('mono')) {
      this.equalizer.setValues(this.waveformData.mono);
    }
    this.waveformData.mono = datas;
    return this.waveformData.stereo = sound.waveformData;
  };

  return MainScene;

})(SPACE.Scene);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNjZW5lcy9NYWluLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztpU0FBQTs7QUFBQSxLQUFXLENBQUM7QUFFViw4QkFBQSxDQUFBOztBQUFBLHNCQUFBLFNBQUEsR0FBVyxJQUFYLENBQUE7O0FBQUEsc0JBQ0EsT0FBQSxHQUFXLElBRFgsQ0FBQTs7QUFBQSxzQkFHQSxZQUFBLEdBQWMsSUFIZCxDQUFBOztBQUthLEVBQUEsbUJBQUEsR0FBQTtBQUNYLHlEQUFBLENBQUE7QUFBQSxtRUFBQSxDQUFBO0FBQUEsdURBQUEsQ0FBQTtBQUFBLFFBQUEsb0JBQUE7QUFBQSxJQUFBLDRDQUFBLFNBQUEsQ0FBQSxDQUFBO0FBQUEsSUFFQSxXQUFBLEdBQWtCLElBQUEsS0FBSyxDQUFDLE9BQU4sQ0FBYyxDQUFkLEVBQWlCLENBQWpCLEVBQW9CLENBQXBCLENBRmxCLENBQUE7QUFBQSxJQUdBLE9BQUEsR0FDRTtBQUFBLE1BQUEsU0FBQSxFQUFXLENBQVg7QUFBQSxNQUNBLFNBQUEsRUFBVyxHQURYO0FBQUEsTUFFQSxNQUFBLEVBQVEsR0FGUjtBQUFBLE1BR0EsUUFBQSxFQUFVLEtBSFY7QUFBQSxNQUlBLGFBQUEsRUFBZSxFQUpmO0FBQUEsTUFLQSxXQUFBLEVBQWEsQ0FMYjtLQUpGLENBQUE7QUFBQSxJQVdBLElBQUMsQ0FBQSxTQUFELEdBQWlCLElBQUEsS0FBSyxDQUFDLFNBQU4sQ0FBZ0IsV0FBaEIsRUFBNkIsT0FBN0IsQ0FYakIsQ0FBQTtBQUFBLElBWUEsSUFBQyxDQUFBLEdBQUQsQ0FBSyxJQUFDLENBQUEsU0FBTixDQVpBLENBQUE7QUFBQSxJQWNBLElBQUMsQ0FBQSxPQUFELEdBQWUsSUFBQSxLQUFLLENBQUMsT0FBTixDQUFBLENBZGYsQ0FBQTtBQUFBLElBZUEsSUFBQyxDQUFBLE9BQU8sQ0FBQyxZQUFULEdBQXdCLElBQUMsQ0FBQSxhQWZ6QixDQUFBO0FBQUEsSUFnQkEsSUFBQyxDQUFBLE9BQU8sQ0FBQyxrQkFB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O1dBY0EsSUFBQyxDQUFBLFlBQVksQ0FBQyxNQUFkLEdBQXVCLEtBQUssQ0FBQyxhQWZoQjtFQUFBLENBaE5mLENBQUE7O21CQUFBOztHQUY0QixLQUFLLENBQUMsTUFBcEMsQ0FBQSIsImZpbGUiOiJzY2VuZXMvTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFNQQUNFLk1haW5TY2VuZSBleHRlbmRzIFNQQUNFLlNjZW5lXG5cbiAgZXF1YWxpemVyOiBudWxsXG4gIGp1a2Vib3g6ICAgbnVsbFxuXG4gIHdhdmVmb3JtRGF0YTogbnVsbFxuXG4gIGNvbnN0cnVjdG9yOiAtPlxuICAgIHN1cGVyXG5cbiAgICBtaWRkbGVQb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKDAsIDAsIDApXG4gICAgb3B0aW9ucyAgICAgPVxuICAgICAgbWluTGVuZ3RoOiAwXG4gICAgICBtYXhMZW5ndGg6IDEwMFxuICAgICAgcmFkaXVzOiAzMDBcbiAgICAgIGFic29sdXRlOiBmYWxzZVxuICAgICAgbGluZUZvcmNlRG93bjogLjVcbiAgICAgIGxpbmVGb3JjZVVwOiAxXG5cbiAgICBAZXF1YWxpemVyID0gbmV3IFNQQUNFLkVxdWFsaXplcihtaWRkbGVQb2ludCwgb3B0aW9ucylcbiAgICBAYWRkKEBlcXVhbGl6ZXIpXG5cbiAgICBAanVrZWJveCA9IG5ldyBTUEFDRS5KdWtlYm94KClcbiAgICBAanVrZWJveC53aGlsZXBsYXlpbmcgPSBAX3doaWxlcGxheWluZ1xuICAgIEBqdWtlYm94LnByZWRlZmluZWRQbGF5bGlzdCgpXG5cblxuICAgICMgQHNwYWNlc2hpcCA9IG5ldyBTUEFDRS5TcGFjZXNoaXAobWlkZGxlUG9pbnQsIEBlcXVhbGl6ZXIucmFkaXVzKVxuICAgICMgQGFkZChAc3BhY2VzaGlwKVxuICAgICNcbiAgICAjIHNldFRpbWVvdXQoPT5cbiAgICAjICAgQHNwYWNlc2hpcCA9IG5ldyBTUEFDRS5TcGFjZXNoaXAobWlkZGxlUG9pbnQsIEBlcXVhbGl6ZXIucmFkaXVzKVxuICAgICMgICBAYWRkKEBzcGFjZXNoaXApXG4gICAgIyAsIDEwMDApXG4gICAgI1xuICAgICMgc2V0VGltZW91dCg9PlxuICAgICMgICBAc3BhY2VzaGlwID0gbmV3IFNQQUNFLlNwYWNlc2hpcChtaWRkbGVQb2ludCwgQGVxdWFsaXplci5yYWRpdXMpXG4gICAgIyAgIEBhZGQoQHNwYWNlc2hpcClcbiAgICAjICwgMjAwMClcbiAgICAjXG4gICAgIyBzZXRUaW1lb3V0KD0+XG4gICAgIyAgIEBzcGFjZXNoaXAgPSBuZXcgU1BBQ0UuU3BhY2VzaGlwKG1pZGRsZVBvaW50LCBAZXF1YWxpemVyLnJhZGl1cylcbiAgICAjICAgQGFkZChAc3BhY2VzaGlwKVxuICAgICMgLCA0MDAwKVxuICAgICNcbiAgICAjIHNldFRpbWVvdXQoPT5cbiAgICAjICAgQHNwYWNlc2hpcCA9IG5ldyBTUEFDRS5TcGFjZXNoaXAobWlkZGxlUG9pbnQsIEBlcXVhbGl6ZXIucmFkaXVzKVxuICAgICMgICBAYWRkKEBzcGFjZXNoaXApXG4gICAgIyAsIDgwMDApXG4gICAgI1xuICAgICMgc2V0VGltZW91dCg9PlxuICAgICMgICBAc3BhY2VzaGlwID0gbmV3IFNQQUNFLlNwYWNlc2hpcChtaWRkbGVQb2ludCwgQGVxdWFsaXplci5yYWRpdXMpXG4gICAgIyAgIEBhZGQoQHNwYWNlc2hpcClcbiAgICAjICwgMTYwMDApXG4gICAgI1xuICAgICMgc2V0VGltZW91dCg9PlxuICAgICMgICBAc3BhY2VzaGlwID0gbmV3IFNQQUNFLlNwYWNlc2hpcChtaWRkbGVQb2ludCwgQGVxdWFsaXplci5yYWRpdXMpXG4gICAgIyAgIEBhZGQoQHNwYWNlc2hpcClcbiAgICAjICwgMzIwMDApXG4gICAgI1xuICAgICMgc2V0VGltZW91dCg9PlxuICAgICMgICBAc3BhY2VzaGlwID0gbmV3IFNQQUNFLlNwYWNlc2hpcChtaWRkbGVQb2ludCwgQGVxdWFsaXplci5yYWRpdXMpXG4gICAgIyAgIEBhZGQoQHNwYWNlc2hpcClcbiAgICAjICwgNjQwMDApXG4gICAgI1xuICAgICMgc2V0VGltZW91dCg9PlxuICAgICMgICBAc3BhY2VzaGlwID0gbmV3IFNQQUNFLlNwYWNlc2hpcChtaWRkbGVQb2ludCwgQGVxdWFsaXplci5yYWRpdXMpXG4gICAgIyAgIEBhZGQoQHNwYWNlc2hpcClcbiAgICAjICwgMTI4MDAwKVxuXG4gICAgQHNldHVwU29tZXRoaW5nKClcblxuICAgIEB3YXZlZm9ybURhdGEgPSB7fVxuXG4gICAgQF9ldmVudHMoKVxuXG4gIF9ldmVudHM6IC0+XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihKVUtFQk9YLlRSQUNLX09OX0FERC50eXBlLCBAX2VUcmFja09uQWRkKVxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoSlVLRUJPWC5JU19TVE9QUEVELnR5cGUsIEBfZUp1a2Vib3hJc1N0b3BwZWQpXG5cbiAgX2VUcmFja09uQWRkOiAoZSk9PlxuICAgIHNwYWNlc2hpcCA9IG5ldyBTUEFDRS5TcGFjZXNoaXAoQGVxdWFsaXplci5jZW50ZXIsIEBlcXVhbGl6ZXIucmFkaXVzKVxuICAgIEBhZGQoc3BhY2VzaGlwKVxuXG4gICAgdHJhY2sgPSBlLm9iamVjdC50cmFja1xuICAgIHRyYWNrLnNwYWNlc2hpcCA9IHNwYWNlc2hpcFxuICAgIF9ILnRyaWdnZXIoSlVLRUJPWC5UUkFDS19BRERFRCwgeyB0cmFjazogdHJhY2sgfSlcblxuICAgICMgQGRvdHRlZCA9IG5ldyBTUEFDRS5Eb3R0ZWRMaW5lKHRyYWNrKVxuICAgICMgQGFkZENoaWxkKEBkb3R0ZWQpXG5cbiAgX2VKdWtlYm94SXNTdG9wcGVkOiAoZSk9PlxuICAgIEBlcXVhbGl6ZXIubXV0ZSgpXG5cbiAgc2V0dXBTb21ldGhpbmc6IC0+XG4gICAgIyBDdWJlXG4gICAgZyA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSgxMDAsIDEwMCwgMTAwKVxuICAgIG0gPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweDAwODhmZiwgc2hhZGluZzogVEhSRUUuRmxhdFNoYWRpbmcgfSlcbiAgICBAY3ViZSA9IG5ldyBUSFJFRS5NZXNoKGcsIG0pXG4gICAgQGN1YmUuc2NhbGUuc2V0KC41LCAuNSwgLjUpXG4gICAgQGN1YmUucm90YXRpb24uc2V0KE1hdGgucmFuZG9tKCksIE1hdGgucmFuZG9tKCksIE1hdGgucmFuZG9tKCkpXG4gICAgQGN1YmUuY2FzdFNoYWRvdyA9IHRydWVcbiAgICBAY3ViZS5yZWNlaXZlU2hhZG93ID0gdHJ1ZVxuICAgIEBhZGQoQGN1YmUpXG5cbiAgICBAY3ViZS51cGRhdGUgPSAtPlxuICAgICAgQHJvdGF0aW9uLnggKz0gLjAxXG4gICAgICBAcm90YXRpb24ueSAtPSAuMDFcbiAgICAgIEByb3RhdGlvbi56ICs9IC4wMVxuXG4gICAgIyBnID0gbmV3IFRIUkVFLlNwaGVyZUdlb21ldHJ5KClcbiAgICAjIG0gPSBuZXcgVEhSRUUuTWVzaExhbWJlcnRNYXRlcmlhbCh7IGNvbG9yOiAweEZGQUEyMiB9KVxuICAgICMgY2lyY2xlID0gbmV3IFRIUkVFLk1lc2goZywgbSlcbiAgICAjIGNpcmNsZS5jYXN0U2hhZG93ID0gdHJ1ZVxuICAgICMgY2lyY2xlLnJlY2VpdmVTaGFkb3cgPSB0cnVlXG4gICAgIyBAYWRkKGNpcmNsZSlcblxuICAgICMgY2lyY2xlLnVwZGF0ZSA9IC0+XG4gICAgIyAgIEByb3RhdGlvbi54ICs9IC4wMVxuICAgICMgICBAcm90YXRpb24ueSAtPSAuMDFcbiAgICAjICAgQHJvdGF0aW9uLnogKz0gLjAxXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4yIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIDUwMCwgNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjYgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjIgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggNTAwLCAtNTAwLCA1MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjIgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgLTUwMCwgNTAwIClcbiAgICBAYWRkKCBsaWdodCApXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4xIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIDUwMCwgNTAwLCAtNTAwIClcbiAgICBAYWRkKCBsaWdodCApXG5cbiAgICBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KCAweEZGRkZGRiwgMS44Ki4xIClcbiAgICBsaWdodC5wb3NpdGlvbi5zZXQoIC01MDAsIDUwMCwgLTUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgbGlnaHQgPSBuZXcgVEhSRUUuRGlyZWN0aW9uYWxMaWdodCggMHhGRkZGRkYsIDEuOCouMSApXG4gICAgbGlnaHQucG9zaXRpb24uc2V0KCA1MDAsIC01MDAsIC01MDAgKVxuICAgIEBhZGQoIGxpZ2h0IClcblxuICAgIGxpZ2h0ID0gbmV3IFRIUkVFLkRpcmVjdGlvbmFsTGlnaHQoIDB4RkZGRkZGLCAxLjgqLjEgKVxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggLTUwMCwgLTUwMCwgLTUwMCApXG4gICAgQGFkZCggbGlnaHQgKVxuXG4gICAgIyBsaWdodC5jYXN0U2hhZG93ID0gdHJ1ZVxuXG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFOZWFyICAgID0gNzAwXG4gICAgIyBsaWdodC5zaGFkb3dDYW1lcmFGYXIgICAgID0gbWFuYWdlci5fY2FtZXJhLmZhclxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhRm92ICAgICA9IDUwXG5cbiAgICAjIGxpZ2h0LnNoYWRvd0Nhc2NhZGUgPSB0cnVlXG5cbiAgICAjIGxpZ2h0LnNoYWRvd0JpYXMgICAgICAgICAgPSAwLjAwMDFcbiAgICAjIGxpZ2h0LnNoYWRvd0RhcmtuZXNzICAgICAgPSAwLjVcblxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhUmlnaHQgICAgPSAgNVxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhTGVmdCAgICAgPSAtNVxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhVG9wICAgICAgPSAgNVxuICAgICMgbGlnaHQuc2hhZG93Q2FtZXJhQm90dG9tICAgPSAtNVxuXG4gICAgIyBsaWdodC5zaGFkb3dNYXBXaWR0aCAgICAgID0gMjA0OFxuICAgICMgbGlnaHQuc2hhZG93TWFwSGVpZ2h0ICAgICA9IDIwNDhcblxuXG4gICAgIyBoZWxwZXIgPSBuZXcgVEhSRUUuU3BvdExpZ2h0SGVscGVyKGxpZ2h0LCAxKVxuICAgICMgQGFkZChoZWxwZXIpXG5cbiAgICAjIHNwZWVkID1cbiAgICAjICAgeDogTWF0aC5yYW5kb20oKSAqIDAuMDA1XG4gICAgIyAgIHk6IE1hdGgucmFuZG9tKCkgKiAwLjAwNVxuICAgICMgICB6OiBNYXRoLnJhbmRvbSgpICogMC4wMDVcblxuICAgICMgQGN1YmUudXBkYXRlID0gLT5cbiAgICAjICAgQHJvdGF0aW9uLnggKz0gc3BlZWQueFxuICAgICMgICBAcm90YXRpb24ueSArPSBzcGVlZC55XG4gICAgIyAgIEByb3RhdGlvbi56ICs9IHNwZWVkLnpcblxuICB1cGRhdGU6IChkZWx0YSktPlxuICAgIHN1cGVyKGRlbHRhKVxuICAgIEBqdWtlYm94LnVwZGF0ZShkZWx0YSlcblxuICAgICMgaWYgQGp1a2Vib3guc3RhdGUgPT0gU1BBQ0UuSnVrZWJveC5JU19QTEFZSU5HXG4gICAgIyAgIGlmIEBqdWtlYm94LmN1cnJlbnQgYW5kIEBqdWtlYm94LmN1cnJlbnQuc291bmQucGF1c2VkXG4gICAgIyAgICAgQGVxdWFsaXplci5tdXRlKClcbiAgICAjICAgZWxzZSBpZiBAd2F2ZWZvcm1EYXRhLmhhc093blByb3BlcnR5KCdtb25vJylcbiAgICAjICAgICBAZXF1YWxpemVyLnNldFZhbHVlcyhAd2F2ZWZvcm1EYXRhLm1vbm8pXG5cbiAgICAgICMgaWYgIUBqdWtlYm94LmN1cnJlbnQuc291bmQuaXNQbGF5aW5nKClcbiAgICAgICMgICBAZXF1YWxpemVyLm11dGUoKVxuICAgICAgIyBlbHNlXG4gICAgICAjICAgdG1wID0gW11cbiAgICAgICMgICBmb3IgdiwgaSBpbiBAanVrZWJveC5jdXJyZW50LnNvdW5kLmdldFdhdmVmb3JtKClcbiAgICAgICMgICAgIHRtcC5wdXNoKHYpIGlmIGklOCA9PSAwXG5cbiAgICAgICMgICB2YWx1ZXMgPSBBcnJheSh0bXAubGVuZ3RoKVxuICAgICAgIyAgIGZvciBpIGluIFswLi4oKHRtcC5sZW5ndGgqLjUpLTEpXVxuICAgICAgIyAgICAgdmFsdWVzW2ldID0gdmFsdWVzW3RtcC5sZW5ndGgtMS1pXSA9IHRtcFtpXVxuXG4gICAgICAjICAgQGVxdWFsaXplci5zZXRWYWx1ZXModmFsdWVzKVxuXG4gIF93aGlsZXBsYXlpbmc6ID0+XG4gICAgc291bmQgPSBAanVrZWJveC5jdXJyZW50LnNvdW5kXG5cbiAgICBkYXRhcyA9IEFycmF5KDI1NilcbiAgICBmb3IgaSBpbiBbMC4uMTI3XVxuICAgICAgdmFsdWUgPSBNYXRoLm1heChzb3VuZC53YXZlZm9ybURhdGEubGVmdFtpXSwgc291bmQud2F2ZWZvcm1EYXRhLnJpZ2h0W2ldKVxuICAgICAgIyBkYXRhc1tpXSA9IGRhdGFzWzI1NS1pXSA9IHZhbHVlICogTWF0aC5tYXgoc291bmQucGVha0RhdGEubGVmdCwgc291bmQucGVha0RhdGEubGVmdClcbiAgICAgIGRhdGFzW2ldID0gZGF0YXNbMjU1LWldID0gdmFsdWVcblxuICAgIGlmIEBqdWtlYm94LmN1cnJlbnQgYW5kIEBqdWtlYm94LmN1cnJlbnQuc291bmQucGF1c2VkXG4gICAgICBAZXF1YWxpemVyLm11dGUoKVxuICAgIGVsc2UgaWYgQHdhdmVmb3JtRGF0YS5oYXNPd25Qcm9wZXJ0eSgnbW9ubycpXG4gICAgICBAZXF1YWxpemVyLnNldFZhbHVlcyhAd2F2ZWZvcm1EYXRhLm1vbm8pXG5cbiAgICBAd2F2ZWZvcm1EYXRhLm1vbm8gICA9IGRhdGFzXG4gICAgQHdhdmVmb3JtRGF0YS5zdGVyZW8gPSBzb3VuZC53YXZlZm9ybURhdGFcbiJdfQ==