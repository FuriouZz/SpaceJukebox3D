var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

SPACE.Equalizer = (function(_super) {
  __extends(Equalizer, _super);

  Equalizer.prototype.center = null;

  Equalizer.prototype._values = null;

  Equalizer.prototype._newValues = null;

  Equalizer.prototype._oldValues = null;

  Equalizer.prototype._time = 1;

  Equalizer.prototype.material = null;

  Equalizer.prototype.lines = null;

  Equalizer.prototype.isGenerated = false;

  Equalizer.prototype.maxLength = 0;

  Equalizer.prototype.minLength = 0;

  Equalizer.prototype.radius = 0;

  Equalizer.prototype.interpolationTime = 0;

  Equalizer.prototype.color = 0xFFFFFF;

  Equalizer.prototype.lineForceUp = .5;

  Equalizer.prototype.lineForceDown = .5;

  Equalizer.prototype.absolute = false;

  function Equalizer(point, opts) {
    var defaults;
    if (opts == null) {
      opts = {};
    }
    this.random = __bind(this.random, this);
    Equalizer.__super__.constructor.apply(this, arguments);
    defaults = {
      maxLength: 200,
      minLength: 50,
      radius: 250,
      interpolationTime: 150,
      color: 0xDE548E,
      lineForceUp: .5,
      lineForceDown: .5,
      absolute: false
    };
    opts = _Coffee.merge(defaults, opts);
    this.minLength = opts.minLength;
    this.maxLength = opts.maxLength;
    this.radius = opts.radius;
    this.interpolationTime = opts.interpolationTime;
    this.color = opts.color;
    this.lineForceUp = opts.lineForceUp;
    this.lineForceDown = opts.lineForceDown;
    this.absolute = opts.absolute;
    this.center = point;
    this._values = [];
    this._oldValues = [];
    this._newValues = [];
    this.generate();
  }

  Equalizer.prototype.setValues = function(values) {
    var length, newValues, value, _i, _len;
    newValues = [];
    for (_i = 0, _len = values.length; _i < _len; _i++) {
      value = values[_i];
      if (this.absolute) {
        value = Math.abs(value);
      }
      length = this.minLength + parseFloat(value) * (this.maxLength - this.minLength);
      newValues.push(Math.max(length, 0));
    }
    this._newValues = newValues;
    return this.resetInterpolation();
  };

  Equalizer.prototype.generate = function() {
    this.mute();
    this.material = new THREE.LineBasicMaterial({
      color: this.color,
      linewidth: 4
    });
    this.lines = [];
    this.update(0);
    return this.updateGeometries(true);
  };

  Equalizer.prototype.update = function(delta) {
    var diff, i, t, _i, _ref;
    this._time += delta;
    t = this._time / this.interpolationTime;
    if (t > 1) {
      return;
    }
    for (i = _i = 0, _ref = this._newValues.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      diff = this._oldValues[i] - this._newValues[i];
      this._values[i] = this._oldValues[i] - t * diff;
    }
    return this.updateGeometries();
  };

  Equalizer.prototype.updateGeometries = function(create) {
    var angle, from, geometry, i, length, line, radius, to, _i, _ref, _results;
    if (create == null) {
      create = false;
    }
    _results = [];
    for (i = _i = 0, _ref = this._values.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      angle = Math.PI * 2 * i / this._values.length;
      length = this._values[i];
      radius = this.radius;
      from = this.computePosition(this.center, angle, radius - length * this.lineForceDown);
      to = this.computePosition(this.center, angle, radius + length * this.lineForceUp);
      if (typeof this.lines[i] === 'undefined') {
        geometry = new THREE.Geometry();
        geometry.vertices.push(from, to, from);
        line = new THREE.Line(geometry, this.material);
        this.lines.push(line);
        _results.push(this.add(line));
      } else {
        line = this.lines[i];
        line.geometry.vertices[0] = from;
        line.geometry.vertices[1] = to;
        line.geometry.vertices[2] = from;
        _results.push(line.geometry.verticesNeedUpdate = true);
      }
    }
    return _results;
  };

  Equalizer.prototype.random = function(setValues) {
    var i, values, _i;
    if (setValues == null) {
      setValues = true;
    }
    values = [];
    for (i = _i = 0; _i <= 63; i = ++_i) {
      values[i] = Math.random();
    }
    if (setValues) {
      this.setValues(values);
    }
    return values;
  };

  Equalizer.prototype.mute = function(setValues) {
    var i, values, _i;
    if (setValues == null) {
      setValues = true;
    }
    values = [];
    for (i = _i = 0; _i <= 63; i = ++_i) {
      values[i] = 0;
    }
    if (setValues) {
      return this.setValues(values);
    }
  };

  Equalizer.prototype.resetInterpolation = function() {
    var i, _i, _ref, _ref1, _results;
    this._time = 0;
    this._oldValues = this._values;
    if (this._newValues.length > this._oldValues.length) {
      _results = [];
      for (i = _i = _ref = this._oldValues.length, _ref1 = this._newValues.length - 1; _ref <= _ref1 ? _i <= _ref1 : _i >= _ref1; i = _ref <= _ref1 ? ++_i : --_i) {
        _results.push(this._oldValues[i] = 0);
      }
      return _results;
    }
  };

  Equalizer.prototype.computePosition = function(point, angle, length) {
    var x, y;
    x = point.x + Math.sin(angle) * length;
    y = point.y + Math.cos(angle) * length;
    return new THREE.Vector3(x, y, point.z);
  };

  return Equalizer;

})(THREE.Group);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdyYXBoaWNzL0VxdWFsaXplci5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQTs7aVNBQUE7O0FBQUEsS0FBVyxDQUFDO0FBRVYsOEJBQUEsQ0FBQTs7QUFBQSxzQkFBQSxNQUFBLEdBQVksSUFBWixDQUFBOztBQUFBLHNCQUVBLE9BQUEsR0FBWSxJQUZaLENBQUE7O0FBQUEsc0JBR0EsVUFBQSxHQUFZLElBSFosQ0FBQTs7QUFBQSxzQkFJQSxVQUFBLEdBQVksSUFKWixDQUFBOztBQUFBLHNCQU1BLEtBQUEsR0FBWSxDQU5aLENBQUE7O0FBQUEsc0JBU0EsUUFBQSxHQUFZLElBVFosQ0FBQTs7QUFBQSxzQkFVQSxLQUFBLEdBQVksSUFWWixDQUFBOztBQUFBLHNCQVdBLFdBQUEsR0FBYSxLQVhiLENBQUE7O0FBQUEsc0JBY0EsU0FBQSxHQUFtQixDQWRuQixDQUFBOztBQUFBLHNCQWVBLFNBQUEsR0FBbUIsQ0FmbkIsQ0FBQTs7QUFBQSxzQkFnQkEsTUFBQSxHQUFtQixDQWhCbkIsQ0FBQTs7QUFBQSxzQkFpQkEsaUJBQUEsR0FBbUIsQ0FqQm5CLENBQUE7O0FBQUEsc0JBa0JBLEtBQUEsR0FBbUIsUUFsQm5CLENBQUE7O0FBQUEsc0JBbUJBLFdBQUEsR0FBbUIsRUFuQm5CLENBQUE7O0FBQUEsc0JBb0JBLGFBQUEsR0FBbUIsRUFwQm5CLENBQUE7O0FBQUEsc0JBcUJBLFFBQUEsR0FBbUIsS0FyQm5CLENBQUE7O0FBdUJhLEVBQUEsbUJBQUMsS0FBRCxFQUFRLElBQVIsR0FBQTtBQUNYLFFBQUEsUUFBQTs7TUFEbUIsT0FBSztLQUN4QjtBQUFBLDJDQUFBLENBQUE7QUFBQSxJQUFBLDRDQUFBLFNBQUEsQ0FBQSxDQUFBO0FBQUEsSUFHQSxRQUFBLEdBQ0U7QUFBQSxNQUFBLFNBQUEsRUFBbUIsR0FBbkI7QUFBQSxNQUNBLFNBQUEsRUFBbUIsRUFEbkI7QUFBQSxNQUVBLE1BQUEsRUFBbUIsR0FGbkI7QUFBQSxNQUdBLGlCQUFBLEVBQW1CLEdBSG5CO0FBQUEsTUFJQSxLQUFBLEVBQW1CLFFBSm5CO0FBQUEsTUFLQSxXQUFBLEVBQW1CLEVBTG5CO0FBQUEsTUFNQSxhQUFBLEVBQW1CLEVBTm5CO0FBQUEsTUFPQSxRQUFBLEVBQW1CLEtBUG5CO0tBSkYsQ0FBQTtBQUFBLElBYUEsSUFBQSxHQUFxQixPQUFPLENBQUMsS0FBUixDQUFjLFFBQWQsRUFBd0IsSUFBeEIsQ0FickIsQ0FBQTtBQUFBLElBY0EsSUFBQyxDQUFBLFNBQUQsR0FBcUIsSUFBSSxDQUFDLFNBZDFCLENBQUE7QUFBQSxJQWVBLElBQUMsQ0FBQSxTQUFELEdBQXFCLElBQUksQ0FBQyxTQWYxQixDQUFBO0FBQUEsSUFnQkEsSUFBQyxDQUFBLE1BQUQsR0FBcUIsSUFBSSxDQUFDLE1BaEIxQixDQUFBO0FBQUEsSUFpQkEsSUFBQyxDQUFBLGlCQUFELEdBQXFCLElBQUksQ0FBQyxpQkFqQjFCLENBQUE7QUFBQSxJQWtCQSxJQUFDLENBQUEsS0FBRCxHQUFxQixJQUFJLENBQUMsS0FsQjFCLENBQUE7QUFBQSxJQW1CQSxJQUFDLENBQUEsV0FBRCxHQUFxQixJQUFJLENBQUMsV0FuQjFCLENBQUE7QUFBQSxJQW9CQSxJQUFDLENBQUEsYUFBRCxHQUFxQixJQUFJLENBQUMsYUFwQjFCLENBQUE7QUFBQSxJQXFCQSxJQUFDLENBQUEsUUFBRCxHQUFxQixJQUFJLENBQUMsUUFyQjFCLENBQUE7QUFBQSxJQXdCQSxJQUFDLENBQUEsTUFBRCxHQUFjLEtBeEJkLENBQUE7QUFBQSxJQXlCQSxJQUFDLENBQUEsT0FBRCxHQUFjLEVBekJkLENBQUE7QUFBQSxJQTBCQSxJQUFDLENBQUEsVUFBRCxHQUFjLEVBMUJkLENBQUE7QUFBQSxJQTJCQSxJQUFDLENBQUEsVUFBRCxHQUFjLEVBM0JkLENBQUE7QUFBQSxJQTZCQSxJQUFDLENBQUEsUUFBRCxDQUFBLENBN0JBLENBRFc7RUFBQSxDQXZCYjs7QUFBQSxzQkF1REEsU0FBQSxHQUFXLFNBQUMsTUFBRCxHQUFBO0FBQ1QsUUFBQSxrQ0FBQTtBQUFBLElBQUEsU0FBQSxHQUFZLEVBQVosQ0FBQTtBQUNBLFNBQUEsNkNBQUE7eUJBQUE7QUFDRSxNQUFBLElBQTJCLElBQUMsQ0FBQSxRQUE1QjtBQUFBLFFBQUEsS0FBQSxHQUFRLElBQUksQ0FBQyxHQUFMLENBQVMsS0FBVCxDQUFSLENBQUE7T0FBQTtBQUFBLE1BQ0EsTUFBQSxHQUFTLElBQUMsQ0FBQSxTQUFELEdBQWEsVUFBQSxDQUFXLEtBQVgsQ0FBQSxHQUFrQixDQUFDLElBQUMsQ0FBQSxTQUFELEdBQWEsSUFBQyxDQUFBLFNBQWYsQ0FEeEMsQ0FBQTtBQUFBLE1BRUEsU0FBUyxDQUFDLElBQVYsQ0FBZSxJQUFJLENBQUMsR0FBTCxDQUFTLE1BQVQsRUFBaUIsQ0FBakIsQ0FBZixDQUZBLENBREY7QUFBQSxLQURBO0FBQUEsSUFLQSxJQUFDLENBQUEsVUFBRCxHQUFjLFNBTGQsQ0FBQTtXQU1BLElBQUMsQ0FBQSxrQkFBRCxDQUFBLEVBUFM7RUFBQSxDQXZEWCxDQUFBOztBQUFBLHNCQWdFQSxRQUFBLEdBQVUsU0FBQSxHQUFBO0FBQ1IsSUFBQSxJQUFDLENBQUEsSUFBRCxDQUFBLENBQUEsQ0FBQTtBQUFBLElBRUEsSUFBQyxDQUFBLFFBQUQsR0FBa0IsSUFBQSxLQUFLLENBQUMsaUJBQU4sQ0FBd0I7QUFBQSxNQUFFLEtBQUEsRUFBTyxJQUFDLENBQUEsS0FBVjtBQUFBLE1BQWlCLFNBQUEsRUFBVyxDQUE1QjtLQUF4QixDQUZsQixDQUFBO0FBQUEsSUFHQSxJQUFDLENBQUEsS0FBRCxHQUFjLEVBSGQsQ0FBQTtBQUFBLElBS0EsSUFBQyxDQUFBLE1BQUQsQ0FBUSxDQUFSLENBTEEsQ0FBQTtXQU1BLElBQUMsQ0FBQSxnQkFBRCxDQUFrQixJQUFsQixFQVBRO0VBQUEsQ0FoRVYsQ0FBQTs7QUFBQSxzQkF5RUEsTUFBQSxHQUFRLFNBQUMsS0FBRCxHQUFBO0FBQ04sUUFBQSxvQkFBQTtBQUFBLElBQUEsSUFBQyxDQUFBLEtBQUQsSUFBVSxLQUFWLENBQUE7QUFBQSxJQUNBLENBQUEsR0FBSSxJQUFDLENBQUEsS0FBRCxHQUFTLElBQUMsQ0FBQSxpQkFEZCxDQUFBO0FBRUEsSUFBQSxJQUFVLENBQUEsR0FBSSxDQUFkO0FBQUEsWUFBQSxDQUFBO0tBRkE7QUFJQSxTQUFTLCtHQUFULEdBQUE7QUFDRSxNQUFBLElBQUEsR0FBYyxJQUFDLENBQUEsVUFBVyxDQUFBLENBQUEsQ0FBWixHQUFpQixJQUFDLENBQUEsVUFBVyxDQUFBLENBQUEsQ0FBM0MsQ0FBQTtBQUFBLE1BQ0EsSUFBQyxDQUFBLE9BQVEsQ0FBQSxDQUFBLENBQVQsR0FBYyxJQUFDLENBQUEsVUFBVyxDQUFBLENBQUEsQ0FBWixHQUFpQixDQUFBLEdBQUksSUFEbkMsQ0FERjtBQUFBLEtBSkE7V0FPQSxJQUFDLENBQUEsZ0JBQUQsQ0FBQSxFQVJNO0VBQUEsQ0F6RVIsQ0FBQTs7QUFBQSxzQkFtRkEsZ0JBQUEsR0FBa0IsU0FBQyxNQUFELEdBQUE7QUFDaEIsUUFBQSxzRUFBQTs7TUFEaUIsU0FBTztLQUN4QjtBQUFBO1NBQVMsNEdBQVQsR0FBQTtBQUNFLE1BQUEsS0FBQSxHQUFTLElBQUksQ0FBQyxFQUFMLEdBQVUsQ0FBVixHQUFjLENBQWQsR0FBbUIsSUFBQyxDQUFBLE9BQU8sQ0FBQyxNQUFyQyxDQUFBO0FBQUEsTUFFQSxNQUFBLEdBQVMsSUFBQyxDQUFBLE9BQVEsQ0FBQSxDQUFBLENBRmxCLENBQUE7QUFBQSxNQUdBLE1BQUEsR0FBUyxJQUFDLENBQUEsTUFIVixDQUFBO0FBQUEsTUFLQSxJQUFBLEdBQU8sSUFBQyxDQUFBLGVBQUQsQ0FBaUIsSUFBQyxDQUFBLE1BQWxCLEVBQTBCLEtBQTFCLEVBQWlDLE1BQUEsR0FBTyxNQUFBLEdBQU8sSUFBQyxDQUFBLGFBQWhELENBTFAsQ0FBQTtBQUFBLE1BTUEsRUFBQSxHQUFPLElBQUMsQ0FBQSxlQUFELENBQWlCLElBQUMsQ0FBQSxNQUFsQixFQUEwQixLQUExQixFQUFpQyxNQUFBLEdBQU8sTUFBQSxHQUFPLElBQUMsQ0FBQSxXQUFoRCxDQU5QLENBQUE7QUFRQSxNQUFBLElBQUcsTUFBQSxDQUFBLElBQVEsQ0FBQSxLQUFNLENBQUEsQ0FBQSxDQUFkLEtBQW9CLFdBQXZCO0FBQ0UsUUFBQSxRQUFBLEdBQWUsSUFBQSxLQUFLLENBQUMsUUFBTixDQUFBLENBQWYsQ0FBQTtBQUFBLFFBQ0EsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFsQixDQUF1QixJQUF2QixFQUE2QixFQUE3QixFQUFpQyxJQUFqQyxDQURBLENBQUE7QUFBQSxRQUdBLElBQUEsR0FBVyxJQUFBLEtBQUssQ0FBQyxJQUFOLENBQVcsUUFBWCxFQUFxQixJQUFDLENBQUEsUUFBdEIsQ0FIWCxDQUFBO0FBQUEsUUFJQSxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBWSxJQUFaLENBSkEsQ0FBQTtBQUFBLHNCQUtBLElBQUMsQ0FBQSxHQUFELENBQUssSUFBTCxFQUxBLENBREY7T0FBQSxNQUFBO0FBUUUsUUFBQSxJQUFBLEdBQU8sSUFBQyxDQUFBLEtBQU0sQ0FBQSxDQUFBLENBQWQsQ0FBQTtBQUFBLFFBQ0EsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFTLENBQUEsQ0FBQSxDQUF2QixHQUE0QixJQUQ1QixDQUFBO0FBQUEsUUFFQSxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVMsQ0FBQSxDQUFBLENBQXZCLEdBQTRCLEVBRjVCLENBQUE7QUFBQSxRQUdBLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUyxDQUFBLENBQUEsQ0FBdkIsR0FBNEIsSUFINUIsQ0FBQTtBQUFBLHNCQUlBLElBQUksQ0FBQyxRQUFRLENBQUMsa0JBQWQsR0FBbUMsS0FKbkMsQ0FSRjtPQVRGO0FBQUE7b0JBRGdCO0VBQUEsQ0FuRmxCLENBQUE7O0FBQUEsc0JBMkdBLE1BQUEsR0FBUSxTQUFDLFNBQUQsR0FBQTtBQUNOLFFBQUEsYUFBQTs7TUFETyxZQUFVO0tBQ2pCO0FBQUEsSUFBQSxNQUFBLEdBQVMsRUFBVCxDQUFBO0FBQ0EsU0FBUyw4QkFBVCxHQUFBO0FBQ0UsTUFBQSxNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksSUFBSSxDQUFDLE1BQUwsQ0FBQSxDQUFaLENBREY7QUFBQSxLQURBO0FBR0EsSUFBQSxJQUFzQixTQUF0QjtBQUFBLE1BQUEsSUFBQyxDQUFBLFNBQUQsQ0FBVyxNQUFYLENBQUEsQ0FBQTtLQUhBO0FBSUEsV0FBTyxNQUFQLENBTE07RUFBQSxDQTNHUixDQUFBOztBQUFBLHNCQWtIQSxJQUFBLEdBQU0sU0FBQyxTQUFELEdBQUE7QUFDSixRQUFBLGFBQUE7O01BREssWUFBVTtLQUNmO0FBQUEsSUFBQSxNQUFBLEdBQVMsRUFBVCxDQUFBO0FBQ0EsU0FBUyw4QkFBVCxHQUFBO0FBQ0UsTUFBQSxNQUFPLENBQUEsQ0FBQSxDQUFQLEdBQVksQ0FBWixDQURGO0FBQUEsS0FEQTtBQUdBLElBQUEsSUFBc0IsU0FBdEI7YUFBQSxJQUFDLENBQUEsU0FBRCxDQUFXLE1BQVgsRUFBQTtLQUpJO0VBQUEsQ0FsSE4sQ0FBQTs7QUFBQSxzQkF3SEEsa0JBQUEsR0FBb0IsU0FBQSxHQUFBO0FBQ2xCLFFBQUEsNEJBQUE7QUFBQSxJQUFBLElBQUMsQ0FBQSxLQUFELEdBQVMsQ0FBVCxDQUFBO0FBQUEsSUFDQSxJQUFDLENBQUEsVUFBRCxHQUFjLElBQUMsQ0FBQSxPQURmLENBQUE7QUFHQSxJQUFBLElBQUcsSUFBQyxDQUFBLFVBQVUsQ0FBQyxNQUFaLEdBQXFCLElBQUMsQ0FBQSxVQUFVLENBQUMsTUFBcEM7QUFDRTtXQUFTLHNKQUFULEdBQUE7QUFDRSxzQkFBQSxJQUFDLENBQUEsVUFBVyxDQUFBLENBQUEsQ0FBWixHQUFpQixFQUFqQixDQURGO0FBQUE7c0JBREY7S0FKa0I7RUFBQSxDQXhIcEIsQ0FBQTs7QUFBQSxzQkFnSUEsZUFBQSxHQUFpQixTQUFDLEtBQUQsRUFBUSxLQUFSLEVBQWUsTUFBZixHQUFBO0FBQ2YsUUFBQSxJQUFBO0FBQUEsSUFBQSxDQUFBLEdBQUksS0FBSyxDQUFDLENBQU4sR0FBVSxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQVQsQ0FBQSxHQUFrQixNQUFoQyxDQUFBO0FBQUEsSUFDQSxDQUFBLEdBQUksS0FBSyxDQUFDLENBQU4sR0FBVSxJQUFJLENBQUMsR0FBTCxDQUFTLEtBQVQsQ0FBQSxHQUFrQixNQURoQyxDQUFBO0FBRUEsV0FBVyxJQUFBLEtBQUssQ0FBQyxPQUFOLENBQWMsQ0FBZCxFQUFpQixDQUFqQixFQUFvQixLQUFLLENBQUMsQ0FBMUIsQ0FBWCxDQUhlO0VBQUEsQ0FoSWpCLENBQUE7O21CQUFBOztHQUY0QixLQUFLLENBQUMsTUFBcEMsQ0FBQSIsImZpbGUiOiJncmFwaGljcy9FcXVhbGl6ZXIuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBTUEFDRS5FcXVhbGl6ZXIgZXh0ZW5kcyBUSFJFRS5Hcm91cFxuXG4gIGNlbnRlcjogICAgIG51bGxcblxuICBfdmFsdWVzOiAgICBudWxsXG4gIF9uZXdWYWx1ZXM6IG51bGxcbiAgX29sZFZhbHVlczogbnVsbFxuXG4gIF90aW1lOiAgICAgIDFcblxuICAjIFRIUkVFXG4gIG1hdGVyaWFsOiAgIG51bGxcbiAgbGluZXM6ICAgICAgbnVsbFxuICBpc0dlbmVyYXRlZDogZmFsc2VcblxuICAjIFBhcmFtZXRlcnNcbiAgbWF4TGVuZ3RoOiAgICAgICAgIDBcbiAgbWluTGVuZ3RoOiAgICAgICAgIDBcbiAgcmFkaXVzOiAgICAgICAgICAgIDBcbiAgaW50ZXJwb2xhdGlvblRpbWU6IDBcbiAgY29sb3I6ICAgICAgICAgICAgIDB4RkZGRkZGXG4gIGxpbmVGb3JjZVVwOiAgICAgICAuNVxuICBsaW5lRm9yY2VEb3duOiAgICAgLjVcbiAgYWJzb2x1dGU6ICAgICAgICAgIGZhbHNlXG5cbiAgY29uc3RydWN0b3I6IChwb2ludCwgb3B0cz17fSktPlxuICAgIHN1cGVyXG5cbiAgICAjIFNldCBwYXJhbWV0ZXJzXG4gICAgZGVmYXVsdHMgPVxuICAgICAgbWF4TGVuZ3RoOiAgICAgICAgIDIwMFxuICAgICAgbWluTGVuZ3RoOiAgICAgICAgIDUwXG4gICAgICByYWRpdXM6ICAgICAgICAgICAgMjUwXG4gICAgICBpbnRlcnBvbGF0aW9uVGltZTogMTUwXG4gICAgICBjb2xvcjogICAgICAgICAgICAgMHhERTU0OEVcbiAgICAgIGxpbmVGb3JjZVVwOiAgICAgICAuNVxuICAgICAgbGluZUZvcmNlRG93bjogICAgIC41XG4gICAgICBhYnNvbHV0ZTogICAgICAgICAgZmFsc2VcblxuICAgIG9wdHMgICAgICAgICAgICAgICA9IF9Db2ZmZWUubWVyZ2UoZGVmYXVsdHMsIG9wdHMpXG4gICAgQG1pbkxlbmd0aCAgICAgICAgID0gb3B0cy5taW5MZW5ndGhcbiAgICBAbWF4TGVuZ3RoICAgICAgICAgPSBvcHRzLm1heExlbmd0aFxuICAgIEByYWRpdXMgICAgICAgICAgICA9IG9wdHMucmFkaXVzXG4gICAgQGludGVycG9sYXRpb25UaW1lID0gb3B0cy5pbnRlcnBvbGF0aW9uVGltZVxuICAgIEBjb2xvciAgICAgICAgICAgICA9IG9wdHMuY29sb3JcbiAgICBAbGluZUZvcmNlVXAgICAgICAgPSBvcHRzLmxpbmVGb3JjZVVwXG4gICAgQGxpbmVGb3JjZURvd24gICAgID0gb3B0cy5saW5lRm9yY2VEb3duXG4gICAgQGFic29sdXRlICAgICAgICAgID0gb3B0cy5hYnNvbHV0ZVxuXG4gICAgIyBTZXQgdmFsdWVzXG4gICAgQGNlbnRlciAgICAgPSBwb2ludFxuICAgIEBfdmFsdWVzICAgID0gW11cbiAgICBAX29sZFZhbHVlcyA9IFtdXG4gICAgQF9uZXdWYWx1ZXMgPSBbXVxuXG4gICAgQGdlbmVyYXRlKClcblxuICBzZXRWYWx1ZXM6ICh2YWx1ZXMpLT5cbiAgICBuZXdWYWx1ZXMgPSBbXVxuICAgIGZvciB2YWx1ZSBpbiB2YWx1ZXNcbiAgICAgIHZhbHVlID0gTWF0aC5hYnModmFsdWUpIGlmIEBhYnNvbHV0ZVxuICAgICAgbGVuZ3RoID0gQG1pbkxlbmd0aCArIHBhcnNlRmxvYXQodmFsdWUpKihAbWF4TGVuZ3RoIC0gQG1pbkxlbmd0aClcbiAgICAgIG5ld1ZhbHVlcy5wdXNoKE1hdGgubWF4KGxlbmd0aCwgMCkpXG4gICAgQF9uZXdWYWx1ZXMgPSBuZXdWYWx1ZXNcbiAgICBAcmVzZXRJbnRlcnBvbGF0aW9uKClcblxuICBnZW5lcmF0ZTogLT5cbiAgICBAbXV0ZSgpXG5cbiAgICBAbWF0ZXJpYWwgICA9IG5ldyBUSFJFRS5MaW5lQmFzaWNNYXRlcmlhbCh7IGNvbG9yOiBAY29sb3IsIGxpbmV3aWR0aDogNCB9KVxuICAgIEBsaW5lcyAgICAgID0gW11cblxuICAgIEB1cGRhdGUoMClcbiAgICBAdXBkYXRlR2VvbWV0cmllcyh0cnVlKVxuXG4gIHVwZGF0ZTogKGRlbHRhKS0+XG4gICAgQF90aW1lICs9IGRlbHRhXG4gICAgdCA9IEBfdGltZSAvIEBpbnRlcnBvbGF0aW9uVGltZVxuICAgIHJldHVybiBpZiB0ID4gMVxuXG4gICAgZm9yIGkgaW4gWzAuLihAX25ld1ZhbHVlcy5sZW5ndGgtMSldXG4gICAgICBkaWZmICAgICAgICA9IEBfb2xkVmFsdWVzW2ldIC0gQF9uZXdWYWx1ZXNbaV1cbiAgICAgIEBfdmFsdWVzW2ldID0gQF9vbGRWYWx1ZXNbaV0gLSB0ICogZGlmZlxuICAgIEB1cGRhdGVHZW9tZXRyaWVzKCkjIGlmIEBpc0dlbmVyYXRlZFxuXG4gIHVwZGF0ZUdlb21ldHJpZXM6IChjcmVhdGU9ZmFsc2UpLT5cbiAgICBmb3IgaSBpbiBbMC4uKEBfdmFsdWVzLmxlbmd0aC0xKV1cbiAgICAgIGFuZ2xlICA9IE1hdGguUEkgKiAyICogaSAvIChAX3ZhbHVlcy5sZW5ndGgpXG5cbiAgICAgIGxlbmd0aCA9IEBfdmFsdWVzW2ldXG4gICAgICByYWRpdXMgPSBAcmFkaXVzXG5cbiAgICAgIGZyb20gPSBAY29tcHV0ZVBvc2l0aW9uKEBjZW50ZXIsIGFuZ2xlLCByYWRpdXMtbGVuZ3RoKkBsaW5lRm9yY2VEb3duKVxuICAgICAgdG8gICA9IEBjb21wdXRlUG9zaXRpb24oQGNlbnRlciwgYW5nbGUsIHJhZGl1cytsZW5ndGgqQGxpbmVGb3JjZVVwKVxuXG4gICAgICBpZiB0eXBlb2YgQGxpbmVzW2ldID09ICd1bmRlZmluZWQnXG4gICAgICAgIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkdlb21ldHJ5KClcbiAgICAgICAgZ2VvbWV0cnkudmVydGljZXMucHVzaChmcm9tLCB0bywgZnJvbSlcblxuICAgICAgICBsaW5lID0gbmV3IFRIUkVFLkxpbmUoZ2VvbWV0cnksIEBtYXRlcmlhbClcbiAgICAgICAgQGxpbmVzLnB1c2gobGluZSlcbiAgICAgICAgQGFkZChsaW5lKVxuICAgICAgZWxzZVxuICAgICAgICBsaW5lID0gQGxpbmVzW2ldXG4gICAgICAgIGxpbmUuZ2VvbWV0cnkudmVydGljZXNbMF0gPSBmcm9tXG4gICAgICAgIGxpbmUuZ2VvbWV0cnkudmVydGljZXNbMV0gPSB0b1xuICAgICAgICBsaW5lLmdlb21ldHJ5LnZlcnRpY2VzWzJdID0gZnJvbVxuICAgICAgICBsaW5lLmdlb21ldHJ5LnZlcnRpY2VzTmVlZFVwZGF0ZSA9IHRydWVcblxuICByYW5kb206IChzZXRWYWx1ZXM9dHJ1ZSk9PlxuICAgIHZhbHVlcyA9IFtdXG4gICAgZm9yIGkgaW4gWzAuLjYzXVxuICAgICAgdmFsdWVzW2ldID0gTWF0aC5yYW5kb20oKVxuICAgIEBzZXRWYWx1ZXModmFsdWVzKSBpZiBzZXRWYWx1ZXNcbiAgICByZXR1cm4gdmFsdWVzXG5cbiAgbXV0ZTogKHNldFZhbHVlcz10cnVlKS0+XG4gICAgdmFsdWVzID0gW11cbiAgICBmb3IgaSBpbiBbMC4uNjNdXG4gICAgICB2YWx1ZXNbaV0gPSAwXG4gICAgQHNldFZhbHVlcyh2YWx1ZXMpIGlmIHNldFZhbHVlc1xuXG4gIHJlc2V0SW50ZXJwb2xhdGlvbjogLT5cbiAgICBAX3RpbWUgPSAwXG4gICAgQF9vbGRWYWx1ZXMgPSBAX3ZhbHVlc1xuXG4gICAgaWYgQF9uZXdWYWx1ZXMubGVuZ3RoID4gQF9vbGRWYWx1ZXMubGVuZ3RoXG4gICAgICBmb3IgaSBpbiBbKEBfb2xkVmFsdWVzLmxlbmd0aCkuLihAX25ld1ZhbHVlcy5sZW5ndGgtMSldXG4gICAgICAgIEBfb2xkVmFsdWVzW2ldID0gMFxuXG4gIGNvbXB1dGVQb3NpdGlvbjogKHBvaW50LCBhbmdsZSwgbGVuZ3RoKS0+XG4gICAgeCA9IHBvaW50LnggKyBNYXRoLnNpbihhbmdsZSkgKiBsZW5ndGhcbiAgICB5ID0gcG9pbnQueSArIE1hdGguY29zKGFuZ2xlKSAqIGxlbmd0aFxuICAgIHJldHVybiBuZXcgVEhSRUUuVmVjdG9yMyh4LCB5LCBwb2ludC56KVxuXG4iXX0=